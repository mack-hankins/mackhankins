{"version":3,"sources":["redactor.js","imagemanager.js","table.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/jRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"redactor.js","sourcesContent":["/*\n\tRedactor v10.1.1\n\tUpdated: April 28, 2015\n\n\thttp://imperavi.com/redactor/\n\n\tCopyright (c) 2009-2015, Imperavi LLC.\n\tLicense: http://imperavi.com/redactor/license/\n\n\tUsage: $('#content').redactor();\n*/\n\n(function($)\n{\n\t'use strict';\n\n\tif (!Function.prototype.bind)\n\t{\n\t\tFunction.prototype.bind = function(scope)\n\t\t{\n\t\t\tvar fn = this;\n\t\t\treturn function()\n\t\t\t{\n\t\t\t\treturn fn.apply(scope);\n\t\t\t};\n\t\t};\n\t}\n\n\tvar uuid = 0;\n\n\t// Plugin\n\t$.fn.redactor = function(options)\n\t{\n\t\tvar val = [];\n\t\tvar args = Array.prototype.slice.call(arguments, 1);\n\n\t\tif (typeof options === 'string')\n\t\t{\n\t\t\tthis.each(function()\n\t\t\t{\n\t\t\t\tvar instance = $.data(this, 'redactor');\n\t\t\t\tvar func;\n\n\t\t\t\tif (options.search(/\\./) != '-1')\n\t\t\t\t{\n\t\t\t\t\tfunc = options.split('.');\n\t\t\t\t\tif (typeof instance[func[0]] != 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tfunc = instance[func[0]][func[1]];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tfunc = instance[options];\n\t\t\t\t}\n\n\t\t\t\tif (typeof instance !== 'undefined' && $.isFunction(func))\n\t\t\t\t{\n\t\t\t\t\tvar methodVal = func.apply(instance, args);\n\t\t\t\t\tif (methodVal !== undefined && methodVal !== instance)\n\t\t\t\t\t{\n\t\t\t\t\t\tval.push(methodVal);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$.error('No such method \"' + options + '\" for Redactor');\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tthis.each(function()\n\t\t\t{\n\t\t\t\t$.data(this, 'redactor', {});\n\t\t\t\t$.data(this, 'redactor', Redactor(this, options));\n\t\t\t});\n\t\t}\n\n\t\tif (val.length === 0) return this;\n\t\telse if (val.length === 1) return val[0];\n\t\telse return val;\n\n\t};\n\n\t// Initialization\n\tfunction Redactor(el, options)\n\t{\n\t\treturn new Redactor.prototype.init(el, options);\n\t}\n\n\t// Functionality\n\t$.Redactor = Redactor;\n\t$.Redactor.VERSION = '10.1.1';\n\t$.Redactor.modules = ['alignment', 'autosave', 'block', 'buffer', 'build', 'button',\n\t\t\t\t\t\t  'caret', 'clean', 'code', 'core', 'dropdown', 'file', 'focus',\n\t\t\t\t\t\t  'image', 'indent', 'inline', 'insert', 'keydown', 'keyup',\n\t\t\t\t\t\t  'lang', 'line', 'link', 'list', 'modal', 'observe', 'paragraphize',\n\t\t\t\t\t\t  'paste', 'placeholder', 'progress', 'selection', 'shortcuts',\n\t\t\t\t\t\t  'tabifier', 'tidy',  'toolbar', 'upload', 'utils', 'linkify'];\n\n\t$.Redactor.opts = {\n\n\t\t// settings\n\t\tlang: 'en',\n\t\tdirection: 'ltr', // ltr or rtl\n\n\t\tplugins: false, // array\n\n\t\tfocus: false,\n\t\tfocusEnd: false,\n\n\t\tplaceholder: false,\n\n\t\tvisual: true,\n\t\ttabindex: false,\n\n\t\tminHeight: false,\n\t\tmaxHeight: false,\n\n\t\tlinebreaks: false,\n\t\treplaceDivs: true,\n\t\tparagraphize: true,\n\t\tcleanStyleOnEnter: false,\n\t\tenterKey: true,\n\n\t\tcleanOnPaste: true,\n\t\tcleanSpaces: true,\n\t\tpastePlainText: false,\n\n\t\tautosave: false, // false or url\n\t\tautosaveName: false,\n\t\tautosaveInterval: 60, // seconds\n\t\tautosaveOnChange: false,\n\t\tautosaveFields: false,\n\n\t\tlinkTooltip: true,\n\t\tlinkProtocol: 'http',\n\t\tlinkNofollow: false,\n\t\tlinkSize: 50,\n\n\t\timageEditable: true,\n\t\timageLink: true,\n\t\timagePosition: true,\n\t\timageFloatMargin: '10px',\n\t\timageResizable: true,\n\n\t\timageUpload: null,\n\t\timageUploadParam: 'file',\n\n\t\tuploadImageField: false,\n\n\t\tdragImageUpload: true,\n\n\t\tfileUpload: null,\n\t\tfileUploadParam: 'file',\n\n\t\tdragFileUpload: true,\n\n\t\ts3: false,\n\n\t\tconvertLinks: true,\n\t\tconvertUrlLinks: true,\n\t\tconvertImageLinks: true,\n\t\tconvertVideoLinks: true,\n\n\t\tpreSpaces: 4, // or false\n\t\ttabAsSpaces: false, // true or number of spaces\n\t\ttabKey: true,\n\n\t\tscrollTarget: false,\n\n\t\ttoolbar: true,\n\t\ttoolbarFixed: true,\n\t\ttoolbarFixedTarget: document,\n\t\ttoolbarFixedTopOffset: 0, // pixels\n\t\ttoolbarExternal: false, // ID selector\n\t\ttoolbarOverflow: false,\n\n\t\tsource: true,\n\t\tbuttons: ['html', 'formatting', 'bold', 'italic', 'deleted', 'unorderedlist', 'orderedlist',\n\t\t\t\t  'outdent', 'indent', 'image', 'file', 'link', 'alignment', 'horizontalrule'], // + 'underline'\n\n\t\tbuttonsHide: [],\n\t\tbuttonsHideOnMobile: [],\n\n\t\tformatting: ['p', 'blockquote', 'pre', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'],\n\t\tformattingAdd: false,\n\n\t\ttabifier: true,\n\n\t\tdeniedTags: ['script', 'style'],\n\t\tallowedTags: false, // or array\n\n\t\tparagraphizeBlocks: ['table', 'div', 'pre', 'form', 'ul', 'ol', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'dl', 'blockquote', 'figcaption',\n\t\t\t\t\t\t\t'address', 'section', 'header', 'footer', 'aside', 'article', 'object', 'style', 'script', 'iframe', 'select', 'input', 'textarea',\n\t\t\t\t\t\t\t'button', 'option', 'map', 'area', 'math', 'hr', 'fieldset', 'legend', 'hgroup', 'nav', 'figure', 'details', 'menu', 'summary', 'p'],\n\n\t\tremoveComments: false,\n\t\treplaceTags: [\n\t\t\t['strike', 'del']\n\t\t],\n\t\treplaceStyles: [\n            ['font-weight:\\\\s?bold', \"strong\"],\n            ['font-style:\\\\s?italic', \"em\"],\n            ['text-decoration:\\\\s?underline', \"u\"],\n            ['text-decoration:\\\\s?line-through', 'del']\n        ],\n        removeDataAttr: false,\n\n\t\tremoveAttr: false, // or multi array\n\t\tallowedAttr: false, // or multi array\n\n\t\tremoveWithoutAttr: ['span'], // or false\n\t\tremoveEmpty: ['p'], // or false;\n\n\t\tactiveButtons: ['deleted', 'italic', 'bold', 'underline', 'unorderedlist', 'orderedlist',\n\t\t\t\t\t\t'alignleft', 'aligncenter', 'alignright', 'justify'],\n\t\tactiveButtonsStates: {\n\t\t\tb: 'bold',\n\t\t\tstrong: 'bold',\n\t\t\ti: 'italic',\n\t\t\tem: 'italic',\n\t\t\tdel: 'deleted',\n\t\t\tstrike: 'deleted',\n\t\t\tul: 'unorderedlist',\n\t\t\tol: 'orderedlist',\n\t\t\tu: 'underline'\n\t\t},\n\n\t\tshortcuts: {\n\t\t\t'ctrl+shift+m, meta+shift+m': { func: 'inline.removeFormat' },\n\t\t\t'ctrl+b, meta+b': { func: 'inline.format', params: ['bold'] },\n\t\t\t'ctrl+i, meta+i': { func: 'inline.format', params: ['italic'] },\n\t\t\t'ctrl+h, meta+h': { func: 'inline.format', params: ['superscript'] },\n\t\t\t'ctrl+l, meta+l': { func: 'inline.format', params: ['subscript'] },\n\t\t\t'ctrl+k, meta+k': { func: 'link.show' },\n\t\t\t'ctrl+shift+7':   { func: 'list.toggle', params: ['orderedlist'] },\n\t\t\t'ctrl+shift+8':   { func: 'list.toggle', params: ['unorderedlist'] }\n\t\t},\n\t\tshortcutsAdd: false,\n\n\t\t// private\n\t\tbuffer: [],\n\t\trebuffer: [],\n\t\temptyHtml: '<p>&#x200b;</p>',\n\t\tinvisibleSpace: '&#x200b;',\n\t\timageTypes: ['image/png', 'image/jpeg', 'image/gif'],\n\t\tindentValue: 20,\n\t\tverifiedTags: \t\t['a', 'img', 'b', 'strong', 'sub', 'sup', 'i', 'em', 'u', 'small', 'strike', 'del', 'cite', 'ul', 'ol', 'li'], // and for span tag special rule\n\t\tinlineTags: \t\t['strong', 'b', 'u', 'em', 'i', 'code', 'del', 'ins', 'samp', 'kbd', 'sup', 'sub', 'mark', 'var', 'cite', 'small'],\n\t\talignmentTags: \t\t['P', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6',  'DL', 'DT', 'DD', 'DIV', 'TD', 'BLOCKQUOTE', 'OUTPUT', 'FIGCAPTION', 'ADDRESS', 'SECTION', 'HEADER', 'FOOTER', 'ASIDE', 'ARTICLE'],\n\t\tblockLevelElements: ['PRE', 'UL', 'OL', 'LI'],\n\n\n\t\t// lang\n\t\tlangs: {\n\t\t\ten: {\n\t\t\t\thtml: 'HTML',\n\t\t\t\tvideo: 'Insert Video',\n\t\t\t\timage: 'Insert Image',\n\t\t\t\ttable: 'Table',\n\t\t\t\tlink: 'Link',\n\t\t\t\tlink_insert: 'Insert link',\n\t\t\t\tlink_edit: 'Edit link',\n\t\t\t\tunlink: 'Unlink',\n\t\t\t\tformatting: 'Formatting',\n\t\t\t\tparagraph: 'Normal text',\n\t\t\t\tquote: 'Quote',\n\t\t\t\tcode: 'Code',\n\t\t\t\theader1: 'Header 1',\n\t\t\t\theader2: 'Header 2',\n\t\t\t\theader3: 'Header 3',\n\t\t\t\theader4: 'Header 4',\n\t\t\t\theader5: 'Header 5',\n\t\t\t\tbold: 'Bold',\n\t\t\t\titalic: 'Italic',\n\t\t\t\tfontcolor: 'Font Color',\n\t\t\t\tbackcolor: 'Back Color',\n\t\t\t\tunorderedlist: 'Unordered List',\n\t\t\t\torderedlist: 'Ordered List',\n\t\t\t\toutdent: 'Outdent',\n\t\t\t\tindent: 'Indent',\n\t\t\t\tcancel: 'Cancel',\n\t\t\t\tinsert: 'Insert',\n\t\t\t\tsave: 'Save',\n\t\t\t\t_delete: 'Delete',\n\t\t\t\tinsert_table: 'Insert Table',\n\t\t\t\tinsert_row_above: 'Add Row Above',\n\t\t\t\tinsert_row_below: 'Add Row Below',\n\t\t\t\tinsert_column_left: 'Add Column Left',\n\t\t\t\tinsert_column_right: 'Add Column Right',\n\t\t\t\tdelete_column: 'Delete Column',\n\t\t\t\tdelete_row: 'Delete Row',\n\t\t\t\tdelete_table: 'Delete Table',\n\t\t\t\trows: 'Rows',\n\t\t\t\tcolumns: 'Columns',\n\t\t\t\tadd_head: 'Add Head',\n\t\t\t\tdelete_head: 'Delete Head',\n\t\t\t\ttitle: 'Title',\n\t\t\t\timage_position: 'Position',\n\t\t\t\tnone: 'None',\n\t\t\t\tleft: 'Left',\n\t\t\t\tright: 'Right',\n\t\t\t\tcenter: 'Center',\n\t\t\t\timage_web_link: 'Image Web Link',\n\t\t\t\ttext: 'Text',\n\t\t\t\tmailto: 'Email',\n\t\t\t\tweb: 'URL',\n\t\t\t\tvideo_html_code: 'Video Embed Code or Youtube/Vimeo Link',\n\t\t\t\tfile: 'Insert File',\n\t\t\t\tupload: 'Upload',\n\t\t\t\tdownload: 'Download',\n\t\t\t\tchoose: 'Choose',\n\t\t\t\tor_choose: 'Or choose',\n\t\t\t\tdrop_file_here: 'Drop file here',\n\t\t\t\talign_left: 'Align text to the left',\n\t\t\t\talign_center: 'Center text',\n\t\t\t\talign_right: 'Align text to the right',\n\t\t\t\talign_justify: 'Justify text',\n\t\t\t\thorizontalrule: 'Insert Horizontal Rule',\n\t\t\t\tdeleted: 'Deleted',\n\t\t\t\tanchor: 'Anchor',\n\t\t\t\tlink_new_tab: 'Open link in new tab',\n\t\t\t\tunderline: 'Underline',\n\t\t\t\talignment: 'Alignment',\n\t\t\t\tfilename: 'Name (optional)',\n\t\t\t\tedit: 'Edit',\n\t\t\t\tupload_label: 'Drop file here or '\n\n\t\t\t}\n\t\t},\n\n\t\tlinkify: {\n\t\t\tregexps: {\n\t\t\t\tyoutube: /https?:\\/\\/(?:[0-9A-Z-]+\\.)?(?:youtu\\.be\\/|youtube\\.com\\S*[^\\w\\-\\s])([\\w\\-]{11})(?=[^\\w\\-]|$)(?![?=&+%\\w.\\-]*(?:['\"][^<>]*>|<\\/a>))[?=&+%\\w.-]*/ig,\n\t\t\t\tvimeo: /https?:\\/\\/(www\\.)?vimeo.com\\/(\\d+)($|\\/)/,\n\t\t\t\timage: /((https?|www)[^\\s]+\\.)(jpe?g|png|gif)(\\?[^\\s-]+)?/ig,\n\t\t\t\turl: /(https?:\\/\\/(?:www\\.|(?!www))[^\\s\\.]+\\.[^\\s]{2,}|www\\.[^\\s]+\\.[^\\s]{2,})/ig,\n\t\t\t}\n\t\t},\n\n\t\tcodemirror: false\n\t};\n\n\t// Functionality\n\tRedactor.fn = $.Redactor.prototype = {\n\n\t\tkeyCode: {\n\t\t\tBACKSPACE: 8,\n\t\t\tDELETE: 46,\n\t\t\tDOWN: 40,\n\t\t\tENTER: 13,\n\t\t\tSPACE: 32,\n\t\t\tESC: 27,\n\t\t\tTAB: 9,\n\t\t\tCTRL: 17,\n\t\t\tMETA: 91,\n\t\t\tSHIFT: 16,\n\t\t\tALT: 18,\n\t\t\tRIGHT: 39,\n\t\t\tLEFT: 37,\n\t\t\tLEFT_WIN: 91\n\t\t},\n\n\t\t// Initialization\n\t\tinit: function(el, options)\n\t\t{\n\t\t\tthis.$element = $(el);\n\t\t\tthis.uuid = uuid++;\n\n\t\t\t// if paste event detected = true\n\t\t\tthis.rtePaste = false;\n\t\t\tthis.$pasteBox = false;\n\n\t\t\tthis.loadOptions(options);\n\t\t\tthis.loadModules();\n\n\t\t\t// formatting storage\n\t\t\tthis.formatting = {};\n\n\t\t\t// block level tags\n\t\t\t$.merge(this.opts.blockLevelElements, this.opts.alignmentTags);\n\t\t\tthis.reIsBlock = new RegExp('^(' + this.opts.blockLevelElements.join('|' ) + ')$', 'i');\n\n\t\t\t// setup allowed and denied tags\n\t\t\tthis.tidy.setupAllowed();\n\n\t\t\t// setup denied tags\n\t\t\tif (this.opts.deniedTags !== false)\n\t\t\t{\n\t\t\t\tvar tags = ['html', 'head', 'link', 'body', 'meta', 'applet'];\n\t\t\t\tfor (var i = 0; i < tags.length; i++)\n\t\t\t\t{\n\t\t\t\t\tthis.opts.deniedTags.push(tags[i]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// load lang\n\t\t\tthis.lang.load();\n\n\t\t\t// extend shortcuts\n\t\t\t$.extend(this.opts.shortcuts, this.opts.shortcutsAdd);\n\n\t\t\t// start callback\n\t\t\tthis.core.setCallback('start');\n\n\t\t\t// build\n\t\t\tthis.start = true;\n\t\t\tthis.build.run();\n\t\t},\n\n\t\tloadOptions: function(options)\n\t\t{\n\t\t\tthis.opts = $.extend(\n\t\t\t\t{},\n\t\t\t\t$.extend(true, {}, $.Redactor.opts),\n\t\t\t\tthis.$element.data(),\n\t\t\t\toptions\n\t\t\t);\n\t\t},\n\t\tgetModuleMethods: function(object)\n\t\t{\n\t\t\treturn Object.getOwnPropertyNames(object).filter(function(property)\n\t\t\t{\n\t\t\t\treturn typeof object[property] == 'function';\n\t\t\t});\n\t\t},\n\t\tloadModules: function()\n\t\t{\n\t\t\tvar len = $.Redactor.modules.length;\n\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t{\n\t\t\t\tthis.bindModuleMethods($.Redactor.modules[i]);\n\t\t\t}\n\t\t},\n\t\tbindModuleMethods: function(module)\n\t\t{\n\t\t\tif (typeof this[module] == 'undefined') return;\n\n\t\t\t// init module\n\t\t\tthis[module] = this[module]();\n\n\t\t\tvar methods = this.getModuleMethods(this[module]);\n\t\t\tvar len = methods.length;\n\n\t\t\t// bind methods\n\t\t\tfor (var z = 0; z < len; z++)\n\t\t\t{\n\t\t\t\tthis[module][methods[z]] = this[module][methods[z]].bind(this);\n\t\t\t}\n\t\t},\n\n\t\talignment: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tleft: function()\n\t\t\t\t{\n\t\t\t\t\tthis.alignment.set('');\n\t\t\t\t},\n\t\t\t\tright: function()\n\t\t\t\t{\n\t\t\t\t\tthis.alignment.set('right');\n\t\t\t\t},\n\t\t\t\tcenter: function()\n\t\t\t\t{\n\t\t\t\t\tthis.alignment.set('center');\n\t\t\t\t},\n\t\t\t\tjustify: function()\n\t\t\t\t{\n\t\t\t\t\tthis.alignment.set('justify');\n\t\t\t\t},\n\t\t\t\tset: function(type)\n\t\t\t\t{\n\t\t\t\t\t// focus\n\t\t\t\t\tif (!this.utils.browser('msie')) this.$editor.focus();\n\n\t\t\t\t\tthis.buffer.set();\n\t\t\t\t\tthis.selection.save();\n\n\t\t\t\t\t// get blocks\n\t\t\t\t\tthis.alignment.blocks = this.selection.getBlocks();\n\t\t\t\t\tthis.alignment.type = type;\n\n\t\t\t\t\t// set alignment\n\t\t\t\t\tif (this.alignment.isLinebreaksOrNoBlocks())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.alignment.setText();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.alignment.setBlocks();\n\t\t\t\t\t}\n\n\t\t\t\t\t// sync\n\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\tthis.code.sync();\n\t\t\t\t},\n\t\t\t\tsetText: function()\n\t\t\t\t{\n\t\t\t\t\tvar wrapper = this.selection.wrap('div');\n\t\t\t\t\t$(wrapper).attr('data-tagblock', 'redactor').css('text-align', this.alignment.type);\n\t\t\t\t},\n\t\t\t\tsetBlocks: function()\n\t\t\t\t{\n\t\t\t\t\t$.each(this.alignment.blocks, $.proxy(function(i, el)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $el = this.utils.getAlignmentElement(el);\n\t\t\t\t\t\tif (!$el) return;\n\n\t\t\t\t\t\tif (this.alignment.isNeedReplaceElement($el))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.alignment.replaceElement($el);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.alignment.alignElement($el);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tisLinebreaksOrNoBlocks: function()\n\t\t\t\t{\n\t\t\t\t\treturn (this.opts.linebreaks && this.alignment.blocks[0] === false);\n\t\t\t\t},\n\t\t\t\tisNeedReplaceElement: function($el)\n\t\t\t\t{\n\t\t\t\t\treturn (this.alignment.type === '' && typeof($el.data('tagblock')) !== 'undefined');\n\t\t\t\t},\n\t\t\t\treplaceElement: function($el)\n\t\t\t\t{\n\t\t\t\t\t$el.replaceWith($el.html());\n\t\t\t\t},\n\t\t\t\talignElement: function($el)\n\t\t\t\t{\n\t\t\t\t\t$el.css('text-align', this.alignment.type);\n\t\t\t\t\tthis.utils.removeEmptyAttr($el, 'style');\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tautosave: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\thtml: false,\n\t\t\t\tenable: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.opts.autosave) return;\n\n\t\t\t\t\tthis.autosave.name = (this.opts.autosaveName) ? this.opts.autosaveName : this.$textarea.attr('name');\n\n\t\t\t\t\tif (this.opts.autosaveOnChange) return;\n\t\t\t\t\tthis.autosaveInterval = setInterval(this.autosave.load, this.opts.autosaveInterval * 1000);\n\t\t\t\t},\n\t\t\t\tonChange: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.opts.autosaveOnChange) return;\n\t\t\t\t\tthis.autosave.load();\n\t\t\t\t},\n\t\t\t\tload: function()\n\t\t\t\t{\n\t\t\t\t\tthis.autosave.source = this.code.get();\n\n\t\t\t\t\tif (this.autosave.html === this.autosave.source) return;\n\t\t\t\t\t//if (this.utils.isEmpty(this.autosave.source)) return;\n\n\t\t\t\t\t// data\n\t\t\t\t\tvar data = {};\n\t\t\t\t\tdata['name'] = this.autosave.name;\n\t\t\t\t\tdata[this.autosave.name] = this.autosave.source;\n\t\t\t\t\tdata = this.autosave.getHiddenFields(data);\n\n\t\t\t\t\t// ajax\n\t\t\t\t\tvar jsxhr = $.ajax({\n\t\t\t\t\t\turl: this.opts.autosave,\n\t\t\t\t\t\ttype: 'post',\n\t\t\t\t\t\tdata: data\n\t\t\t\t\t});\n\n\t\t\t\t\tjsxhr.done(this.autosave.success);\n\t\t\t\t},\n\t\t\t\tgetHiddenFields: function(data)\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.autosaveFields === false || typeof this.opts.autosaveFields !== 'object')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn data;\n\t\t\t\t\t}\n\n\t\t\t\t\t$.each(this.opts.autosaveFields, $.proxy(function(k, v)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (v !== null && v.toString().indexOf('#') === 0) v = $(v).val();\n\t\t\t\t\t\tdata[k] = v;\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\treturn data;\n\n\t\t\t\t},\n\t\t\t\tsuccess: function(data)\n\t\t\t\t{\n\t\t\t\t\tvar json;\n\t\t\t\t\ttry\n\t\t\t\t\t{\n\t\t\t\t\t\tjson = $.parseJSON(data);\n\t\t\t\t\t}\n\t\t\t\t\tcatch(e)\n\t\t\t\t\t{\n\t\t\t\t\t\t//data has already been parsed\n\t\t\t\t\t\tjson = data;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar callbackName = (typeof json.error == 'undefined') ? 'autosave' :  'autosaveError';\n\n\t\t\t\t\tthis.core.setCallback(callbackName, this.autosave.name, json);\n\t\t\t\t\tthis.autosave.html = this.autosave.source;\n\t\t\t\t},\n\t\t\t\tdisable: function()\n\t\t\t\t{\n\t\t\t\t\tclearInterval(this.autosaveInterval);\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tblock: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tformatting: function(name)\n\t\t\t\t{\n\t\t\t\t\tthis.block.clearStyle = false;\n\t\t\t\t\tvar type, value;\n\n\t\t\t\t\tif (typeof this.formatting[name].data != 'undefined') type = 'data';\n\t\t\t\t\telse if (typeof this.formatting[name].attr != 'undefined') type = 'attr';\n\t\t\t\t\telse if (typeof this.formatting[name]['class'] != 'undefined') type = 'class';\n\n\t\t\t\t\tif (typeof this.formatting[name].clear != 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.block.clearStyle = true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (type) value = this.formatting[name][type];\n\n\t\t\t\t\tthis.block.format(this.formatting[name].tag, type, value);\n\n\t\t\t\t},\n\t\t\t\tformat: function(tag, type, value)\n\t\t\t\t{\n\t\t\t\t\tif (tag == 'quote') tag = 'blockquote';\n\n\t\t\t\t\tvar formatTags = ['p', 'pre', 'blockquote', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'];\n\t\t\t\t\tif ($.inArray(tag, formatTags) == -1) return;\n\n\t\t\t\t\tthis.block.isRemoveInline = (tag == 'pre' || tag.search(/h[1-6]/i) != -1);\n\n\t\t\t\t\t// focus\n\t\t\t\t\tif (!this.utils.browser('msie')) this.$editor.focus();\n\n\t\t\t\t\tthis.block.blocks = this.selection.getBlocks();\n\n\t\t\t\t\tthis.block.blocksSize = this.block.blocks.length;\n\t\t\t\t\tthis.block.type = type;\n\t\t\t\t\tthis.block.value = value;\n\n\t\t\t\t\tthis.buffer.set();\n\t\t\t\t\tthis.selection.save();\n\n\t\t\t\t\tthis.block.set(tag);\n\n\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\tthis.code.sync();\n\n\t\t\t\t},\n\t\t\t\tset: function(tag)\n\t\t\t\t{\n\t\t\t\t\tthis.selection.get();\n\t\t\t\t\tthis.block.containerTag = this.range.commonAncestorContainer.tagName;\n\n\t\t\t\t\tif (this.range.collapsed)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.block.setCollapsed(tag);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.block.setMultiple(tag);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetCollapsed: function(tag)\n\t\t\t\t{\n\t\t\t\t\tvar block = this.block.blocks[0];\n\t\t\t\t\tif (block === false) return;\n\n\t\t\t\t\tif (block.tagName == 'LI')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (tag != 'blockquote') return;\n\n\t\t\t\t\t\tthis.block.formatListToBlockquote();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar isContainerTable = (this.block.containerTag  == 'TD' || this.block.containerTag  == 'TH');\n\t\t\t\t\tif (isContainerTable && !this.opts.linebreaks)\n\t\t\t\t\t{\n\n\t\t\t\t\t\tdocument.execCommand('formatblock', false, '<' + tag + '>');\n\n\t\t\t\t\t\tblock = this.selection.getBlock();\n\t\t\t\t\t\tthis.block.toggle($(block));\n\n\t\t\t\t\t}\n\t\t\t\t\telse if (block.tagName.toLowerCase() != tag)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.opts.linebreaks && tag == 'p')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(block).prepend('<br>').append('<br>');\n\t\t\t\t\t\t\tthis.utils.replaceWithContents(block);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar $formatted = this.utils.replaceToTag(block, tag);\n\n\t\t\t\t\t\t\tthis.block.toggle($formatted);\n\n\t\t\t\t\t\t\tif (tag != 'p' && tag != 'blockquote') $formatted.find('img').remove();\n\t\t\t\t\t\t\tif (this.block.isRemoveInline) this.utils.removeInlineTags($formatted);\n\t\t\t\t\t\t\tif (tag == 'p' || this.block.headTag) $formatted.find('p').contents().unwrap();\n\n\t\t\t\t\t\t\tthis.block.formatTableWrapping($formatted);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (tag == 'blockquote' && block.tagName.toLowerCase() == tag)\n\t\t\t\t\t{\n\t\t\t\t\t\t// blockquote off\n\t\t\t\t\t\tif (this.opts.linebreaks)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(block).prepend('<br>').append('<br>');\n\t\t\t\t\t\t\tthis.utils.replaceWithContents(block);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar $el = this.utils.replaceToTag(block, 'p');\n\t\t\t\t\t\t\tthis.block.toggle($el);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (block.tagName.toLowerCase() == tag)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.block.toggle($(block));\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof this.block.type == 'undefined' && typeof this.block.value == 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\t$(block).removeAttr('class').removeAttr('style');\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tsetMultiple: function(tag)\n\t\t\t\t{\n\t\t\t\t\tvar block = this.block.blocks[0];\n\t\t\t\t\tvar isContainerTable = (this.block.containerTag  == 'TD' || this.block.containerTag  == 'TH');\n\n\t\t\t\t\tif (block !== false && this.block.blocksSize === 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (block.tagName.toLowerCase() == tag &&  tag == 'blockquote')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t// blockquote off\n\t\t\t\t\t\t\tif (this.opts.linebreaks)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$(block).prepend('<br>').append('<br>');\n\t\t\t\t\t\t\t\tthis.utils.replaceWithContents(block);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar $el = this.utils.replaceToTag(block, 'p');\n\t\t\t\t\t\t\t\tthis.block.toggle($el);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (block.tagName == 'LI')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (tag != 'blockquote') return;\n\n\t\t\t\t\t\t\tthis.block.formatListToBlockquote();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (this.block.containerTag == 'BLOCKQUOTE')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.block.formatBlockquote(tag);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (this.opts.linebreaks && ((isContainerTable) || (this.range.commonAncestorContainer != block)))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.block.formatWrap(tag);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (this.opts.linebreaks && tag == 'p')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$(block).prepend('<br>').append('<br>');\n\t\t\t\t\t\t\t\tthis.utils.replaceWithContents(block);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (block.tagName === 'TD')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.block.formatWrap(tag);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar $formatted = this.utils.replaceToTag(block, tag);\n\n\t\t\t\t\t\t\t\tthis.block.toggle($formatted);\n\n\t\t\t\t\t\t\t\tif (this.block.isRemoveInline) this.utils.removeInlineTags($formatted);\n\t\t\t\t\t\t\t\tif (tag == 'p' || this.block.headTag) $formatted.find('p').contents().unwrap();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\n\t\t\t\t\t\tif (this.opts.linebreaks || tag != 'p')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (tag == 'blockquote')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar count = 0;\n\t\t\t\t\t\t\t\tfor (var i = 0; i < this.block.blocksSize; i++)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif (this.block.blocks[i].tagName == 'BLOCKQUOTE') count++;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// only blockquote selected\n\t\t\t\t\t\t\t\tif (count == this.block.blocksSize)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t$.each(this.block.blocks, $.proxy(function(i,s)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tvar $formatted = false;\n\t\t\t\t\t\t\t\t\t\tif (this.opts.linebreaks)\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t$(s).prepend('<br>').append('<br>');\n\t\t\t\t\t\t\t\t\t\t\t$formatted = this.utils.replaceWithContents(s);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t$formatted = this.utils.replaceToTag(s, 'p');\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif ($formatted && typeof this.block.type == 'undefined' && typeof this.block.value == 'undefined')\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t$formatted.removeAttr('class').removeAttr('style');\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t}, this));\n\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t}\n\n\n\t\t\t\t\t\t\tthis.block.formatWrap(tag);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar classSize = 0;\n\t\t\t\t\t\t\tvar toggleType = false;\n\t\t\t\t\t\t\tif (this.block.type == 'class')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttoggleType = 'toggle';\n\t\t\t\t\t\t\t\tclassSize = $(this.block.blocks).filter('.' + this.block.value).length;\n\n\t\t\t\t\t\t\t\tif (this.block.blocksSize == classSize) toggleType = 'toggle';\n\t\t\t\t\t\t\t\telse if (this.block.blocksSize > classSize) toggleType = 'set';\n\t\t\t\t\t\t\t\telse if (classSize === 0) toggleType = 'set';\n\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tvar exceptTags = ['ul', 'ol', 'li', 'td', 'th', 'dl', 'dt', 'dd'];\n\t\t\t\t\t\t\t$.each(this.block.blocks, $.proxy(function(i,s)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif ($.inArray(s.tagName.toLowerCase(), exceptTags) != -1) return;\n\n\t\t\t\t\t\t\t\tvar $formatted = this.utils.replaceToTag(s, tag);\n\n\t\t\t\t\t\t\t\tif (toggleType)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif (toggleType == 'toggle') this.block.toggle($formatted);\n\t\t\t\t\t\t\t\t\telse if (toggleType == 'remove') this.block.remove($formatted);\n\t\t\t\t\t\t\t\t\telse if (toggleType == 'set') this.block.setForce($formatted);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse this.block.toggle($formatted);\n\n\t\t\t\t\t\t\t\tif (tag != 'p' && tag != 'blockquote') $formatted.find('img').remove();\n\t\t\t\t\t\t\t\tif (this.block.isRemoveInline) this.utils.removeInlineTags($formatted);\n\t\t\t\t\t\t\t\tif (tag == 'p' || this.block.headTag) $formatted.find('p').contents().unwrap();\n\n\t\t\t\t\t\t\t\tif (typeof this.block.type == 'undefined' && typeof this.block.value == 'undefined')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t$formatted.removeAttr('class').removeAttr('style');\n\t\t\t\t\t\t\t\t}\n\n\n\t\t\t\t\t\t\t}, this));\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetForce: function($el)\n\t\t\t\t{\n\t\t\t\t\t// remove style and class if the specified setting\n\t\t\t\t\tif (this.block.clearStyle)\n\t\t\t\t\t{\n\t\t\t\t\t\t$el.removeAttr('class').removeAttr('style');\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.block.type == 'class')\n\t\t\t\t\t{\n\t\t\t\t\t\t$el.addClass(this.block.value);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.block.type == 'attr' || this.block.type == 'data')\n\t\t\t\t\t{\n\t\t\t\t\t\t$el.attr(this.block.value.name, this.block.value.value);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\ttoggle: function($el)\n\t\t\t\t{\n\t\t\t\t\t// remove style and class if the specified setting\n\t\t\t\t\tif (this.block.clearStyle)\n\t\t\t\t\t{\n\t\t\t\t\t\t$el.removeAttr('class').removeAttr('style');\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.block.type == 'class')\n\t\t\t\t\t{\n\t\t\t\t\t\t$el.toggleClass(this.block.value);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.block.type == 'attr' || this.block.type == 'data')\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($el.attr(this.block.value.name) == this.block.value.value)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$el.removeAttr(this.block.value.name);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$el.attr(this.block.value.name, this.block.value.value);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t$el.removeAttr('style class');\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tremove: function($el)\n\t\t\t\t{\n\t\t\t\t\t$el.removeClass(this.block.value);\n\t\t\t\t},\n\t\t\t\tformatListToBlockquote: function()\n\t\t\t\t{\n\t\t\t\t\tvar block = $(this.block.blocks[0]).closest('ul, ol', this.$editor[0]);\n\n\t\t\t\t\t$(block).find('ul, ol').contents().unwrap();\n\t\t\t\t\t$(block).find('li').append($('<br>')).contents().unwrap();\n\n\t\t\t\t\tvar $el = this.utils.replaceToTag(block, 'blockquote');\n\t\t\t\t\tthis.block.toggle($el);\n\t\t\t\t},\n\t\t\t\tformatBlockquote: function(tag)\n\t\t\t\t{\n\t\t\t\t\tdocument.execCommand('outdent');\n\t\t\t\t\tdocument.execCommand('formatblock', false, tag);\n\n\t\t\t\t\tthis.clean.clearUnverified();\n\t\t\t\t\tthis.$editor.find('p:empty').remove();\n\n\t\t\t\t\tvar formatted = this.selection.getBlock();\n\n\t\t\t\t\tif (tag != 'p')\n\t\t\t\t\t{\n\t\t\t\t\t\t$(formatted).find('img').remove();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this.opts.linebreaks)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.block.toggle($(formatted));\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.$editor.find('ul, ol, tr, blockquote, p').each($.proxy(this.utils.removeEmpty, this));\n\n\t\t\t\t\tif (this.opts.linebreaks && tag == 'p')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.utils.replaceWithContents(formatted);\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tformatWrap: function(tag)\n\t\t\t\t{\n\t\t\t\t\tif (this.block.containerTag == 'UL' || this.block.containerTag == 'OL')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (tag == 'blockquote')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.block.formatListToBlockquote();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tvar formatted = this.selection.wrap(tag);\n\t\t\t\t\tif (formatted === false) return;\n\n\t\t\t\t\tvar $formatted = $(formatted);\n\n\t\t\t\t\tthis.block.formatTableWrapping($formatted);\n\n\t\t\t\t\tvar $elements = $formatted.find(this.opts.blockLevelElements.join(',') + ', td, table, thead, tbody, tfoot, th, tr');\n\n\t\t\t\t\tif ((this.opts.linebreaks && tag == 'p') || tag == 'pre' || tag == 'blockquote')\n\t\t\t\t\t{\n\t\t\t\t\t\t$elements.append('<br />');\n\t\t\t\t\t}\n\n\t\t\t\t\t$elements.contents().unwrap();\n\n\t\t\t\t\tif (tag != 'p' && tag != 'blockquote') $formatted.find('img').remove();\n\n\t\t\t\t\t$.each(this.block.blocks, $.proxy(this.utils.removeEmpty, this));\n\n\t\t\t\t\t$formatted.append(this.selection.getMarker(2));\n\n\t\t\t\t\tif (!this.opts.linebreaks)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.block.toggle($formatted);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.$editor.find('ul, ol, tr, blockquote, p').each($.proxy(this.utils.removeEmpty, this));\n\t\t\t\t\t$formatted.find('blockquote:empty').remove();\n\n\t\t\t\t\tif (this.block.isRemoveInline)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.utils.removeInlineTags($formatted);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.opts.linebreaks && tag == 'p')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.utils.replaceWithContents($formatted);\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tformatTableWrapping: function($formatted)\n\t\t\t\t{\n\t\t\t\t\tif ($formatted.closest('table', this.$editor[0]).length === 0) return;\n\n\t\t\t\t\tif ($formatted.closest('tr', this.$editor[0]).length === 0) $formatted.wrap('<tr>');\n\t\t\t\t\tif ($formatted.closest('td', this.$editor[0]).length === 0 && $formatted.closest('th').length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$formatted.wrap('<td>');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tremoveData: function(name, value)\n\t\t\t\t{\n\t\t\t\t\tvar blocks = this.selection.getBlocks();\n\t\t\t\t\t$(blocks).removeAttr('data-' + name);\n\n\t\t\t\t\tthis.code.sync();\n\t\t\t\t},\n\t\t\t\tsetData: function(name, value)\n\t\t\t\t{\n\t\t\t\t\tvar blocks = this.selection.getBlocks();\n\t\t\t\t\t$(blocks).attr('data-' + name, value);\n\n\t\t\t\t\tthis.code.sync();\n\t\t\t\t},\n\t\t\t\ttoggleData: function(name, value)\n\t\t\t\t{\n\t\t\t\t\tvar blocks = this.selection.getBlocks();\n\t\t\t\t\t$.each(blocks, function()\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($(this).attr('data-' + name))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(this).removeAttr('data-' + name);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(this).attr('data-' + name, value);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tremoveAttr: function(attr, value)\n\t\t\t\t{\n\t\t\t\t\tvar blocks = this.selection.getBlocks();\n\t\t\t\t\t$(blocks).removeAttr(attr);\n\n\t\t\t\t\tthis.code.sync();\n\t\t\t\t},\n\t\t\t\tsetAttr: function(attr, value)\n\t\t\t\t{\n\t\t\t\t\tvar blocks = this.selection.getBlocks();\n\t\t\t\t\t$(blocks).attr(attr, value);\n\n\t\t\t\t\tthis.code.sync();\n\t\t\t\t},\n\t\t\t\ttoggleAttr: function(attr, value)\n\t\t\t\t{\n\t\t\t\t\tvar blocks = this.selection.getBlocks();\n\t\t\t\t\t$.each(blocks, function()\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($(this).attr(name))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(this).removeAttr(name);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(this).attr(name, value);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tremoveClass: function(className)\n\t\t\t\t{\n\t\t\t\t\tvar blocks = this.selection.getBlocks();\n\t\t\t\t\t$(blocks).removeClass(className);\n\n\t\t\t\t\tthis.utils.removeEmptyAttr(blocks, 'class');\n\n\t\t\t\t\tthis.code.sync();\n\t\t\t\t},\n\t\t\t\tsetClass: function(className)\n\t\t\t\t{\n\t\t\t\t\tvar blocks = this.selection.getBlocks();\n\t\t\t\t\t$(blocks).addClass(className);\n\n\t\t\t\t\tthis.code.sync();\n\t\t\t\t},\n\t\t\t\ttoggleClass: function(className)\n\t\t\t\t{\n\t\t\t\t\tvar blocks = this.selection.getBlocks();\n\t\t\t\t\t$(blocks).toggleClass(className);\n\n\t\t\t\t\tthis.code.sync();\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tbuffer: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tset: function(type)\n\t\t\t\t{\n\t\t\t\t\tif (typeof type == 'undefined' || type == 'undo')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buffer.setUndo();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buffer.setRedo();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetUndo: function()\n\t\t\t\t{\n\t\t\t\t\tthis.selection.save();\n\t\t\t\t\tthis.opts.buffer.push(this.$editor.html());\n\t\t\t\t\tthis.selection.restore();\n\t\t\t\t},\n\t\t\t\tsetRedo: function()\n\t\t\t\t{\n\t\t\t\t\tthis.selection.save();\n\t\t\t\t\tthis.opts.rebuffer.push(this.$editor.html());\n\t\t\t\t\tthis.selection.restore();\n\t\t\t\t},\n\t\t\t\tgetUndo: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$editor.html(this.opts.buffer.pop());\n\t\t\t\t},\n\t\t\t\tgetRedo: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$editor.html(this.opts.rebuffer.pop());\n\t\t\t\t},\n\t\t\t\tadd: function()\n\t\t\t\t{\n\t\t\t\t\tthis.opts.buffer.push(this.$editor.html());\n\t\t\t\t},\n\t\t\t\tundo: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.buffer.length === 0) return;\n\n\t\t\t\t\tthis.buffer.set('redo');\n\t\t\t\t\tthis.buffer.getUndo();\n\n\t\t\t\t\tthis.selection.restore();\n\n\t\t\t\t\tsetTimeout($.proxy(this.observe.load, this), 50);\n\t\t\t\t},\n\t\t\t\tredo: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.rebuffer.length === 0) return;\n\n\t\t\t\t\tthis.buffer.set('undo');\n\t\t\t\t\tthis.buffer.getRedo();\n\n\t\t\t\t\tthis.selection.restore();\n\n\t\t\t\t\tsetTimeout($.proxy(this.observe.load, this), 50);\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tbuild: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\trun: function()\n\t\t\t\t{\n\t\t\t\t\tthis.build.createContainerBox();\n\t\t\t\t\tthis.build.loadContent();\n\t\t\t\t\tthis.build.loadEditor();\n\t\t\t\t\tthis.build.enableEditor();\n\t\t\t\t\tthis.build.setCodeAndCall();\n\t\t\t\t},\n\t\t\t\tisTextarea: function()\n\t\t\t\t{\n\t\t\t\t\treturn (this.$element[0].tagName === 'TEXTAREA');\n\t\t\t\t},\n\t\t\t\tcreateContainerBox: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$box = $('<div class=\"redactor-box\" />');\n\t\t\t\t},\n\t\t\t\tcreateTextarea: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$textarea = $('<textarea />').attr('name', this.build.getTextareaName());\n\t\t\t\t},\n\t\t\t\tgetTextareaName: function()\n\t\t\t\t{\n\t\t\t\t\treturn ((typeof(name) == 'undefined')) ? 'content-' + this.uuid : this.$element.attr('id');\n\t\t\t\t},\n\t\t\t\tloadContent: function()\n\t\t\t\t{\n\t\t\t\t\tvar func = (this.build.isTextarea()) ? 'val' : 'html';\n\t\t\t\t\tthis.content = $.trim(this.$element[func]());\n\t\t\t\t},\n\t\t\t\tenableEditor: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$editor.attr({ 'contenteditable': true, 'dir': this.opts.direction });\n\t\t\t\t},\n\t\t\t\tloadEditor: function()\n\t\t\t\t{\n\t\t\t\t\tvar func = (this.build.isTextarea()) ? 'fromTextarea' : 'fromElement';\n\t\t\t\t\tthis.build[func]();\n\t\t\t\t},\n\t\t\t\tfromTextarea: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$editor = $('<div />');\n\t\t\t\t\tthis.$textarea = this.$element;\n\t\t\t\t\tthis.$box.insertAfter(this.$element).append(this.$editor).append(this.$element);\n\t\t\t\t\tthis.$editor.addClass('redactor-editor');\n\n\t\t\t\t\tthis.$element.hide();\n\t\t\t\t},\n\t\t\t\tfromElement: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$editor = this.$element;\n\t\t\t\t\tthis.build.createTextarea();\n\t\t\t\t\tthis.$box.insertAfter(this.$editor).append(this.$editor).append(this.$textarea);\n\t\t\t\t\tthis.$editor.addClass('redactor-editor');\n\n\t\t\t\t\tthis.$textarea.hide();\n\t\t\t\t},\n\t\t\t\tsetCodeAndCall: function()\n\t\t\t\t{\n\t\t\t\t\t// set code\n\t\t\t\t\tthis.code.set(this.content);\n\n\t\t\t\t\tthis.build.setOptions();\n\t\t\t\t\tthis.build.callEditor();\n\n\t\t\t\t\t// code mode\n\t\t\t\t\tif (this.opts.visual) return;\n\t\t\t\t\tsetTimeout($.proxy(this.code.showCode, this), 200);\n\t\t\t\t},\n\t\t\t\tcallEditor: function()\n\t\t\t\t{\n\t\t\t\t\tthis.build.disableMozillaEditing();\n\t\t\t\t\tthis.build.setEvents();\n\t\t\t\t\tthis.build.setHelpers();\n\n\t\t\t\t\t// load toolbar\n\t\t\t\t\tif (this.opts.toolbar)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.opts.toolbar = this.toolbar.init();\n\t\t\t\t\t\tthis.toolbar.build();\n\t\t\t\t\t}\n\n\t\t\t\t\t// modal templates init\n\t\t\t\t\tthis.modal.loadTemplates();\n\n\t\t\t\t\t// plugins\n\t\t\t\t\tthis.build.plugins();\n\n\t\t\t\t\t// observers\n\t\t\t\t\tsetTimeout($.proxy(this.observe.load, this), 4);\n\n\t\t\t\t\t// init callback\n\t\t\t\t\tthis.core.setCallback('init');\n\t\t\t\t},\n\t\t\t\tsetOptions: function()\n\t\t\t\t{\n\t\t\t\t\t// textarea direction\n\t\t\t\t\t$(this.$textarea).attr('dir', this.opts.direction);\n\n\t\t\t\t\tif (this.opts.linebreaks) this.$editor.addClass('redactor-linebreaks');\n\n\t\t\t\t\tif (this.opts.tabindex) this.$editor.attr('tabindex', this.opts.tabindex);\n\n\t\t\t\t\tif (this.opts.minHeight) this.$editor.css('minHeight', this.opts.minHeight);\n\t\t\t\t\tif (this.opts.maxHeight) this.$editor.css('maxHeight', this.opts.maxHeight);\n\n\t\t\t\t},\n\t\t\t\tsetEventDropUpload: function(e)\n\t\t\t\t{\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\tif (!this.opts.dragImageUpload || !this.opts.dragFileUpload) return;\n\n\t\t\t\t\tvar files = e.dataTransfer.files;\n\t\t\t\t\tthis.upload.directUpload(files[0], e);\n\t\t\t\t},\n\t\t\t\tsetEventDrop: function(e)\n\t\t\t\t{\n\t\t\t\t\tthis.code.sync();\n\t\t\t\t\tsetTimeout(this.clean.clearUnverified, 1);\n\t\t\t\t\tthis.core.setCallback('drop', e);\n\t\t\t\t},\n\t\t\t\tsetEvents: function()\n\t\t\t\t{\n\t\t\t\t\t// drop\n\t\t\t\t\tthis.$editor.on('drop.redactor', $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\te = e.originalEvent || e;\n\n\t\t\t\t\t\tif (window.FormData === undefined || !e.dataTransfer) return true;\n\n\t\t\t\t\t\tif (e.dataTransfer.files.length === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn this.build.setEventDrop(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.build.setEventDropUpload(e);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tsetTimeout(this.clean.clearUnverified, 1);\n\t\t\t\t\t\tthis.core.setCallback('drop', e);\n\n\t\t\t\t\t}, this));\n\n\n\t\t\t\t\t// click\n\t\t\t\t\tthis.$editor.on('click.redactor', $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar event = this.core.getEvent();\n\t\t\t\t\t\tvar type = (event == 'click' || event == 'arrow') ? false : 'click';\n\n\t\t\t\t\t\tthis.core.addEvent(type);\n\t\t\t\t\t\tthis.utils.disableSelectAll();\n\t\t\t\t\t\tthis.core.setCallback('click', e);\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\t// paste\n\t\t\t\t\tthis.$editor.on('paste.redactor', $.proxy(this.paste.init, this));\n\n\t\t\t\t\t// cut\n\t\t\t\t\tthis.$editor.on('cut.redactor', $.proxy(this.code.sync, this));\n\n\t\t\t\t\t// keydown\n\t\t\t\t\tthis.$editor.on('keydown.redactor', $.proxy(this.keydown.init, this));\n\n\t\t\t\t\t// keyup\n\t\t\t\t\tthis.$editor.on('keyup.redactor', $.proxy(this.keyup.init, this));\n\n\t\t\t\t\t// textarea keydown\n\t\t\t\t\tif ($.isFunction(this.opts.codeKeydownCallback))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$textarea.on('keydown.redactor-textarea', $.proxy(this.opts.codeKeydownCallback, this));\n\t\t\t\t\t}\n\n\t\t\t\t\t// textarea keyup\n\t\t\t\t\tif ($.isFunction(this.opts.codeKeyupCallback))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$textarea.on('keyup.redactor-textarea', $.proxy(this.opts.codeKeyupCallback, this));\n\t\t\t\t\t}\n\n\t\t\t\t\t// focus\n\t\t\t\t\tif ($.isFunction(this.opts.focusCallback))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$editor.on('focus.redactor', $.proxy(this.opts.focusCallback, this));\n\t\t\t\t\t}\n\n\t\t\t\t\tvar clickedElement;\n\t\t\t\t\t$(document).on('mousedown', function(e) { clickedElement = e.target; });\n\n\t\t\t\t\t// blur\n\t\t\t\t\tthis.$editor.on('blur.redactor', $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.rtePaste) return;\n\t\t\t\t\t\tif (!this.build.isBlured(clickedElement)) return;\n\n\t\t\t\t\t\tthis.utils.disableSelectAll();\n\t\t\t\t\t\tif ($.isFunction(this.opts.blurCallback)) this.core.setCallback('blur', e);\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tisBlured: function(clickedElement)\n\t\t\t\t{\n\t\t\t\t\tvar $el = $(clickedElement);\n\n\t\t\t\t\treturn (!$el.hasClass('redactor-toolbar, redactor-dropdown') && !$el.is('#redactor-modal') && $el.parents('.redactor-toolbar, .redactor-dropdown, #redactor-modal').length === 0);\n\t\t\t\t},\n\t\t\t\tsetHelpers: function()\n\t\t\t\t{\n\t\t\t\t\t// linkify\n\t\t\t\t\tif (this.linkify.isEnabled())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.linkify.format();\n\t\t\t\t\t}\n\n\t\t\t\t\t// placeholder\n\t\t\t\t\tthis.placeholder.enable();\n\n\t\t\t\t\t// focus\n\t\t\t\t\tif (this.opts.focus) setTimeout(this.focus.setStart, 100);\n\t\t\t\t\tif (this.opts.focusEnd) setTimeout(this.focus.setEnd, 100);\n\n\t\t\t\t},\n\t\t\t\tplugins: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.opts.plugins) return;\n\t\t\t\t\tif (!RedactorPlugins) return;\n\n\t\t\t\t\t$.each(this.opts.plugins, $.proxy(function(i, s)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (typeof RedactorPlugins[s] === 'undefined') return;\n\n\t\t\t\t\t\tif ($.inArray(s, $.Redactor.modules) !== -1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$.error('Plugin name \"' + s + '\" matches the name of the Redactor\\'s module.');\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (!$.isFunction(RedactorPlugins[s])) return;\n\n\t\t\t\t\t\tthis[s] = RedactorPlugins[s]();\n\n\t\t\t\t\t\t// get methods\n\t\t\t\t\t\tvar methods = this.getModuleMethods(this[s]);\n\t\t\t\t\t\tvar len = methods.length;\n\n\t\t\t\t\t\t// bind methods\n\t\t\t\t\t\tfor (var z = 0; z < len; z++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis[s][methods[z]] = this[s][methods[z]].bind(this);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ($.isFunction(this[s].init)) this[s].init();\n\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t},\n\t\t\t\tdisableMozillaEditing: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.utils.browser('mozilla')) return;\n\n\t\t\t\t\t// FF fix\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdocument.execCommand('enableObjectResizing', false, false);\n\t\t\t\t\t\tdocument.execCommand('enableInlineTableEditing', false, false);\n\t\t\t\t\t} catch (e) {}\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tbutton: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tbuild: function(btnName, btnObject)\n\t\t\t\t{\n\t\t\t\t\tvar $button = $('<a href=\"#\" class=\"re-icon re-' + btnName + '\" rel=\"' + btnName + '\" />').attr('tabindex', '-1');\n\n\t\t\t\t\t// click\n\t\t\t\t\tif (btnObject.func || btnObject.command || btnObject.dropdown)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.button.setEvent($button, btnName, btnObject);\n\t\t\t\t\t}\n\n\t\t\t\t\t// dropdown\n\t\t\t\t\tif (btnObject.dropdown)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $dropdown = $('<div class=\"redactor-dropdown redactor-dropdown-' + this.uuid + ' redactor-dropdown-box-' + btnName + '\" style=\"display: none;\">');\n\t\t\t\t\t\t$button.data('dropdown', $dropdown);\n\t\t\t\t\t\tthis.dropdown.build(btnName, $dropdown, btnObject.dropdown);\n\t\t\t\t\t}\n\n\t\t\t\t\t// tooltip\n\t\t\t\t\tif (this.utils.isDesktop())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.button.createTooltip($button, btnName, btnObject.title);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn $button;\n\t\t\t\t},\n\t\t\t\tsetEvent: function($button, btnName, btnObject)\n\t\t\t\t{\n\t\t\t\t\t$button.on('touchstart click', $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($button.hasClass('redactor-button-disabled')) return false;\n\n\t\t\t\t\t\tvar type = 'func';\n\t\t\t\t\t\tvar callback = btnObject.func;\n\n\t\t\t\t\t\tif (btnObject.command)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype = 'command';\n\t\t\t\t\t\t\tcallback = btnObject.command;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (btnObject.dropdown)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype = 'dropdown';\n\t\t\t\t\t\t\tcallback = false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.button.onClick(e, btnName, type, callback);\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tcreateTooltip: function($button, name, title)\n\t\t\t\t{\n\t\t\t\t\tvar $tooltip = $('<span>').addClass('redactor-toolbar-tooltip redactor-toolbar-tooltip-' + name).hide().html(title);\n\t\t\t\t\t$tooltip.appendTo('body');\n\n\t\t\t\t\t$button.on('mouseover', function()\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($(this).hasClass('redactor-button-disabled')) return;\n\n\t\t\t\t\t\tvar pos = $button.offset();\n\n\t\t\t\t\t\t$tooltip.show();\n\t\t\t\t\t\t$tooltip.css({\n\t\t\t\t\t\t\ttop: (pos.top + $button.innerHeight()) + 'px',\n\t\t\t\t\t\t\tleft: (pos.left + $button.innerWidth()/2 - $tooltip.innerWidth()/2) + 'px'\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\t\t$button.on('mouseout', function()\n\t\t\t\t\t{\n\t\t\t\t\t\t$tooltip.hide();\n\t\t\t\t\t});\n\n\t\t\t\t},\n\t\t\t\tonClick: function(e, btnName, type, callback)\n\t\t\t\t{\n\t\t\t\t\tthis.button.caretOffset = this.caret.getOffset();\n\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\tif (this.utils.browser('msie')) e.returnValue = false;\n\n\t\t\t\t\tif (type == 'command') this.inline.format(callback);\n\t\t\t\t\telse if (type == 'dropdown') this.dropdown.show(e, btnName);\n\t\t\t\t\telse this.button.onClickCallback(e, callback, btnName);\n\t\t\t\t},\n\t\t\t\tonClickCallback: function(e, callback, btnName)\n\t\t\t\t{\n\t\t\t\t\tvar func;\n\n\t\t\t\t\tif ($.isFunction(callback)) callback.call(this, btnName);\n\t\t\t\t\telse if (callback.search(/\\./) != '-1')\n\t\t\t\t\t{\n\t\t\t\t\t\tfunc = callback.split('.');\n\t\t\t\t\t\tif (typeof this[func[0]] == 'undefined') return;\n\n\t\t\t\t\t\tthis[func[0]][func[1]](btnName);\n\t\t\t\t\t}\n\t\t\t\t\telse this[callback](btnName);\n\n\t\t\t\t\tthis.observe.buttons(e, btnName);\n\t\t\t\t},\n\t\t\t\tget: function(key)\n\t\t\t\t{\n\t\t\t\t\treturn this.$toolbar.find('a.re-' + key);\n\t\t\t\t},\n\t\t\t\tsetActive: function(key)\n\t\t\t\t{\n\t\t\t\t\tthis.button.get(key).addClass('redactor-act');\n\t\t\t\t},\n\t\t\t\tsetInactive: function(key)\n\t\t\t\t{\n\t\t\t\t\tthis.button.get(key).removeClass('redactor-act');\n\t\t\t\t},\n\t\t\t\tsetInactiveAll: function(key)\n\t\t\t\t{\n\t\t\t\t\tif (typeof key === 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$toolbar.find('a.re-icon').removeClass('redactor-act');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$toolbar.find('a.re-icon').not('.re-' + key).removeClass('redactor-act');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetActiveInVisual: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$toolbar.find('a.re-icon').not('a.re-html').removeClass('redactor-button-disabled');\n\t\t\t\t},\n\t\t\t\tsetInactiveInCode: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$toolbar.find('a.re-icon').not('a.re-html').addClass('redactor-button-disabled');\n\t\t\t\t},\n\t\t\t\tchangeIcon: function(key, classname)\n\t\t\t\t{\n\t\t\t\t\tthis.button.get(key).addClass('re-' + classname);\n\t\t\t\t},\n\t\t\t\tremoveIcon: function(key, classname)\n\t\t\t\t{\n\t\t\t\t\tthis.button.get(key).removeClass('re-' + classname);\n\t\t\t\t},\n\t\t\t\tsetAwesome: function(key, name)\n\t\t\t\t{\n\t\t\t\t\tvar $button = this.button.get(key);\n\t\t\t\t\t$button.removeClass('redactor-btn-image').addClass('fa-redactor-btn');\n\t\t\t\t\t$button.html('<i class=\"fa ' + name + '\"></i>');\n\t\t\t\t},\n\t\t\t\taddCallback: function($btn, callback)\n\t\t\t\t{\n\t\t\t\t\tvar type = (callback == 'dropdown') ? 'dropdown' : 'func';\n\t\t\t\t\tvar key = $btn.attr('rel');\n\t\t\t\t\t$btn.on('touchstart click', $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($btn.hasClass('redactor-button-disabled')) return false;\n\t\t\t\t\t\tthis.button.onClick(e, key, type, callback);\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\taddDropdown: function($btn, dropdown)\n\t\t\t\t{\n\t\t\t\t\tvar key = $btn.attr('rel');\n\t\t\t\t\tthis.button.addCallback($btn, 'dropdown');\n\n\t\t\t\t\tvar $dropdown = $('<div class=\"redactor-dropdown redactor-dropdown-' + this.uuid + ' redactor-dropdown-box-' + key + '\" style=\"display: none;\">');\n\t\t\t\t\t$btn.data('dropdown', $dropdown);\n\n\t\t\t\t\t// build dropdown\n\t\t\t\t\tif (dropdown) this.dropdown.build(key, $dropdown, dropdown);\n\n\t\t\t\t\treturn $dropdown;\n\t\t\t\t},\n\t\t\t\tadd: function(key, title)\n\t\t\t\t{\n\t\t\t\t\tif (!this.opts.toolbar) return;\n\n\t\t\t\t\tvar btn = this.button.build(key, { title: title });\n\t\t\t\t\tbtn.addClass('redactor-btn-image');\n\n\t\t\t\t\tthis.$toolbar.append($('<li>').append(btn));\n\n\t\t\t\t\treturn btn;\n\t\t\t\t},\n\t\t\t\taddFirst: function(key, title)\n\t\t\t\t{\n\t\t\t\t\tif (!this.opts.toolbar) return;\n\n\t\t\t\t\tvar btn = this.button.build(key, { title: title });\n\t\t\t\t\tbtn.addClass('redactor-btn-image');\n\t\t\t\t\tthis.$toolbar.prepend($('<li>').append(btn));\n\n\t\t\t\t\treturn btn;\n\t\t\t\t},\n\t\t\t\taddAfter: function(afterkey, key, title)\n\t\t\t\t{\n\t\t\t\t\tif (!this.opts.toolbar) return;\n\n\t\t\t\t\tvar btn = this.button.build(key, { title: title });\n\t\t\t\t\tbtn.addClass('redactor-btn-image');\n\t\t\t\t\tvar $btn = this.button.get(afterkey);\n\n\t\t\t\t\tif ($btn.length !== 0) $btn.parent().after($('<li>').append(btn));\n\t\t\t\t\telse this.$toolbar.append($('<li>').append(btn));\n\n\t\t\t\t\treturn btn;\n\t\t\t\t},\n\t\t\t\taddBefore: function(beforekey, key, title)\n\t\t\t\t{\n\t\t\t\t\tif (!this.opts.toolbar) return;\n\n\t\t\t\t\tvar btn = this.button.build(key, { title: title });\n\t\t\t\t\tbtn.addClass('redactor-btn-image');\n\t\t\t\t\tvar $btn = this.button.get(beforekey);\n\n\t\t\t\t\tif ($btn.length !== 0) $btn.parent().before($('<li>').append(btn));\n\t\t\t\t\telse this.$toolbar.append($('<li>').append(btn));\n\n\t\t\t\t\treturn btn;\n\t\t\t\t},\n\t\t\t\tremove: function(key)\n\t\t\t\t{\n\t\t\t\t\tthis.button.get(key).remove();\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tcaret: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tsetStart: function(node)\n\t\t\t\t{\n\t\t\t\t\t// inline tag\n\t\t\t\t\tif (!this.utils.isBlock(node))\n\t\t\t\t\t{\n\t\t\t\t\t\tvar space = this.utils.createSpaceElement();\n\n\t\t\t\t\t\t$(node).prepend(space);\n\t\t\t\t\t\tthis.caret.setEnd(space);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.caret.set(node, 0, node, 0);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetEnd: function(node)\n\t\t\t\t{\n\t\t\t\t\tthis.caret.set(node, 1, node, 1);\n\t\t\t\t},\n\t\t\t\tset: function(orgn, orgo, focn, foco)\n\t\t\t\t{\n\t\t\t\t\t// focus\n\t\t\t\t\t// disabled in 10.0.7\n\t\t\t\t\t// if (!this.utils.browser('msie')) this.$editor.focus();\n\n\t\t\t\t\torgn = orgn[0] || orgn;\n\t\t\t\t\tfocn = focn[0] || focn;\n\n\t\t\t\t\tif (this.utils.isBlockTag(orgn.tagName) && orgn.innerHTML === '')\n\t\t\t\t\t{\n\t\t\t\t\t\torgn.innerHTML = this.opts.invisibleSpace;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (orgn.tagName == 'BR' && this.opts.linebreaks === false)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar parent = $(this.opts.emptyHtml)[0];\n\t\t\t\t\t\t$(orgn).replaceWith(parent);\n\t\t\t\t\t\torgn = parent;\n\t\t\t\t\t\tfocn = orgn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.selection.get();\n\n\t\t\t\t\ttry\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.range.setStart(orgn, orgo);\n\t\t\t\t\t\tthis.range.setEnd(focn, foco);\n\t\t\t\t\t}\n\t\t\t\t\tcatch (e) {}\n\n\t\t\t\t\tthis.selection.addRange();\n\t\t\t\t},\n\t\t\t\tsetAfter: function(node)\n\t\t\t\t{\n\t\t\t\t\ttry\n\t\t\t\t\t{\n\t\t\t\t\t\tvar tag = $(node)[0].tagName;\n\n\t\t\t\t\t\t// inline tag\n\t\t\t\t\t\tif (tag != 'BR' && !this.utils.isBlock(node))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar space = this.utils.createSpaceElement();\n\n\t\t\t\t\t\t\t$(node).after(space);\n\t\t\t\t\t\t\tthis.caret.setEnd(space);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (tag != 'BR' && this.utils.browser('msie'))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.caret.setStart($(node).next());\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.caret.setAfterOrBefore(node, 'after');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tcatch (e)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar space = this.utils.createSpaceElement();\n\t\t\t\t\t\t$(node).after(space);\n\t\t\t\t\t\tthis.caret.setEnd(space);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetBefore: function(node)\n\t\t\t\t{\n\t\t\t\t\t// block tag\n\t\t\t\t\tif (this.utils.isBlock(node))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.caret.setEnd($(node).prev());\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.caret.setAfterOrBefore(node, 'before');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetAfterOrBefore: function(node, type)\n\t\t\t\t{\n\t\t\t\t\t// focus\n\t\t\t\t\tif (!this.utils.browser('msie')) this.$editor.focus();\n\n\t\t\t\t\tnode = node[0] || node;\n\n\t\t\t\t\tthis.selection.get();\n\n\t\t\t\t\tif (type == 'after')\n\t\t\t\t\t{\n\t\t\t\t\t\ttry {\n\n\t\t\t\t\t\t\tthis.range.setStartAfter(node);\n\t\t\t\t\t\t\tthis.range.setEndAfter(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcatch (e) {}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tthis.range.setStartBefore(node);\n\t\t\t\t\t\t\tthis.range.setEndBefore(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcatch (e) {}\n\t\t\t\t\t}\n\n\n\t\t\t\t\tthis.range.collapse(false);\n\t\t\t\t\tthis.selection.addRange();\n\t\t\t\t},\n\t\t\t\tgetOffsetOfElement: function(node)\n\t\t\t\t{\n\t\t\t\t\tnode = node[0] || node;\n\n\t\t\t\t\tthis.selection.get();\n\n\t\t\t\t\tvar cloned = this.range.cloneRange();\n\t\t\t\t\tcloned.selectNodeContents(node);\n\t\t\t\t\tcloned.setEnd(this.range.endContainer, this.range.endOffset);\n\n\t\t\t\t\treturn $.trim(cloned.toString()).length;\n\t\t\t\t},\n\t\t\t\tgetOffset: function()\n\t\t\t\t{\n\t\t\t\t\tvar offset = 0;\n\t\t\t\t    var sel = window.getSelection();\n\n\t\t\t\t    if (sel.rangeCount > 0)\n\t\t\t\t    {\n\t\t\t\t        var range = window.getSelection().getRangeAt(0);\n\t\t\t\t        var caretRange = range.cloneRange();\n\t\t\t\t        caretRange.selectNodeContents(this.$editor[0]);\n\t\t\t\t        caretRange.setEnd(range.endContainer, range.endOffset);\n\t\t\t\t        offset = caretRange.toString().length;\n\t\t\t\t    }\n\n\t\t\t\t\treturn offset;\n\t\t\t\t},\n\t\t\t\tsetOffset: function(start, end)\n\t\t\t\t{\n\t\t\t\t\tif (typeof end == 'undefined') end = start;\n\t\t\t\t\tif (!this.focus.isFocused()) this.focus.setStart();\n\n\t\t\t\t\tvar sel = this.selection.get();\n\t\t\t\t\tvar node, offset = 0;\n\t\t\t\t\tvar walker = document.createTreeWalker(this.$editor[0], NodeFilter.SHOW_TEXT, null, null);\n\n\t\t\t\t\twhile (node = walker.nextNode())\n\t\t\t\t\t{\n\t\t\t\t\t\toffset += node.nodeValue.length;\n\t\t\t\t\t\tif (offset > start)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.range.setStart(node, node.nodeValue.length + start - offset);\n\t\t\t\t\t\t\tstart = Infinity;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (offset >= end)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.range.setEnd(node, node.nodeValue.length + end - offset);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.range.collapse(false);\n\t\t\t\t\tthis.selection.addRange();\n\t\t\t\t},\n\t\t\t\t// deprecated\n\t\t\t\tsetToPoint: function(start, end)\n\t\t\t\t{\n\t\t\t\t\tthis.caret.setOffset(start, end);\n\t\t\t\t},\n\t\t\t\tgetCoords: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.caret.getOffset();\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tclean: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tonSet: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = this.clean.savePreCode(html);\n\n\t\t\t\t\t// convert script tag\n\t\t\t\t\thtml = html.replace(/<script(.*?[^>]?)>([\\w\\W]*?)<\\/script>/gi, '<pre class=\"redactor-script-tag\" style=\"display: none;\" $1>$2</pre>');\n\n\t\t\t\t\t// replace dollar sign to entity\n\t\t\t\t\thtml = html.replace(/\\$/g, '&#36;');\n\n\t\t\t\t\t// replace special characters in links\n\t\t\t\t\thtml = html.replace(/<a href=\"(.*?[^>]?)®(.*?[^>]?)\">/gi, '<a href=\"$1&reg$2\">');\n\n\t\t\t\t\tif (this.opts.replaceDivs) html = this.clean.replaceDivs(html);\n\t\t\t\t\tif (this.opts.linebreaks)  html = this.clean.replaceParagraphsToBr(html);\n\n\t\t\t\t\t// save form tag\n\t\t\t\t\thtml = this.clean.saveFormTags(html);\n\n\t\t\t\t\t// convert font tag to span\n\t\t\t\t\tvar $div = $('<div>');\n\t\t\t\t\t$div.html(html);\n\t\t\t\t\tvar fonts = $div.find('font[style]');\n\t\t\t\t\tif (fonts.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tfonts.replaceWith(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar $el = $(this);\n\t\t\t\t\t\t\tvar $span = $('<span>').attr('style', $el.attr('style'));\n\t\t\t\t\t\t\treturn $span.append($el.contents());\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\thtml = $div.html();\n\t\t\t\t\t}\n\t\t\t\t\t$div.remove();\n\n\t\t\t\t\t// remove font tag\n\t\t\t\t\thtml = html.replace(/<font(.*?[^<])>/gi, '');\n\t\t\t\t\thtml = html.replace(/<\\/font>/gi, '');\n\n\t\t\t\t\t// tidy html\n\t\t\t\t\thtml = this.tidy.load(html);\n\n\t\t\t\t\t// paragraphize\n\t\t\t\t\tif (this.opts.paragraphize) html = this.paragraphize.load(html);\n\n\t\t\t\t\t// verified\n\t\t\t\t\thtml = this.clean.setVerified(html);\n\n\t\t\t\t\t// convert inline tags\n\t\t\t\t\thtml = this.clean.convertInline(html);\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tonSync: function(html)\n\t\t\t\t{\n\t\t\t\t\t// remove spaces\n\t\t\t\t\thtml = html.replace(/[\\u200B-\\u200D\\uFEFF]/g, '');\n\t\t\t\t\thtml = html.replace(/&#x200b;/gi, '');\n\n\t\t\t\t\tif (this.opts.cleanSpaces)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(/&nbsp;/gi, ' ');\n\t\t\t\t\t}\n\n\t\t\t\t\tif (html.search(/^<p>(||\\s||<br\\s?\\/?>||&nbsp;)<\\/p>$/i) != -1)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn '';\n\t\t\t\t\t}\n\n\t\t\t\t\t// reconvert script tag\n\t\t\t\t\thtml = html.replace(/<pre class=\"redactor-script-tag\" style=\"display: none;\"(.*?[^>]?)>([\\w\\W]*?)<\\/pre>/gi, '<script$1>$2</script>');\n\n\t\t\t\t\t// restore form tag\n\t\t\t\t\thtml = this.clean.restoreFormTags(html);\n\n\t\t\t\t\tvar chars = {\n\t\t\t\t\t\t'\\u2122': '&trade;',\n\t\t\t\t\t\t'\\u00a9': '&copy;',\n\t\t\t\t\t\t'\\u2026': '&hellip;',\n\t\t\t\t\t\t'\\u2014': '&mdash;',\n\t\t\t\t\t\t'\\u2010': '&dash;'\n\t\t\t\t\t};\n\t\t\t\t\t// replace special characters\n\t\t\t\t\t$.each(chars, function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(new RegExp(i, 'g'), s);\n\t\t\t\t\t});\n\n\t\t\t\t\t// remove br in the of li\n\t\t\t\t\thtml = html.replace(new RegExp('<br\\\\s?/?></li>', 'gi'), '</li>');\n\t\t\t\t\thtml = html.replace(new RegExp('</li><br\\\\s?/?>', 'gi'), '</li>');\n\t\t\t\t\t// remove verified\n\t\t\t\t\thtml = html.replace(/<div(.*?[^>]) data-tagblock=\"redactor\"(.*?[^>])>/gi, '<div$1$2>');\n\t\t\t\t\thtml = html.replace(/<(.*?) data-verified=\"redactor\"(.*?[^>])>/gi, '<$1$2>');\n\t\t\t\t\thtml = html.replace(/<span(.*?[^>])\\srel=\"(.*?[^>])\"(.*?[^>])>/gi, '<span$1$3>');\n\t\t\t\t\thtml = html.replace(/<img(.*?[^>])\\srel=\"(.*?[^>])\"(.*?[^>])>/gi, '<img$1$3>');\n\t\t\t\t\thtml = html.replace(/<img(.*?[^>])\\sstyle=\"\" (.*?[^>])>'/gi, '<img$1 $2>');\n\t\t\t\t\thtml = html.replace(/<img(.*?[^>])\\sstyle (.*?[^>])>'/gi, '<img$1 $2>');\n\t\t\t\t\thtml = html.replace(/<span class=\"redactor-invisible-space\">(.*?)<\\/span>/gi, '$1');\n\t\t\t\t\thtml = html.replace(/ data-save-url=\"(.*?[^>])\"/gi, '');\n\n\t\t\t\t\t// remove image resize\n\t\t\t\t\thtml = html.replace(/<span(.*?)id=\"redactor-image-box\"(.*?[^>])>([\\w\\W]*?)<img(.*?)><\\/span>/gi, '$3<img$4>');\n\t\t\t\t\thtml = html.replace(/<span(.*?)id=\"redactor-image-resizer\"(.*?[^>])>(.*?)<\\/span>/gi, '');\n\t\t\t\t\thtml = html.replace(/<span(.*?)id=\"redactor-image-editter\"(.*?[^>])>(.*?)<\\/span>/gi, '');\n\n\t\t\t\t\t// remove font tag\n\t\t\t\t\thtml = html.replace(/<font(.*?[^<])>/gi, '');\n\t\t\t\t\thtml = html.replace(/<\\/font>/gi, '');\n\n\t\t\t\t\t// tidy html\n\t\t\t\t\thtml = this.tidy.load(html);\n\n\t\t\t\t\t// link nofollow\n\t\t\t\t\tif (this.opts.linkNofollow)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(/<a(.*?)rel=\"nofollow\"(.*?[^>])>/gi, '<a$1$2>');\n\t\t\t\t\t\thtml = html.replace(/<a(.*?[^>])>/gi, '<a$1 rel=\"nofollow\">');\n\t\t\t\t\t}\n\n\t\t\t\t\t// reconvert inline\n\t\t\t\t\thtml = html.replace(/\\sdata-redactor-(tag|class|style)=\"(.*?[^>])\"/gi, '');\n\t\t\t\t\thtml = html.replace(new RegExp('<(.*?) data-verified=\"redactor\"(.*?[^>])>', 'gi'), '<$1$2>');\n\t\t\t\t\thtml = html.replace(new RegExp('<(.*?) data-verified=\"redactor\">', 'gi'), '<$1>');\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tonPaste: function(html, setMode)\n\t\t\t\t{\n\t\t\t\t\thtml = $.trim(html);\n\n\t\t\t\t\thtml = html.replace(/\\$/g, '&#36;');\n\n\t\t\t\t\t// convert dirty spaces\n\t\t\t\t\thtml = html.replace(/<span class=\"s1\">/gi, '<span>');\n\t\t\t\t\thtml = html.replace(/<span class=\"Apple-converted-space\">&nbsp;<\\/span>/gi, ' ');\n\t\t\t\t\thtml = html.replace(/<span class=\"Apple-tab-span\"[^>]*>\\t<\\/span>/gi, '\\t');\n\t\t\t\t\thtml = html.replace(/<span[^>]*>(\\s|&nbsp;)<\\/span>/gi, ' ');\n\n\t\t\t\t\tif (this.opts.pastePlainText)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.clean.getPlainText(html);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this.utils.isSelectAll() && typeof setMode == 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.utils.isCurrentOrParent(['FIGCAPTION', 'A']))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn this.clean.getPlainText(html, false);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.utils.isCurrentOrParent('PRE'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\thtml = html.replace(/”/g, '\"');\n\t\t\t\t\t\t\thtml = html.replace(/“/g, '\"');\n\t\t\t\t\t\t\thtml = html.replace(/‘/g, '\\'');\n\t\t\t\t\t\t\thtml = html.replace(/’/g, '\\'');\n\n\t\t\t\t\t\t\treturn this.clean.getPreCode(html);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.utils.isCurrentOrParent(['BLOCKQUOTE', 'H1', 'H2', 'H3', 'H4', 'H5', 'H6']))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\thtml = this.clean.getOnlyImages(html);\n\n\t\t\t\t\t\t\tif (!this.utils.browser('msie'))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar block = this.selection.getBlock();\n\t\t\t\t\t\t\t\tif (block && block.tagName == 'P')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\thtml = html.replace(/<img(.*?)>/gi, '<p><img$1></p>');\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn html;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.utils.isCurrentOrParent(['TD']))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\thtml = this.clean.onPasteTidy(html, 'td');\n\n\t\t\t\t\t\t\tif (this.opts.linebreaks) html = this.clean.replaceParagraphsToBr(html);\n\n\t\t\t\t\t\t\thtml = this.clean.replaceDivsToBr(html);\n\n\t\t\t\t\t\t\treturn html;\n\t\t\t\t\t\t}\n\n\n\t\t\t\t\t\tif (this.utils.isCurrentOrParent(['LI']))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn this.clean.onPasteTidy(html, 'li');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\n\t\t\t\t\thtml = this.clean.isSingleLine(html, setMode);\n\n\t\t\t\t\tif (!this.clean.singleLine)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.opts.linebreaks)  html = this.clean.replaceParagraphsToBr(html);\n\t\t\t\t\t\tif (this.opts.replaceDivs) html = this.clean.replaceDivs(html);\n\n\t\t\t\t\t\thtml = this.clean.saveFormTags(html);\n\t\t\t\t\t}\n\n\n\t\t\t\t\thtml = this.clean.onPasteWord(html);\n\t\t\t\t\thtml = this.clean.onPasteExtra(html);\n\n\t\t\t\t\thtml = this.clean.onPasteTidy(html, 'all');\n\n\n\t\t\t\t\t// paragraphize\n\t\t\t\t\tif (!this.clean.singleLine && this.opts.paragraphize)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.paragraphize.load(html);\n\t\t\t\t\t}\n\n\t\t\t\t\thtml = this.clean.removeDirtyStyles(html);\n\t\t\t\t\thtml = this.clean.onPasteRemoveSpans(html);\n\t\t\t\t\thtml = this.clean.onPasteRemoveEmpty(html);\n\n\n\t\t\t\t\thtml = this.clean.convertInline(html);\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tonPasteWord: function(html)\n\t\t\t\t{\n\t\t\t\t\t// comments\n\t\t\t\t\thtml = html.replace(/<!--[\\s\\S]*?-->/gi, '');\n\n\t\t\t\t\t// style\n\t\t\t\t\thtml = html.replace(/<style[^>]*>[\\s\\S]*?<\\/style>/gi, '');\n\n\t\t\t\t\tif (/(class=\\\"?Mso|style=\\\"[^\\\"]*\\bmso\\-|w:WordDocument)/.test(html))\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.clean.onPasteIeFixLinks(html);\n\n\t\t\t\t\t\t// shapes\n\t\t\t\t\t\thtml = html.replace(/<img(.*?)v:shapes=(.*?)>/gi, '');\n\t\t\t\t\t\thtml = html.replace(/src=\"file\\:\\/\\/(.*?)\"/, 'src=\"\"');\n\n\t\t\t\t\t\t// list\n\t\t\t\t\t\thtml = html.replace(/<p(.*?)class=\"MsoListParagraphCxSpFirst\"([\\w\\W]*?)<\\/p>/gi, '<ul><li$2</li>');\n\t\t\t\t\t\thtml = html.replace(/<p(.*?)class=\"MsoListParagraphCxSpMiddle\"([\\w\\W]*?)<\\/p>/gi, '<li$2</li>');\n\t\t\t\t\t\thtml = html.replace(/<p(.*?)class=\"MsoListParagraphCxSpLast\"([\\w\\W]*?)<\\/p>/gi, '<li$2</li></ul>');\n\t\t\t\t\t\t// one line\n\t\t\t\t\t\thtml = html.replace(/<p(.*?)class=\"MsoListParagraph\"([\\w\\W]*?)<\\/p>/gi, '<ul><li$2</li></ul>');\n\t\t\t\t\t\t// remove ms word's bullet\n\t\t\t\t\t\thtml = html.replace(/·/g, '');\n\t\t\t\t\t\thtml = html.replace(/<p class=\"Mso(.*?)\"/gi, '<p');\n\n\t\t\t\t\t\t// classes\n\t\t\t\t\t\thtml = html.replace(/ class=\\\"(mso[^\\\"]*)\\\"/gi,\t\"\");\n\t\t\t\t\t\thtml = html.replace(/ class=(mso\\w+)/gi, \"\");\n\n\t\t\t\t\t\t// remove ms word tags\n\t\t\t\t\t\thtml = html.replace(/<o:p(.*?)>([\\w\\W]*?)<\\/o:p>/gi, '$2');\n\n\t\t\t\t\t\t// ms word break lines\n\t\t\t\t\t\thtml = html.replace(/\\n/g, ' ');\n\n\t\t\t\t\t\t// ms word lists break lines\n\t\t\t\t\t\thtml = html.replace(/<p>\\n?<li>/gi, '<li>');\n\t\t\t\t\t}\n\n\t\t\t\t\t// remove nbsp\n\t\t\t\t\tif (this.opts.cleanSpaces)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(/(\\s|&nbsp;)+/g, ' ');\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tonPasteExtra: function(html)\n\t\t\t\t{\n\t\t\t\t\t// remove google docs markers\n\t\t\t\t\thtml = html.replace(/<b\\sid=\"internal-source-marker(.*?)\">([\\w\\W]*?)<\\/b>/gi, \"$2\");\n\t\t\t\t\thtml = html.replace(/<b(.*?)id=\"docs-internal-guid(.*?)\">([\\w\\W]*?)<\\/b>/gi, \"$3\");\n\n\t\t\t\t\t// google docs styles\n\t\t\t \t\thtml = html.replace(/<span[^>]*(font-style: italic; font-weight: bold|font-weight: bold; font-style: italic)[^>]*>/gi, '<span style=\"font-weight: bold;\"><span style=\"font-style: italic;\">');\n\t\t\t \t\thtml = html.replace(/<span[^>]*font-style: italic[^>]*>/gi, '<span style=\"font-style: italic;\">');\n\t\t\t\t\thtml = html.replace(/<span[^>]*font-weight: bold[^>]*>/gi, '<span style=\"font-weight: bold;\">');\n\t\t\t\t\thtml = html.replace(/<span[^>]*text-decoration: underline[^>]*>/gi, '<span style=\"text-decoration: underline;\">');\n\n\t\t\t\t\thtml = html.replace(/<img>/gi, '');\n\t\t\t\t\thtml = html.replace(/\\n{3,}/gi, '\\n');\n\t\t\t\t\thtml = html.replace(/<font(.*?)>([\\w\\W]*?)<\\/font>/gi, '$2');\n\n\t\t\t\t\t// remove dirty p\n\t\t\t\t\thtml = html.replace(/<p><p>/gi, '<p>');\n\t\t\t\t\thtml = html.replace(/<\\/p><\\/p>/gi, '</p>');\n\t\t\t\t\thtml = html.replace(/<li>(\\s*|\\t*|\\n*)<p>/gi, '<li>');\n\t\t\t\t\thtml = html.replace(/<\\/p>(\\s*|\\t*|\\n*)<\\/li>/gi, '</li>');\n\n\t\t\t\t\t// remove space between paragraphs\n\t\t\t\t\thtml = html.replace(/<\\/p>\\s<p/gi, '<\\/p><p');\n\n\t\t\t\t\t// remove safari local images\n\t\t\t\t\thtml = html.replace(/<img src=\"webkit-fake-url\\:\\/\\/(.*?)\"(.*?)>/gi, '');\n\n\t\t\t\t\t// bullets\n\t\t\t\t\thtml = html.replace(/<p>•([\\w\\W]*?)<\\/p>/gi, '<li>$1</li>');\n\n\t\t\t\t\t// FF fix\n\t\t\t\t\tif (this.utils.browser('mozilla'))\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(/<br\\s?\\/?>$/gi, '');\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tonPasteTidy: function(html, type)\n\t\t\t\t{\n\t\t\t\t\t// remove all tags except these\n\t\t\t\t\tvar tags = ['span', 'a', 'pre', 'blockquote', 'small', 'em', 'strong', 'code', 'kbd', 'mark', 'address', 'cite', 'var', 'samp', 'dfn', 'sup', 'sub', 'b', 'i', 'u', 'del',\n\t\t\t\t\t\t\t\t'ol', 'ul', 'li', 'dl', 'dt', 'dd', 'p', 'br', 'video', 'audio', 'iframe', 'embed', 'param', 'object', 'img', 'table',\n\t\t\t\t\t\t\t\t'td', 'th', 'tr', 'tbody', 'tfoot', 'thead', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'];\n\t\t\t\t\tvar tagsEmpty = false;\n\t\t\t\t\tvar attrAllowed =  [\n\t\t\t\t\t\t\t['a', '*'],\n\t\t\t\t\t\t\t['img', ['src', 'alt']],\n\t\t\t\t\t\t\t['span', ['class', 'rel', 'data-verified']],\n\t\t\t\t\t\t\t['iframe', '*'],\n\t\t\t\t\t\t\t['video', '*'],\n\t\t\t\t\t\t\t['audio', '*'],\n\t\t\t\t\t\t\t['embed', '*'],\n\t\t\t\t\t\t\t['object', '*'],\n\t\t\t\t\t\t\t['param', '*'],\n\t\t\t\t\t\t\t['source', '*']\n\t\t\t\t\t\t];\n\n\t\t\t\t\tif (type == 'all')\n\t\t\t\t\t{\n\t\t\t\t\t\ttagsEmpty = ['p', 'span', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'];\n\t\t\t\t\t\tattrAllowed =  [\n\t\t\t\t\t\t\t['table', 'class'],\n\t\t\t\t\t\t\t['td', ['colspan', 'rowspan']],\n\t\t\t\t\t\t\t['a', '*'],\n\t\t\t\t\t\t\t['img', ['src', 'alt', 'data-redactor-inserted-image']],\n\t\t\t\t\t\t\t['span', ['class', 'rel', 'data-verified']],\n\t\t\t\t\t\t\t['iframe', '*'],\n\t\t\t\t\t\t\t['video', '*'],\n\t\t\t\t\t\t\t['audio', '*'],\n\t\t\t\t\t\t\t['embed', '*'],\n\t\t\t\t\t\t\t['object', '*'],\n\t\t\t\t\t\t\t['param', '*'],\n\t\t\t\t\t\t\t['source', '*']\n\t\t\t\t\t\t];\n\t\t\t\t\t}\n\t\t\t\t\telse if (type == 'td')\n\t\t\t\t\t{\n\t\t\t\t\t\t// remove all tags except these and remove all table tags: tr, td etc\n\t\t\t\t\t\ttags = ['ul', 'ol', 'li', 'span', 'a', 'small', 'em', 'strong', 'code', 'kbd', 'mark', 'cite', 'var', 'samp', 'dfn', 'sup', 'sub', 'b', 'i', 'u', 'del',\n\t\t\t\t\t\t\t\t'ol', 'ul', 'li', 'dl', 'dt', 'dd', 'br', 'iframe', 'video', 'audio', 'embed', 'param', 'object', 'img', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'];\n\n\t\t\t\t\t}\n\t\t\t\t\telse if (type == 'li')\n\t\t\t\t\t{\n\t\t\t\t\t\t// only inline tags and ul, ol, li\n\t\t\t\t\t\ttags = ['ul', 'ol', 'li', 'span', 'a', 'small', 'em', 'strong', 'code', 'kbd', 'mark', 'cite', 'var', 'samp', 'dfn', 'sup', 'sub', 'b', 'i', 'u', 'del', 'br',\n\t\t\t\t\t\t\t\t'iframe', 'video', 'audio', 'embed', 'param', 'object', 'img'];\n\t\t\t\t\t}\n\n\t\t\t\t\tvar options = {\n\t\t\t\t\t\tdeniedTags: (this.opts.deniedTags) ? this.opts.deniedTags : false,\n\t\t\t\t\t\tallowedTags: (this.opts.allowedTags) ? this.opts.allowedTags : tags,\n\t\t\t\t\t\tremoveComments: true,\n\t\t\t\t\t\tremovePhp: true,\n\t\t\t\t\t\tremoveAttr: (this.opts.removeAttr) ? this.opts.removeAttr : false,\n\t\t\t\t\t\tallowedAttr: (this.opts.allowedAttr) ? this.opts.allowedAttr : attrAllowed,\n\t\t\t\t\t\tremoveEmpty: tagsEmpty\n\t\t\t\t\t};\n\n\t\t\t\t\treturn this.tidy.load(html, options);\n\t\t\t\t},\n\t\t\t\tonPasteRemoveEmpty: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = html.replace(/<(p|h[1-6])>(|\\s|\\n|\\t|<br\\s?\\/?>)<\\/(p|h[1-6])>/gi, '');\n\n\t\t\t\t\t// remove br in the end\n\t\t\t\t\tif (!this.opts.linebreaks) html = html.replace(/<br>$/i, '');\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tonPasteRemoveSpans: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = html.replace(/<span>(.*?)<\\/span>/gi, '$1');\n\t\t\t\t\thtml = html.replace(/<span[^>]*>\\s|&nbsp;<\\/span>/gi, ' ');\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tonPasteIeFixLinks: function(html)\n\t\t\t\t{\n\t\t\t\t\tif (!this.utils.browser('msie')) return html;\n\n\t\t\t\t\tvar tmp = $.trim(html);\n\t\t\t\t\tif (tmp.search(/^<a(.*?)>(.*?)<\\/a>$/i) === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(/^<a(.*?)>(.*?)<\\/a>$/i, \"$2\");\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tisSingleLine: function(html, setMode)\n\t\t\t\t{\n\t\t\t\t\tthis.clean.singleLine = false;\n\n\t\t\t\t\tif (!this.utils.isSelectAll() && typeof setMode == 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tvar blocks = this.opts.blockLevelElements.join('|').replace('P|', '').replace('DIV|', '');\n\n\t\t\t\t\t\tvar matchBlocks = html.match(new RegExp('</(' + blocks + ')>', 'gi'));\n\t\t\t\t\t\tvar matchContainers = html.match(/<\\/(p|div)>/gi);\n\n\t\t\t\t\t\tif (!matchBlocks && (matchContainers === null || (matchContainers && matchContainers.length <= 1)))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar matchBR = html.match(/<br\\s?\\/?>/gi);\n\t\t\t\t\t\t\tvar matchIMG = html.match(/<img(.*?[^>])>/gi);\n\t\t\t\t\t\t\tif (!matchBR && !matchIMG)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.clean.singleLine = true;\n\t\t\t\t\t\t\t\thtml = html.replace(/<\\/?(p|div)(.*?)>/gi, '');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tstripTags: function(input, allowed)\n\t\t\t\t{\n\t\t\t\t    allowed = (((allowed || '') + '').toLowerCase().match(/<[a-z][a-z0-9]*>/g) || []).join('');\n\t\t\t\t    var tags = /<\\/?([a-z][a-z0-9]*)\\b[^>]*>/gi;\n\n\t\t\t\t    return input.replace(tags, function ($0, $1) {\n\t\t\t\t        return allowed.indexOf('<' + $1.toLowerCase() + '>') > -1 ? $0 : '';\n\t\t\t\t    });\n\t\t\t\t},\n\t\t\t\tsavePreCode: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = this.clean.savePreFormatting(html);\n\t\t\t\t\thtml = this.clean.saveCodeFormatting(html);\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tsavePreFormatting: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar pre = html.match(/<pre(.*?)>([\\w\\W]*?)<\\/pre>/gi);\n\t\t\t\t\tif (pre !== null)\n\t\t\t\t\t{\n\t\t\t\t\t\t$.each(pre, $.proxy(function(i,s)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar arr = s.match(/<pre(.*?)>([\\w\\W]*?)<\\/pre>/i);\n\n\t\t\t\t\t\t\tarr[2] = arr[2].replace(/<br\\s?\\/?>/g, '\\n');\n\t\t\t\t\t\t\tarr[2] = arr[2].replace(/&nbsp;/g, ' ');\n\n\t\t\t\t\t\t\tif (this.opts.preSpaces)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tarr[2] = arr[2].replace(/\\t/g, Array(this.opts.preSpaces + 1).join(' '));\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tarr[2] = this.clean.encodeEntities(arr[2]);\n\n\t\t\t\t\t\t\t// $ fix\n\t\t\t\t\t\t\tarr[2] = arr[2].replace(/\\$/g, '&#36;');\n\n\t\t\t\t\t\t\thtml = html.replace(s, '<pre' + arr[1] + '>' + arr[2] + '</pre>');\n\n\t\t\t\t\t\t}, this));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tsaveCodeFormatting: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar code = html.match(/<code(.*?[^>])>(.*?)<\\/code>/gi);\n\t\t\t\t\tif (code !== null)\n\t\t\t\t\t{\n\t\t\t\t\t\t$.each(code, $.proxy(function(i,s)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar arr = s.match(/<code(.*?[^>])>(.*?)<\\/code>/i);\n\n\t\t\t\t\t\t\tarr[2] = arr[2].replace(/&nbsp;/g, ' ');\n\t\t\t\t\t\t\tarr[2] = this.clean.encodeEntities(arr[2]);\n\n\t\t\t\t\t\t\t// $ fix\n\t\t\t\t\t\t\tarr[2] = arr[2].replace(/\\$/g, '&#36;');\n\n\t\t\t\t\t\t\thtml = html.replace(s, '<code' + arr[1] + '>' + arr[2] + '</code>');\n\n\t\t\t\t\t\t}, this));\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tgetTextFromHtml: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = html.replace(/<br\\s?\\/?>|<\\/H[1-6]>|<\\/p>|<\\/div>|<\\/li>|<\\/td>/gi, '\\n');\n\n\t\t\t\t\tvar tmp = document.createElement('div');\n\t\t\t\t\ttmp.innerHTML = html;\n\t\t\t\t\thtml = tmp.textContent || tmp.innerText;\n\n\t\t\t\t\treturn $.trim(html);\n\t\t\t\t},\n\t\t\t\tgetPlainText: function(html, paragraphize)\n\t\t\t\t{\n\t\t\t\t\thtml = this.clean.getTextFromHtml(html);\n\t\t\t\t\thtml = html.replace(/\\n/g, '<br />');\n\n\t\t\t\t\tif (this.opts.paragraphize && typeof paragraphize == 'undefined' && !this.utils.browser('mozilla'))\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.paragraphize.load(html);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tgetPreCode: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = html.replace(/<img(.*?) style=\"(.*?)\"(.*?[^>])>/gi, '<img$1$3>');\n\t\t\t\t\thtml = html.replace(/<img(.*?)>/gi, '&lt;img$1&gt;');\n\t\t\t\t\thtml = this.clean.getTextFromHtml(html);\n\n\t\t\t\t\tif (this.opts.preSpaces)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(/\\t/g, Array(this.opts.preSpaces + 1).join(' '));\n\t\t\t\t\t}\n\n\t\t\t\t\thtml = this.clean.encodeEntities(html);\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tgetOnlyImages: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = html.replace(/<img(.*?)>/gi, '[img$1]');\n\n\t\t\t\t\t// remove all tags\n\t\t\t\t\thtml = html.replace(/<([Ss]*?)>/gi, '');\n\n\t\t\t\t\thtml = html.replace(/\\[img(.*?)\\]/gi, '<img$1>');\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tgetOnlyLinksAndImages: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = html.replace(/<a(.*?)href=\"(.*?)\"(.*?)>([\\w\\W]*?)<\\/a>/gi, '[a href=\"$2\"]$4[/a]');\n\t\t\t\t\thtml = html.replace(/<img(.*?)>/gi, '[img$1]');\n\n\t\t\t\t\t// remove all tags\n\t\t\t\t\thtml = html.replace(/<(.*?)>/gi, '');\n\n\t\t\t\t\thtml = html.replace(/\\[a href=\"(.*?)\"\\]([\\w\\W]*?)\\[\\/a\\]/gi, '<a href=\"$1\">$2</a>');\n\t\t\t\t\thtml = html.replace(/\\[img(.*?)\\]/gi, '<img$1>');\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tencodeEntities: function(str)\n\t\t\t\t{\n\t\t\t\t\tstr = String(str).replace(/&amp;/g, '&').replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&quot;/g, '\"');\n\t\t\t\t\treturn str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;');\n\t\t\t\t},\n\t\t\t\tremoveDirtyStyles: function(html)\n\t\t\t\t{\n\t\t\t\t\tif (this.utils.browser('msie')) return html;\n\n\t\t\t\t\tvar div = document.createElement('div');\n\t\t\t\t\tdiv.innerHTML = html;\n\n\t\t\t\t\tthis.clean.clearUnverifiedRemove($(div));\n\n\t\t\t\t\thtml = div.innerHTML;\n\t\t\t\t\t$(div).remove();\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tclearUnverified: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.utils.browser('msie')) return;\n\n\t\t\t\t\tthis.clean.clearUnverifiedRemove(this.$editor);\n\n\t\t\t\t\tvar headers = this.$editor.find('h1, h2, h3, h4, h5, h6');\n\t\t\t\t\theaders.find('span').removeAttr('style');\n\t\t\t\t\theaders.find(this.opts.verifiedTags.join(', ')).removeAttr('style');\n\n\t\t\t\t\tthis.code.sync();\n\t\t\t\t},\n\t\t\t\tclearUnverifiedRemove: function($editor)\n\t\t\t\t{\n\t\t\t\t\t$editor.find(this.opts.verifiedTags.join(', ')).removeAttr('style');\n\t\t\t\t\t$editor.find('span').not('[data-verified=\"redactor\"]').removeAttr('style');\n\n\t\t\t\t\t$editor.find('span[data-verified=\"redactor\"], img[data-verified=\"redactor\"]').each(function(i, s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $s = $(s);\n\t\t\t\t\t\t$s.attr('style', $s.attr('rel'));\n\t\t\t\t\t});\n\n\t\t\t\t},\n\t\t\t\tcleanEmptyParagraph: function()\n\t\t\t\t{\n\t\t\t\t\tvar p = this.$editor.find(\"p\").first();\n\n\t\t\t\t\tif (this.utils.isEmpty(p.html()))\n\t\t\t\t\t{\n\t\t\t\t\t\tp.remove();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetVerified: function(html)\n\t\t\t\t{\n\t\t\t\t\tif (this.utils.browser('msie')) return html;\n\n\t\t\t\t\thtml = html.replace(new RegExp('<img(.*?[^>])>', 'gi'), '<img$1 data-verified=\"redactor\">');\n\t\t\t\t\thtml = html.replace(new RegExp('<span(.*?[^>])>', 'gi'), '<span$1 data-verified=\"redactor\">');\n\n\t\t\t\t\tvar matches = html.match(new RegExp('<(span|img)(.*?)style=\"(.*?)\"(.*?[^>])>', 'gi'));\n\n\t\t\t\t\tif (matches)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar len = matches.length;\n\t\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttry {\n\n\t\t\t\t\t\t\t\tvar newTag = matches[i].replace(/style=\"(.*?)\"/i, 'style=\"$1\" rel=\"$1\"');\n\t\t\t\t\t\t\t\thtml = html.replace(matches[i], newTag);\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcatch (e) {}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tconvertInline: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar $div = $('<div />').html(html);\n\n\t\t\t\t\tvar tags = this.opts.inlineTags;\n\t\t\t\t\ttags.push('span');\n\n\t\t\t\t\t$div.find(tags.join(',')).each(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $el = $(this);\n\t\t\t\t\t\tvar tag = this.tagName.toLowerCase();\n\t\t\t\t\t\t$el.attr('data-redactor-tag', tag);\n\n\t\t\t\t\t\tif (tag == 'span')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif ($el.attr('style')) $el.attr('data-redactor-style', $el.attr('style'));\n\t\t\t\t\t\t\telse if ($el.attr('class')) $el.attr('data-redactor-class', $el.attr('class'));\n\t\t\t\t\t\t}\n\n\t\t\t\t\t});\n\n\t\t\t\t\thtml = $div.html();\n\t\t\t\t\t$div.remove();\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tnormalizeLists: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$editor.find('li').each(function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $next = $(s).next();\n\t\t\t\t\t\tif ($next.length !== 0 && ($next[0].tagName == 'UL' || $next[0].tagName == 'OL'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(s).append($next);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tremoveSpaces: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = html.replace(/\\n/g, '');\n\t\t\t\t\thtml = html.replace(/[\\t]*/g, '');\n\t\t\t\t\thtml = html.replace(/\\n\\s*\\n/g, \"\\n\");\n\t\t\t\t\thtml = html.replace(/^[\\s\\n]*/g, ' ');\n\t\t\t\t\thtml = html.replace(/[\\s\\n]*$/g, ' ');\n\t\t\t\t\thtml = html.replace( />\\s{2,}</g, '> <'); // between inline tags can be only one space\n\t\t\t\t\thtml = html.replace(/\\n\\n/g, \"\\n\");\n\t\t\t\t\thtml = html.replace(/[\\u200B-\\u200D\\uFEFF]/g, '');\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\treplaceDivs: function(html)\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.linebreaks)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(/<div><br\\s?\\/?><\\/div>/gi, '<br />');\n\t\t\t\t\t\thtml = html.replace(/<div(.*?)>([\\w\\W]*?)<\\/div>/gi, '$2<br />');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(/<div(.*?)>([\\w\\W]*?)<\\/div>/gi, '<p$1>$2</p>');\n\t\t\t\t\t}\n\n\t\t\t\t\thtml = html.replace(/<div(.*?[^>])>/gi, '');\n\t\t\t\t\thtml = html.replace(/<\\/div>/gi, '');\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\treplaceDivsToBr: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = html.replace(/<div\\s(.*?)>/gi, '<p>');\n\t\t\t\t\thtml = html.replace(/<div><br\\s?\\/?><\\/div>/gi, '<br /><br />');\n\t\t\t\t\thtml = html.replace(/<div>([\\w\\W]*?)<\\/div>/gi, '$1<br /><br />');\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\treplaceParagraphsToBr: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = html.replace(/<p\\s(.*?)>/gi, '<p>');\n\t\t\t\t\thtml = html.replace(/<p><br\\s?\\/?><\\/p>/gi, '<br />');\n\t\t\t\t\thtml = html.replace(/<p>([\\w\\W]*?)<\\/p>/gi, '$1<br /><br />');\n\t\t\t\t\thtml = html.replace(/(<br\\s?\\/?>){1,}\\n?<\\/blockquote>/gi, '</blockquote>');\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tsaveFormTags: function(html)\n\t\t\t\t{\n\t\t\t\t\treturn html.replace(/<form(.*?)>([\\w\\W]*?)<\\/form>/gi, '<section$1 rel=\"redactor-form-tag\">$2</section>');\n\t\t\t\t},\n\t\t\t\trestoreFormTags: function(html)\n\t\t\t\t{\n\t\t\t\t\treturn html.replace(/<section(.*?) rel=\"redactor-form-tag\"(.*?)>([\\w\\W]*?)<\\/section>/gi, '<form$1$2>$3</form>');\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tcode: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tset: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = $.trim(html.toString());\n\n\t\t\t\t\t// clean\n\t\t\t\t\thtml = this.clean.onSet(html);\n\n\t\t\t\t\tthis.$editor.html(html);\n\t\t\t\t\tthis.code.sync();\n\n\t\t\t\t\tif (html !== '') this.placeholder.remove();\n\n\t\t\t\t\tsetTimeout($.proxy(this.buffer.add, this), 15);\n\t\t\t\t\tif (this.start === false) this.observe.load();\n\n\t\t\t\t},\n\t\t\t\tget: function()\n\t\t\t\t{\n\t\t\t\t\tvar code = this.$textarea.val();\n\n\t\t\t\t\t// indent code\n\t\t\t\t\tcode = this.tabifier.get(code);\n\n\t\t\t\t\treturn code;\n\t\t\t\t},\n\t\t\t\tsync: function()\n\t\t\t\t{\n\t\t\t\t\tsetTimeout($.proxy(this.code.startSync, this), 10);\n\t\t\t\t},\n\t\t\t\tstartSync: function()\n\t\t\t\t{\n\t\t\t\t\tvar html = this.$editor.html();\n\n\t\t\t\t\t// is there a need to synchronize\n\t\t\t\t\tif (this.code.syncCode && this.code.syncCode == html)\n\t\t\t\t\t{\n\t\t\t\t\t\t// do not sync\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// save code\n\t\t\t\t\tthis.code.syncCode = html;\n\n\t\t\t\t\t// before clean callback\n\t\t\t\t\thtml = this.core.setCallback('syncBefore', html);\n\n\t\t\t\t\t// clean\n\t\t\t\t\thtml = this.clean.onSync(html);\n\n\t\t\t\t\t// set code\n\t\t\t\t\tthis.$textarea.val(html);\n\n\t\t\t\t\t// after sync callback\n\t\t\t\t\tthis.core.setCallback('sync', html);\n\n\t\t\t\t\tif (this.start === false)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.setCallback('change', html);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.start = false;\n\n\t\t\t\t\tif (this.autosave.html == false)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.autosave.html = this.code.get();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.opts.codemirror)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$textarea.next('.CodeMirror').each(function(i, el)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tel.CodeMirror.setValue(html);\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t//autosave\n\t\t\t\t\tthis.autosave.onChange();\n\t\t\t\t\tthis.autosave.enable();\n\t\t\t\t},\n\t\t\t\ttoggle: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.visual)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.code.showCode();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.code.showVisual();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tshowCode: function()\n\t\t\t\t{\n\t\t\t\t\tthis.code.offset = this.caret.getOffset();\n\t\t\t\t\tvar scroll = $(window).scrollTop();\n\n\t\t\t\t\tvar\twidth = this.$editor.innerWidth(),\n\t\t\t\t\t\theight = this.$editor.innerHeight();\n\n\t\t\t\t\tthis.$editor.hide();\n\n\t\t\t\t\tvar html = this.$textarea.val();\n\t\t\t\t\tthis.modified = this.clean.removeSpaces(html);\n\n\t\t\t\t\t// indent code\n\t\t\t\t\thtml = this.tabifier.get(html);\n\n\t\t\t\t\tthis.$textarea.val(html);\n\n\t\t\t\t\tif (this.opts.codemirror)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$textarea.next('.CodeMirror').each(function(i, el)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(el).show();\n\t\t\t\t\t\t\tel.CodeMirror.setValue(html);\n\t\t\t\t\t\t\tel.CodeMirror.setSize(width, height);\n\t\t\t\t\t\t\tel.CodeMirror.refresh();\n\t\t\t\t\t\t\tel.CodeMirror.focus();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$textarea.height(height).show().focus();\n\t\t\t\t\t\tthis.$textarea.on('keydown.redactor-textarea-indenting', this.code.textareaIndenting);\n\n\t\t\t\t\t\t$(window).scrollTop(scroll);\n\n\t\t\t\t\t\tif (this.$textarea[0].setSelectionRange)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.$textarea[0].setSelectionRange(0, 0);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.$textarea[0].scrollTop = 0;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.opts.visual = false;\n\n\t\t\t\t\tthis.button.setInactiveInCode();\n\t\t\t\t\tthis.button.setActive('html');\n\t\t\t\t\tthis.core.setCallback('source', html);\n\t\t\t\t},\n\t\t\t\tshowVisual: function()\n\t\t\t\t{\n\t\t\t\t\tvar html;\n\n\t\t\t\t\tif (this.opts.visual) return;\n\n\t\t\t\t\tif (this.opts.codemirror)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$textarea.next('.CodeMirror').each(function(i, el)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\thtml = el.CodeMirror.getValue();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.$textarea.hide().val();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.modified !== this.clean.removeSpaces(html))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.code.set(html);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.opts.codemirror)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$textarea.next('.CodeMirror').hide();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.$editor.show();\n\n\t\t\t\t\tif (!this.utils.isEmpty(html))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.placeholder.remove();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.caret.setOffset(this.code.offset);\n\n\t\t\t\t\tthis.$textarea.off('keydown.redactor-textarea-indenting');\n\n\t\t\t\t\tthis.button.setActiveInVisual();\n\t\t\t\t\tthis.button.setInactive('html');\n\n\t\t\t\t\tthis.observe.load();\n\t\t\t\t\tthis.opts.visual = true;\n\t\t\t\t\tthis.core.setCallback('visual', html);\n\t\t\t\t},\n\t\t\t\ttextareaIndenting: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (e.keyCode !== 9) return true;\n\n\t\t\t\t\tvar $el = this.$textarea;\n\t\t\t\t\tvar start = $el.get(0).selectionStart;\n\t\t\t\t\t$el.val($el.val().substring(0, start) + \"\\t\" + $el.val().substring($el.get(0).selectionEnd));\n\t\t\t\t\t$el.get(0).selectionStart = $el.get(0).selectionEnd = start + 1;\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tcore: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tgetObject: function()\n\t\t\t\t{\n\t\t\t\t\treturn $.extend({}, this);\n\t\t\t\t},\n\t\t\t\tgetEditor: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.$editor;\n\t\t\t\t},\n\t\t\t\tgetBox: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.$box;\n\t\t\t\t},\n\t\t\t\tgetElement: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.$element;\n\t\t\t\t},\n\t\t\t\tgetTextarea: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.$textarea;\n\t\t\t\t},\n\t\t\t\tgetToolbar: function()\n\t\t\t\t{\n\t\t\t\t\treturn (this.$toolbar) ? this.$toolbar : false;\n\t\t\t\t},\n\t\t\t\taddEvent: function(name)\n\t\t\t\t{\n\t\t\t\t\tthis.core.event = name;\n\t\t\t\t},\n\t\t\t\tgetEvent: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.core.event;\n\t\t\t\t},\n\t\t\t\tsetCallback: function(type, e, data)\n\t\t\t\t{\n\t\t\t\t\tvar callback = this.opts[type + 'Callback'];\n\t\t\t\t\tif ($.isFunction(callback))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn (typeof data == 'undefined') ? callback.call(this, e) : callback.call(this, e, data);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treturn (typeof data == 'undefined') ? e : data;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tdestroy: function()\n\t\t\t\t{\n\t\t\t\t\tthis.core.setCallback('destroy');\n\n\t\t\t\t\t// off events and remove data\n\t\t\t\t\tthis.$element.off('.redactor').removeData('redactor');\n\t\t\t\t\tthis.$editor.off('.redactor');\n\n\t\t\t\t\t$(document).off('click.redactor-image-delete.' + this.uuid);\n\t\t\t\t\t$(document).off('click.redactor-image-resize-hide.' + this.uuid);\n\t\t\t\t\t$(document).off('touchstart.redactor.' + this.uuid + ' click.redactor.' + this.uuid);\n\t\t\t\t\t$(\"body\").off('scroll.redactor.' + this.uuid);\n\t\t\t\t\t$(this.opts.toolbarFixedTarget).off('scroll.redactor.' + this.uuid);\n\n\t\t\t\t\t// common\n\t\t\t\t\tthis.$editor.removeClass('redactor-editor redactor-linebreaks redactor-placeholder');\n\t\t\t\t\tthis.$editor.removeAttr('contenteditable');\n\n\t\t\t\t\tvar html = this.code.get();\n\n\t\t\t\t\t// dropdowns off\n\t\t\t\t\tthis.$toolbar.find('a').each(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $el = $(this);\n\t\t\t\t\t\tif ($el.data('dropdown'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$el.data('dropdown').remove();\n\t\t\t\t\t\t\t$el.data('dropdown', {});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\n\t\t\t\t\tif (this.build.isTextarea())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$box.after(this.$element);\n\t\t\t\t\t\tthis.$box.remove();\n\t\t\t\t\t\tthis.$element.val(html).show();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$box.after(this.$editor);\n\t\t\t\t\t\tthis.$box.remove();\n\t\t\t\t\t\tthis.$element.html(html).show();\n\t\t\t\t\t}\n\n\t\t\t\t\t// paste box\n\t\t\t\t\tif (this.$pasteBox) this.$pasteBox.remove();\n\n\t\t\t\t\t// modal\n\t\t\t\t\tif (this.$modalBox) this.$modalBox.remove();\n\t\t\t\t\tif (this.$modalOverlay) this.$modalOverlay.remove();\n\n\t\t\t\t\t// buttons tooltip\n\t\t\t\t\t$('.redactor-toolbar-tooltip').remove();\n\n\t\t\t\t\t// autosave\n\t\t\t\t\tclearInterval(this.autosaveInterval);\n\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tdropdown: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tbuild: function(name, $dropdown, dropdownObject)\n\t\t\t\t{\n\t\t\t\t\tif (name == 'formatting' && this.opts.formattingAdd)\n\t\t\t\t\t{\n\t\t\t\t\t\t$.each(this.opts.formattingAdd, $.proxy(function(i,s)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar name = s.tag,\n\t\t\t\t\t\t\t\tfunc;\n\n\t\t\t\t\t\t\tif (typeof s['class'] != 'undefined')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tname = name + '-' + s['class'];\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\ts.type = (this.utils.isBlockTag(s.tag)) ? 'block' : 'inline';\n\n\t\t\t\t\t\t\tif (typeof s.func !== \"undefined\")\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfunc = s.func;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfunc = (s.type == 'inline') ? 'inline.formatting' : 'block.formatting';\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (this.opts.linebreaks && s.type == 'block' && s.tag == 'p') return;\n\n\t\t\t\t\t\t\tthis.formatting[name] = {\n\t\t\t\t\t\t\t\ttag: s.tag,\n\t\t\t\t\t\t\t\tstyle: s.style,\n\t\t\t\t\t\t\t\t'class': s['class'],\n\t\t\t\t\t\t\t\tattr: s.attr,\n\t\t\t\t\t\t\t\tdata: s.data,\n\t\t\t\t\t\t\t\tclear: s.clear\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\tdropdownObject[name] = {\n\t\t\t\t\t\t\t\tfunc: func,\n\t\t\t\t\t\t\t\ttitle: s.title\n\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t}, this));\n\n\t\t\t\t\t}\n\n\t\t\t\t\t$.each(dropdownObject, $.proxy(function(btnName, btnObject)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $item = $('<a href=\"#\" class=\"redactor-dropdown-' + btnName + '\">' + btnObject.title + '</a>');\n\t\t\t\t\t\tif (name == 'formatting') $item.addClass('redactor-formatting-' + btnName);\n\n\t\t\t\t\t\t$item.on('click', $.proxy(function(e)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t\tvar type = 'func';\n\t\t\t\t\t\t\tvar callback = btnObject.func;\n\t\t\t\t\t\t\tif (btnObject.command)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttype = 'command';\n\t\t\t\t\t\t\t\tcallback = btnObject.command;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (btnObject.dropdown)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttype = 'dropdown';\n\t\t\t\t\t\t\t\tcallback = btnObject.dropdown;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.button.onClick(e, btnName, type, callback);\n\t\t\t\t\t\t\tthis.dropdown.hideAll();\n\n\t\t\t\t\t\t}, this));\n\n\t\t\t\t\t\t$dropdown.append($item);\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tshow: function(e, key)\n\t\t\t\t{\n\t\t\t\t\tif (!this.opts.visual)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $button = this.button.get(key);\n\n\t\t\t\t\t// Always re-append it to the end of <body> so it always has the highest sub-z-index.\n\t\t\t\t\tvar $dropdown = $button.data('dropdown').appendTo(document.body);\n\n\t\t\t\t\t// ios keyboard hide\n\t\t\t\t\tif (this.utils.isMobile() && !this.utils.browser('msie'))\n\t\t\t\t\t{\n\t\t\t\t\t\tdocument.activeElement.blur();\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($button.hasClass('dropact'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dropdown.hideAll();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.dropdown.hideAll();\n\t\t\t\t\t\tthis.core.setCallback('dropdownShow', { dropdown: $dropdown, key: key, button: $button });\n\n\t\t\t\t\t\tthis.button.setActive(key);\n\n\t\t\t\t\t\t$button.addClass('dropact');\n\n\t\t\t\t\t\tvar keyPosition = $button.offset();\n\n\t\t\t\t\t\t// fix right placement\n\t\t\t\t\t\tvar dropdownWidth = $dropdown.width();\n\t\t\t\t\t\tif ((keyPosition.left + dropdownWidth) > $(document).width())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tkeyPosition.left = Math.max(0, keyPosition.left - dropdownWidth);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar left = keyPosition.left + 'px';\n\t\t\t\t\t\tif (this.$toolbar.hasClass('toolbar-fixed-box'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar top = this.$toolbar.innerHeight() + this.opts.toolbarFixedTopOffset;\n\t\t\t\t\t\t\tvar position = 'fixed';\n\t\t\t\t\t\t\tif (this.opts.toolbarFixedTarget !== document)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttop = (this.$toolbar.innerHeight() + this.$toolbar.offset().top) + this.opts.toolbarFixedTopOffset;\n\t\t\t\t\t\t\t\tposition = 'absolute';\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$dropdown.css({ position: position, left: left, top: top + 'px' }).show();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar top = ($button.innerHeight() + keyPosition.top) + 'px';\n\n\t\t\t\t\t\t\t$dropdown.css({ position: 'absolute', left: left, top: top }).show();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.core.setCallback('dropdownShown', { dropdown: $dropdown, key: key, button: $button });\n\t\t\t\t\t}\n\n\t\t\t\t\t$(document).one('click', $.proxy(this.dropdown.hide, this));\n\t\t\t\t\tthis.$editor.one('click', $.proxy(this.dropdown.hide, this));\n\n\t\t\t\t\t// disable scroll whan dropdown scroll\n\t\t\t\t\tvar $body = $(document.body);\n\t\t\t\t\tvar width = $body.width();\n\n\t\t\t\t\t$dropdown.on('mouseover', function() {\n\n\t\t\t\t\t\t$body.addClass('body-redactor-hidden');\n\t\t\t\t\t\t$body.css('margin-right', ($body.width() - width) + 'px');\n\n\t\t\t\t\t });\n\n\t\t\t\t\t$dropdown.on('mouseout', function() {\n\n\t\t\t\t\t\t$body.removeClass('body-redactor-hidden').css('margin-right', 0);\n\n\t\t\t\t\t});\n\n\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t},\n\t\t\t\thideAll: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$toolbar.find('a.dropact').removeClass('redactor-act').removeClass('dropact');\n\n\t\t\t\t\t$(document.body).removeClass('body-redactor-hidden').css('margin-right', 0);\n\t\t\t\t\t$('.redactor-dropdown-' + this.uuid).hide();\n\t\t\t\t\tthis.core.setCallback('dropdownHide');\n\t\t\t\t},\n\t\t\t\thide: function (e)\n\t\t\t\t{\n\t\t\t\t\tvar $dropdown = $(e.target);\n\t\t\t\t\tif (!$dropdown.hasClass('dropact'))\n\t\t\t\t\t{\n\t\t\t\t\t\t$dropdown.removeClass('dropact');\n\t\t\t\t\t\tthis.dropdown.hideAll();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tfile: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tshow: function()\n\t\t\t\t{\n\t\t\t\t\tthis.modal.load('file', this.lang.get('file'), 700);\n\t\t\t\t\tthis.upload.init('#redactor-modal-file-upload', this.opts.fileUpload, this.file.insert);\n\n\t\t\t\t\tthis.selection.save();\n\n\t\t\t\t\tthis.selection.get();\n\t\t\t\t\tvar text = this.sel.toString();\n\n\t\t\t\t\t$('#redactor-filename').val(text);\n\n\t\t\t\t\tthis.modal.show();\n\t\t\t\t},\n\t\t\t\tinsert: function(json, direct, e)\n\t\t\t\t{\n\t\t\t\t\t// error callback\n\t\t\t\t\tif (typeof json.error != 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.modal.close();\n\t\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\t\tthis.core.setCallback('fileUploadError', json);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar link;\n\t\t\t\t\tif (typeof json == 'string')\n\t\t\t\t\t{\n\t\t\t\t\t\tlink = json;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tvar text = $('#redactor-filename').val();\n\t\t\t\t\t\tif (typeof text == 'undefined' || text === '') text = json.filename;\n\n\t\t\t\t\t\tlink = '<a href=\"' + json.filelink + '\" id=\"filelink-marker\">' + text + '</a>';\n\t\t\t\t\t}\n\n\t\t\t\t\tif (direct)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.selection.removeMarkers();\n\t\t\t\t\t\tvar marker = this.selection.getMarker();\n\t\t\t\t\t\tthis.insert.nodeToCaretPositionFromPoint(e, marker);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.modal.close();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\tthis.insert.htmlWithoutClean(link);\n\n\t\t\t\t\tif (typeof json == 'string') return;\n\n\t\t\t\t\tvar linkmarker = $(this.$editor.find('a#filelink-marker'));\n\t\t\t\t\tif (linkmarker.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tlinkmarker.removeAttr('id').removeAttr('style');\n\t\t\t\t\t}\n\t\t\t\t\telse linkmarker = false;\n\n\t\t\t\t\tthis.core.setCallback('fileUpload', linkmarker, json);\n\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tfocus: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tsetStart: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$editor.focus();\n\n\t\t\t\t\tvar first = this.$editor.children().first();\n\n\t\t\t\t\tif (first.length === 0) return;\n\t\t\t\t\tif (first[0].length === 0 || first[0].tagName == 'BR' || first[0].nodeType == 3)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (first[0].tagName == 'UL' || first[0].tagName == 'OL')\n\t\t\t\t\t{\n\t\t\t\t\t\tvar child = first.find('li').first();\n\t\t\t\t\t\tif (!this.utils.isBlock(child) && child.text() === '')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t// empty inline tag in li\n\t\t\t\t\t\t\tthis.caret.setStart(child);\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.opts.linebreaks && !this.utils.isBlockTag(first[0].tagName))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.selection.get();\n\t\t\t\t\t\tthis.range.setStart(this.$editor[0], 0);\n\t\t\t\t\t\tthis.range.setEnd(this.$editor[0], 0);\n\t\t\t\t\t\tthis.selection.addRange();\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// if node is tag\n\t\t\t\t\tthis.caret.setStart(first);\n\t\t\t\t},\n\t\t\t\tsetEnd: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.utils.browser('mozilla') || this.utils.browser('msie'))\n\t\t\t\t\t{\n\t\t\t\t\t\tvar last = this.$editor.children().last();\n\n\t\t\t\t\t\tthis.$editor.focus();\n\t\t\t\t\t\tthis.caret.setEnd(last);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.selection.get();\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tthis.range.selectNodeContents(this.$editor[0]);\n\t\t\t\t\t\t\tthis.range.collapse(false);\n\n\t\t\t\t\t\t\tthis.selection.addRange();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcatch (e) {}\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tisFocused: function()\n\t\t\t\t{\n\t\t\t\t\tvar focusNode = document.getSelection().focusNode;\n\t\t\t\t\tif (focusNode === null) return false;\n\n\t\t\t\t\tif (this.opts.linebreaks && $(focusNode.parentNode).hasClass('redactor-linebreaks')) return true;\n\t\t\t\t\telse if (!this.utils.isRedactorParent(focusNode.parentNode)) return false;\n\n\t\t\t\t\treturn this.$editor.is(':focus');\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\timage: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tshow: function()\n\t\t\t\t{\n\t\t\t\t\tthis.modal.load('image', this.lang.get('image'), 700);\n\t\t\t\t\tthis.upload.init('#redactor-modal-image-droparea', this.opts.imageUpload, this.image.insert);\n\n\t\t\t\t\tthis.selection.save();\n\t\t\t\t\tthis.modal.show();\n\n\t\t\t\t},\n\t\t\t\tshowEdit: function($image)\n\t\t\t\t{\n\t\t\t\t\tvar $link = $image.closest('a', this.$editor[0]);\n\n\t\t\t\t\tthis.modal.load('imageEdit', this.lang.get('edit'), 705);\n\n\t\t\t\t\tthis.modal.createCancelButton();\n\t\t\t\t\tthis.image.buttonDelete = this.modal.createDeleteButton(this.lang.get('_delete'));\n\t\t\t\t\tthis.image.buttonSave = this.modal.createActionButton(this.lang.get('save'));\n\n\t\t\t\t\tthis.image.buttonDelete.on('click', $.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.image.remove($image);\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\tthis.image.buttonSave.on('click', $.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.image.update($image);\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\t$('#redactor-image-title').val($image.attr('alt'));\n\n\t\t\t\t\tif (!this.opts.imageLink) $('.redactor-image-link-option').hide();\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $redactorImageLink = $('#redactor-image-link');\n\n\t\t\t\t\t\t$redactorImageLink.attr('href', $image.attr('src'));\n\t\t\t\t\t\tif ($link.length !== 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$redactorImageLink.val($link.attr('href'));\n\t\t\t\t\t\t\tif ($link.attr('target') == '_blank') $('#redactor-image-link-blank').prop('checked', true);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this.opts.imagePosition) $('.redactor-image-position-option').hide();\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tvar floatValue = ($image.css('display') == 'block' && $image.css('float') == 'none') ? 'center' : $image.css('float');\n\t\t\t\t\t\t$('#redactor-image-align').val(floatValue);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.modal.show();\n\n\t\t\t\t},\n\t\t\t\tsetFloating: function($image)\n\t\t\t\t{\n\t\t\t\t\tvar floating = $('#redactor-image-align').val();\n\n\t\t\t\t\tvar imageFloat = '';\n\t\t\t\t\tvar imageDisplay = '';\n\t\t\t\t\tvar imageMargin = '';\n\n\t\t\t\t\tswitch (floating)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase 'left':\n\t\t\t\t\t\t\timageFloat = 'left';\n\t\t\t\t\t\t\timageMargin = '0 ' + this.opts.imageFloatMargin + ' ' + this.opts.imageFloatMargin + ' 0';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'right':\n\t\t\t\t\t\t\timageFloat = 'right';\n\t\t\t\t\t\t\timageMargin = '0 0 ' + this.opts.imageFloatMargin + ' ' + this.opts.imageFloatMargin;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'center':\n\t\t\t\t\t\t\timageDisplay = 'block';\n\t\t\t\t\t\t\timageMargin = 'auto';\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\t$image.css({ 'float': imageFloat, display: imageDisplay, margin: imageMargin });\n\t\t\t\t\t$image.attr('rel', $image.attr('style'));\n\t\t\t\t},\n\t\t\t\tupdate: function($image)\n\t\t\t\t{\n\t\t\t\t\tthis.image.hideResize();\n\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\tvar $link = $image.closest('a', this.$editor[0]);\n\n\t\t\t\t\t$image.attr('alt', $('#redactor-image-title').val());\n\n\t\t\t\t\tthis.image.setFloating($image);\n\n\t\t\t\t\t// as link\n\t\t\t\t\tvar link = $.trim($('#redactor-image-link').val());\n\t\t\t\t\tif (link !== '')\n\t\t\t\t\t{\n\t\t\t\t\t\t// test url (add protocol)\n\t\t\t\t\t\tvar pattern = '((xn--)?[a-z0-9]+(-[a-z0-9]+)*\\\\.)+[a-z]{2,}';\n\t\t\t\t\t\tvar re = new RegExp('^(http|ftp|https)://' + pattern, 'i');\n\t\t\t\t\t\tvar re2 = new RegExp('^' + pattern, 'i');\n\n\t\t\t\t\t\tif (link.search(re) == -1 && link.search(re2) === 0 && this.opts.linkProtocol)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlink = this.opts.linkProtocol + '://' + link;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar target = ($('#redactor-image-link-blank').prop('checked')) ? true : false;\n\n\t\t\t\t\t\tif ($link.length === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar a = $('<a href=\"' + link + '\">' + this.utils.getOuterHtml($image) + '</a>');\n\t\t\t\t\t\t\tif (target) a.attr('target', '_blank');\n\n\t\t\t\t\t\t\t$image.replaceWith(a);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$link.attr('href', link);\n\t\t\t\t\t\t\tif (target)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$link.attr('target', '_blank');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$link.removeAttr('target');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if ($link.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$link.replaceWith(this.utils.getOuterHtml($image));\n\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.modal.close();\n\t\t\t\t\tthis.observe.images();\n\t\t\t\t\tthis.code.sync();\n\n\n\t\t\t\t},\n\t\t\t\tsetEditable: function($image)\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.imageEditable)\n\t\t\t\t\t{\n\t\t\t\t\t\t$image.on('dragstart', $.proxy(this.image.onDrag, this));\n\t\t\t\t\t}\n\n\t\t\t\t\t$image.on('mousedown', $.proxy(this.image.hideResize, this));\n\t\t\t\t\t$image.on('click.redactor touchstart', $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.observe.image = $image;\n\n\t\t\t\t\t\tif (this.$editor.find('#redactor-image-box').length !== 0) return false;\n\n\t\t\t\t\t\tthis.image.resizer = this.image.loadEditableControls($image);\n\n\t\t\t\t\t\t$(document).on('click.redactor-image-resize-hide.' + this.uuid, $.proxy(this.image.hideResize, this));\n\t\t\t\t\t\tthis.$editor.on('click.redactor-image-resize-hide.' + this.uuid, $.proxy(this.image.hideResize, this));\n\n\t\t\t\t\t\t// resize\n\t\t\t\t\t\tif (!this.opts.imageResizable) return;\n\n\t\t\t\t\t\tthis.image.resizer.on('mousedown.redactor touchstart.redactor', $.proxy(function(e)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.image.setResizable(e, $image);\n\t\t\t\t\t\t}, this));\n\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tsetResizable: function(e, $image)\n\t\t\t\t{\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t    this.image.resizeHandle = {\n\t\t\t\t        x : e.pageX,\n\t\t\t\t        y : e.pageY,\n\t\t\t\t        el : $image,\n\t\t\t\t        ratio: $image.width() / $image.height(),\n\t\t\t\t        h: $image.height()\n\t\t\t\t    };\n\n\t\t\t\t    e = e.originalEvent || e;\n\n\t\t\t\t    if (e.targetTouches)\n\t\t\t\t    {\n\t\t\t\t         this.image.resizeHandle.x = e.targetTouches[0].pageX;\n\t\t\t\t         this.image.resizeHandle.y = e.targetTouches[0].pageY;\n\t\t\t\t    }\n\n\t\t\t\t\tthis.image.startResize();\n\n\n\t\t\t\t},\n\t\t\t\tstartResize: function()\n\t\t\t\t{\n\t\t\t\t\t$(document).on('mousemove.redactor-image-resize touchmove.redactor-image-resize', $.proxy(this.image.moveResize, this));\n\t\t\t\t\t$(document).on('mouseup.redactor-image-resize touchend.redactor-image-resize', $.proxy(this.image.stopResize, this));\n\t\t\t\t},\n\t\t\t\tmoveResize: function(e)\n\t\t\t\t{\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\te = e.originalEvent || e;\n\n\t\t\t\t\tvar height = this.image.resizeHandle.h;\n\n\t\t            if (e.targetTouches) height += (e.targetTouches[0].pageY -  this.image.resizeHandle.y);\n\t\t            else height += (e.pageY -  this.image.resizeHandle.y);\n\n\t\t\t\t\tvar width = Math.round(height * this.image.resizeHandle.ratio);\n\n\t\t\t\t\tif (height < 50 || width < 100) return;\n\n\t\t\t\t\tvar height = Math.round(this.image.resizeHandle.el.width() / this.image.resizeHandle.ratio);\n\n\t\t\t\t\tthis.image.resizeHandle.el.attr({width: width, height: height});\n\t\t            this.image.resizeHandle.el.width(width);\n\t\t            this.image.resizeHandle.el.height(height);\n\n\t\t            this.code.sync();\n\t\t\t\t},\n\t\t\t\tstopResize: function()\n\t\t\t\t{\n\t\t\t\t\tthis.handle = false;\n\t\t\t\t\t$(document).off('.redactor-image-resize');\n\n\t\t\t\t\tthis.image.hideResize();\n\t\t\t\t},\n\t\t\t\tonDrag: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (this.$editor.find('#redactor-image-box').length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.$editor.on('drop.redactor-image-inside-drop', $.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tsetTimeout($.proxy(this.image.onDrop, this), 1);\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tonDrop: function()\n\t\t\t\t{\n\t\t\t\t\tthis.image.fixImageSourceAfterDrop();\n\t\t\t\t\tthis.observe.images();\n\t\t\t\t\tthis.$editor.off('drop.redactor-image-inside-drop');\n\t\t\t\t\tthis.clean.clearUnverified();\n\t\t\t\t\tthis.code.sync();\n\t\t\t\t},\n\t\t\t\tfixImageSourceAfterDrop: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$editor.find('img[data-save-url]').each(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $el = $(this);\n\t\t\t\t\t\t$el.attr('src', $el.attr('data-save-url'));\n\t\t\t\t\t\t$el.removeAttr('data-save-url');\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\thideResize: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (e && $(e.target).closest('#redactor-image-box', this.$editor[0]).length !== 0) return;\n\t\t\t\t\tif (e && e.target.tagName == 'IMG')\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $image = $(e.target);\n\t\t\t\t\t\t$image.attr('data-save-url', $image.attr('src'));\n\t\t\t\t\t}\n\n\t\t\t\t\tvar imageBox = this.$editor.find('#redactor-image-box');\n\t\t\t\t\tif (imageBox.length === 0) return;\n\n\t\t\t\t\tif (this.opts.imageEditable)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.image.editter.remove();\n\t\t\t\t\t}\n\n\t\t\t\t\t$(this.image.resizer).remove();\n\n\t\t\t\t\timageBox.find('img').css({\n\t\t\t\t\t\tmarginTop: imageBox[0].style.marginTop,\n\t\t\t\t\t\tmarginBottom: imageBox[0].style.marginBottom,\n\t\t\t\t\t\tmarginLeft: imageBox[0].style.marginLeft,\n\t\t\t\t\t\tmarginRight: imageBox[0].style.marginRight\n\t\t\t\t\t});\n\n\t\t\t\t\timageBox.css('margin', '');\n\t\t\t\t\timageBox.find('img').css('opacity', '');\n\t\t\t\t\timageBox.replaceWith(function()\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $(this).contents();\n\t\t\t\t\t});\n\n\t\t\t\t\t$(document).off('click.redactor-image-resize-hide.' + this.uuid);\n\t\t\t\t\tthis.$editor.off('click.redactor-image-resize-hide.' + this.uuid);\n\n\t\t\t\t\tif (typeof this.image.resizeHandle !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.image.resizeHandle.el.attr('rel', this.image.resizeHandle.el.attr('style'));\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.code.sync();\n\n\t\t\t\t},\n\t\t\t\tloadResizableControls: function($image, imageBox)\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.imageResizable && !this.utils.isMobile())\n\t\t\t\t\t{\n\t\t\t\t\t\tvar imageResizer = $('<span id=\"redactor-image-resizer\" data-redactor=\"verified\"></span>');\n\n\t\t\t\t\t\tif (!this.utils.isDesktop())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\timageResizer.css({ width: '15px', height: '15px' });\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\timageResizer.attr('contenteditable', false);\n\t\t\t\t\t\timageBox.append(imageResizer);\n\t\t\t\t\t\timageBox.append($image);\n\n\t\t\t\t\t\treturn imageResizer;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\timageBox.append($image);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tloadEditableControls: function($image)\n\t\t\t\t{\n\t\t\t\t\tvar imageBox = $('<span id=\"redactor-image-box\" data-redactor=\"verified\">');\n\t\t\t\t\timageBox.css('float', $image.css('float')).attr('contenteditable', false);\n\n\t\t\t\t\tif ($image[0].style.margin != 'auto')\n\t\t\t\t\t{\n\t\t\t\t\t\timageBox.css({\n\t\t\t\t\t\t\tmarginTop: $image[0].style.marginTop,\n\t\t\t\t\t\t\tmarginBottom: $image[0].style.marginBottom,\n\t\t\t\t\t\t\tmarginLeft: $image[0].style.marginLeft,\n\t\t\t\t\t\t\tmarginRight: $image[0].style.marginRight\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t$image.css('margin', '');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\timageBox.css({ 'display': 'block', 'margin': 'auto' });\n\t\t\t\t\t}\n\n\t\t\t\t\t$image.css('opacity', '.5').after(imageBox);\n\n\n\t\t\t\t\tif (this.opts.imageEditable)\n\t\t\t\t\t{\n\t\t\t\t\t\t// editter\n\t\t\t\t\t\tthis.image.editter = $('<span id=\"redactor-image-editter\" data-redactor=\"verified\">' + this.lang.get('edit') + '</span>');\n\t\t\t\t\t\tthis.image.editter.attr('contenteditable', false);\n\t\t\t\t\t\tthis.image.editter.on('click', $.proxy(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.image.showEdit($image);\n\t\t\t\t\t\t}, this));\n\n\t\t\t\t\t\timageBox.append(this.image.editter);\n\n\t\t\t\t\t\t// position correction\n\t\t\t\t\t\tvar editerWidth = this.image.editter.innerWidth();\n\t\t\t\t\t\tthis.image.editter.css('margin-left', '-' + editerWidth/2 + 'px');\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.image.loadResizableControls($image, imageBox);\n\n\t\t\t\t},\n\t\t\t\tremove: function(image)\n\t\t\t\t{\n\t\t\t\t\tvar $image = $(image);\n\t\t\t\t\tvar $link = $image.closest('a', this.$editor[0]);\n\t\t\t\t\tvar $figure = $image.closest('figure', this.$editor[0]);\n\t\t\t\t\tvar $parent = $image.parent();\n\t\t\t\t\tif ($('#redactor-image-box').length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$parent = $('#redactor-image-box').parent();\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $next;\n\t\t\t\t\tif ($figure.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$next = $figure.next();\n\t\t\t\t\t\t$figure.remove();\n\t\t\t\t\t}\n\t\t\t\t\telse if ($link.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$parent = $link.parent();\n\t\t\t\t\t\t$link.remove();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t$image.remove();\n\t\t\t\t\t}\n\n\t\t\t\t\t$('#redactor-image-box').remove();\n\n\t\t\t\t\tif ($figure.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.caret.setStart($next);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.caret.setStart($parent);\n\t\t\t\t\t}\n\n\t\t\t\t\t// delete callback\n\t\t\t\t\tthis.core.setCallback('imageDelete', $image[0].src, $image);\n\n\t\t\t\t\tthis.modal.close();\n\t\t\t\t\tthis.code.sync();\n\t\t\t\t},\n\t\t\t\tinsert: function(json, direct, e)\n\t\t\t\t{\n\t\t\t\t\t// error callback\n\t\t\t\t\tif (typeof json.error != 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.modal.close();\n\t\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\t\tthis.core.setCallback('imageUploadError', json);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $img;\n\t\t\t\t\tif (typeof json == 'string')\n\t\t\t\t\t{\n\t\t\t\t\t\t$img = $(json).attr('data-redactor-inserted-image', 'true');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t$img = $('<img>');\n\t\t\t\t\t\t$img.attr('src', json.filelink).attr('data-redactor-inserted-image', 'true');\n\t\t\t\t\t}\n\n\n\t\t\t\t\tvar node = $img;\n\t\t\t\t\tvar isP = this.utils.isCurrentOrParent('P');\n\t\t\t\t\tif (isP)\n\t\t\t\t\t{\n\t\t\t\t\t\t// will replace\n\t\t\t\t\t\tnode = $('<blockquote />').append($img);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (direct)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.selection.removeMarkers();\n\t\t\t\t\t\tvar marker = this.selection.getMarker();\n\t\t\t\t\t\tthis.insert.nodeToCaretPositionFromPoint(e, marker);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.modal.close();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\tthis.insert.html(this.utils.getOuterHtml(node), false);\n\n\t\t\t\t\tvar $image = this.$editor.find('img[data-redactor-inserted-image=true]').removeAttr('data-redactor-inserted-image');\n\n\t\t\t\t\tif (isP)\n\t\t\t\t\t{\n\t\t\t\t\t\t$image.parent().contents().unwrap().wrap('<p />');\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.opts.linebreaks)\n\t\t\t\t\t{\n\t\t\t\t\t\t$image.before('<br>').after('<br>');\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof json == 'string') return;\n\n\t\t\t\t\tthis.core.setCallback('imageUpload', $image, json);\n\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tindent: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tincrease: function()\n\t\t\t\t{\n\t\t\t\t\t// focus\n\t\t\t\t\tif (!this.utils.browser('msie')) this.$editor.focus();\n\n\t\t\t\t\tthis.buffer.set();\n\t\t\t\t\tthis.selection.save();\n\n\t\t\t\t\tvar block = this.selection.getBlock();\n\n\t\t\t\t\tif (block && block.tagName == 'LI')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.indent.increaseLists();\n\t\t\t\t\t}\n\t\t\t\t\telse if (block === false && this.opts.linebreaks)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.indent.increaseText();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.indent.increaseBlocks();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\tthis.code.sync();\n\t\t\t\t},\n\t\t\t\tincreaseLists: function()\n\t\t\t\t{\n\t\t\t\t\tdocument.execCommand('indent');\n\n\t\t\t\t\tthis.indent.fixEmptyIndent();\n\t\t\t\t\tthis.clean.normalizeLists();\n\t\t\t\t\tthis.clean.clearUnverified();\n\t\t\t\t},\n\t\t\t\tincreaseBlocks: function()\n\t\t\t\t{\n\t\t\t\t\t$.each(this.selection.getBlocks(), $.proxy(function(i, elem)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (elem.tagName === 'TD' || elem.tagName === 'TH') return;\n\n\t\t\t\t\t\tvar $el = this.utils.getAlignmentElement(elem);\n\n\t\t\t\t\t\tvar left = this.utils.normalize($el.css('margin-left')) + this.opts.indentValue;\n\t\t\t\t\t\t$el.css('margin-left', left + 'px');\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tincreaseText: function()\n\t\t\t\t{\n\t\t\t\t\tvar wrapper = this.selection.wrap('div');\n\t\t\t\t\t$(wrapper).attr('data-tagblock', 'redactor');\n\t\t\t\t\t$(wrapper).css('margin-left', this.opts.indentValue + 'px');\n\t\t\t\t},\n\t\t\t\tdecrease: function()\n\t\t\t\t{\n\t\t\t\t\tthis.buffer.set();\n\t\t\t\t\tthis.selection.save();\n\n\t\t\t\t\tvar block = this.selection.getBlock();\n\t\t\t\t\tif (block && block.tagName == 'LI')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.indent.decreaseLists();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.indent.decreaseBlocks();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\tthis.code.sync();\n\t\t\t\t},\n\t\t\t\tdecreaseLists: function ()\n\t\t\t\t{\n\t\t\t\t\tdocument.execCommand('outdent');\n\n\t\t\t\t\tvar current = this.selection.getCurrent();\n\n\t\t\t\t\tvar $item = $(current).closest('li', this.$editor[0]);\n\t\t\t\t\tvar $parent = $item.parent();\n\t\t\t\t\tif ($item.length !== 0 && $parent.length !== 0 && $parent[0].tagName == 'LI')\n\t\t\t\t\t{\n\t\t\t\t\t\t$parent.after($item);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.indent.fixEmptyIndent();\n\n\t\t\t\t\tif (!this.opts.linebreaks && $item.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tdocument.execCommand('formatblock', false, 'p');\n\t\t\t\t\t\tthis.$editor.find('ul, ol, blockquote, p').each($.proxy(this.utils.removeEmpty, this));\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.clean.clearUnverified();\n\t\t\t\t},\n\t\t\t\tdecreaseBlocks: function()\n\t\t\t\t{\n\t\t\t\t\t$.each(this.selection.getBlocks(), $.proxy(function(i, elem)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $el = this.utils.getAlignmentElement(elem);\n\t\t\t\t\t\tvar left = this.utils.normalize($el.css('margin-left')) - this.opts.indentValue;\n\n\t\t\t\t\t\tif (left <= 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (this.opts.linebreaks && typeof($el.data('tagblock')) !== 'undefined')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$el.replaceWith($el.html() + '<br />');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$el.css('margin-left', '');\n\t\t\t\t\t\t\t\tthis.utils.removeEmptyAttr($el, 'style');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$el.css('margin-left', left + 'px');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tfixEmptyIndent: function()\n\t\t\t\t{\n\t\t\t\t\tvar block = this.selection.getBlock();\n\n\t\t\t\t\tif (this.range.collapsed && block && block.tagName == 'LI' && this.utils.isEmpty($(block).text()))\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $block = $(block);\n\t\t\t\t\t\t$block.find('span').not('.redactor-selection-marker').contents().unwrap();\n\t\t\t\t\t\t$block.append('<br>');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tinline: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tformatting: function(name)\n\t\t\t\t{\n\t\t\t\t\tvar type, value;\n\n\t\t\t\t\tif (typeof this.formatting[name].style != 'undefined') type = 'style';\n\t\t\t\t\telse if (typeof this.formatting[name]['class'] != 'undefined') type = 'class';\n\n\t\t\t\t\tif (type) value = this.formatting[name][type];\n\n\t\t\t\t\tthis.inline.format(this.formatting[name].tag, type, value);\n\n\t\t\t\t},\n\t\t\t\tformat: function(tag, type, value)\n\t\t\t\t{\n\t\t\t\t\t// Stop formatting pre and headers\n\t\t\t\t\tif (this.utils.isCurrentOrParent('PRE') || this.utils.isCurrentOrParentHeader()) return;\n\n\t\t\t\t\tvar tags = ['b', 'bold', 'i', 'italic', 'underline', 'strikethrough', 'deleted', 'superscript', 'subscript'];\n\t\t\t\t\tvar replaced = ['strong', 'strong', 'em', 'em', 'u', 'del', 'del', 'sup', 'sub'];\n\n\t\t\t\t\tfor (var i = 0; i < tags.length; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (tag == tags[i]) tag = replaced[i];\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.opts.allowedTags)\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($.inArray(tag, this.opts.allowedTags) == -1) return;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($.inArray(tag, this.opts.deniedTags) !== -1) return;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.inline.type = type || false;\n\t\t\t\t\tthis.inline.value = value || false;\n\n\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\tif (!this.utils.browser('msie'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$editor.focus();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.selection.get();\n\n\t\t\t\t\tif (this.range.collapsed)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.inline.formatCollapsed(tag);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.inline.formatMultiple(tag);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tformatCollapsed: function(tag)\n\t\t\t\t{\n\t\t\t\t\tvar current = this.selection.getCurrent();\n\t\t\t\t\tvar $parent = $(current).closest(tag + '[data-redactor-tag=' + tag + ']', this.$editor[0]);\n\n\t\t\t\t\t// inline there is\n\t\t\t\t\tif ($parent.length !== 0 && (this.inline.type != 'style' && $parent[0].tagName != 'SPAN'))\n\t\t\t\t\t{\n\t\t\t\t\t\t// remove empty\n\t\t\t\t\t\tif (this.utils.isEmpty($parent.text()))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.caret.setAfter($parent[0]);\n\n\t\t\t\t\t\t\t$parent.remove();\n\t\t\t\t\t\t\tthis.code.sync();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (this.utils.isEndOfElement($parent))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.caret.setAfter($parent[0]);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// create empty inline\n\t\t\t\t\tvar node = $('<' + tag + '>').attr('data-verified', 'redactor').attr('data-redactor-tag', tag);\n\t\t\t\t\tnode.html(this.opts.invisibleSpace);\n\n\t\t\t\t\tnode = this.inline.setFormat(node);\n\n\t\t\t\t\tvar node = this.insert.node(node);\n\t\t\t\t\tthis.caret.setEnd(node);\n\n\t\t\t\t\tthis.code.sync();\n\t\t\t\t},\n\t\t\t\tformatMultiple: function(tag)\n\t\t\t\t{\n\t\t\t\t\tthis.inline.formatConvert(tag);\n\n\t\t\t\t\tthis.selection.save();\n\t\t\t\t\tdocument.execCommand('strikethrough');\n\n\t\t\t\t\tthis.$editor.find('strike').each($.proxy(function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $el = $(s);\n\n\t\t\t\t\t\tthis.inline.formatRemoveSameChildren($el, tag);\n\n\t\t\t\t\t\tvar $span;\n\t\t\t\t\t\tif (this.inline.type)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$span = $('<span>').attr('data-redactor-tag', tag).attr('data-verified', 'redactor');\n\t\t\t\t\t\t\t$span = this.inline.setFormat($span);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$span = $('<' + tag + '>').attr('data-redactor-tag', tag).attr('data-verified', 'redactor');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$el.replaceWith($span.html($el.contents()));\n\n\t\t\t\t\t\tif (tag == 'span')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar $parent = $span.parent();\n\t\t\t\t\t\t\tif ($parent && $parent[0].tagName == 'SPAN' && this.inline.type == 'style')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar arr = this.inline.value.split(';');\n\n\t\t\t\t\t\t\t\tfor (var z = 0; z < arr.length; z++)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif (arr[z] === '') return;\n\t\t\t\t\t\t\t\t\tvar style = arr[z].split(':');\n\t\t\t\t\t\t\t\t\t$parent.css(style[0], '');\n\n\t\t\t\t\t\t\t\t\tif (this.utils.removeEmptyAttr($parent, 'style'))\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t$parent.replaceWith($parent.contents());\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\t// clear text decoration\n\t\t\t\t\tif (tag != 'span')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$editor.find(this.opts.inlineTags.join(', ')).each($.proxy(function(i,s)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar $el = $(s);\n\t\t\t\t\t\t\tvar property = $el.css('text-decoration');\n\t\t\t\t\t\t\tif (property == 'line-through')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$el.css('text-decoration', '');\n\t\t\t\t\t\t\t\tthis.utils.removeEmptyAttr($el, 'style');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, this));\n\t\t\t\t\t}\n\n\t\t\t\t\tif (tag != 'del')\n\t\t\t\t\t{\n\t\t\t\t\t\tvar _this = this;\n\t\t\t\t\t\tthis.$editor.find('inline').each(function(i,s)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t_this.utils.replaceToTag(s, 'del');\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\tthis.code.sync();\n\n\t\t\t\t},\n\t\t\t\tformatRemoveSameChildren: function($el, tag)\n\t\t\t\t{\n\t\t\t\t\tvar self = this;\n\t\t\t\t\t$el.children(tag).each(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $child = $(this);\n\n\t\t\t\t\t\tif (!$child.hasClass('redactor-selection-marker'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (self.inline.type == 'style')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar arr = self.inline.value.split(';');\n\n\t\t\t\t\t\t\t\tfor (var z = 0; z < arr.length; z++)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif (arr[z] === '') return;\n\n\t\t\t\t\t\t\t\t\tvar style = arr[z].split(':');\n\t\t\t\t\t\t\t\t\t$child.css(style[0], '');\n\n\t\t\t\t\t\t\t\t\tif (self.utils.removeEmptyAttr($child , 'style'))\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t$child.replaceWith($child.contents());\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$child.contents().unwrap();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tformatConvert: function(tag)\n\t\t\t\t{\n\t\t\t\t\tthis.selection.save();\n\n\t\t\t\t\tvar find = '';\n\t\t\t\t\tif (this.inline.type == 'class') find = '[data-redactor-class=' + this.inline.value + ']';\n\t\t\t\t\telse if (this.inline.type == 'style')\n\t\t\t\t\t{\n\t\t\t\t\t\tfind = '[data-redactor-style=\"' + this.inline.value + '\"]';\n\t\t\t\t\t}\n\n\t\t\t\t\tvar self = this;\n\t\t\t\t\tif (tag != 'del')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$editor.find('del').each(function(i,s)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tself.utils.replaceToTag(s, 'inline');\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (tag != 'span')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$editor.find(tag).each(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar $el = $(this);\n\t\t\t\t\t\t\t$el.replaceWith($('<strike />').html($el.contents()));\n\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.$editor.find('[data-redactor-tag=\"' + tag + '\"]' + find).each(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tif (find === '' && tag == 'span' && this.tagName.toLowerCase() == tag) return;\n\n\t\t\t\t\t\tvar $el = $(this);\n\t\t\t\t\t\t$el.replaceWith($('<strike />').html($el.contents()));\n\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.selection.restore();\n\t\t\t\t},\n\t\t\t\tsetFormat: function(node)\n\t\t\t\t{\n\t\t\t\t\tswitch (this.inline.type)\n\t\t\t\t\t{\n\t\t\t\t\t\tcase 'class':\n\n\t\t\t\t\t\t\tif (node.hasClass(this.inline.value))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tnode.removeClass(this.inline.value);\n\t\t\t\t\t\t\t\tnode.removeAttr('data-redactor-class');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tnode.addClass(this.inline.value);\n\t\t\t\t\t\t\t\tnode.attr('data-redactor-class', this.inline.value);\n\t\t\t\t\t\t\t}\n\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tcase 'style':\n\n\t\t\t\t\t\t\tnode[0].style.cssText = this.inline.value;\n\t\t\t\t\t\t\tnode.attr('data-redactor-style', this.inline.value);\n\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn node;\n\t\t\t\t},\n\t\t\t\tremoveStyle: function()\n\t\t\t\t{\n\t\t\t\t\tthis.buffer.set();\n\t\t\t\t\tvar current = this.selection.getCurrent();\n\t\t\t\t\tvar nodes = this.selection.getInlines();\n\n\t\t\t\t\tthis.selection.save();\n\n\t\t\t\t\tif (current && current.tagName === 'SPAN')\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $s = $(current);\n\n\t\t\t\t\t\t$s.removeAttr('style');\n\t\t\t\t\t\tif ($s[0].attributes.length === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$s.replaceWith($s.contents());\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t$.each(nodes, $.proxy(function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $s = $(s);\n\t\t\t\t\t\tif ($.inArray(s.tagName.toLowerCase(), this.opts.inlineTags) != -1 && !$s.hasClass('redactor-selection-marker'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$s.removeAttr('style');\n\t\t\t\t\t\t\tif ($s[0].attributes.length === 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$s.replaceWith($s.contents());\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}, this));\n\n\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\tthis.code.sync();\n\n\t\t\t\t},\n\t\t\t\tremoveStyleRule: function(name)\n\t\t\t\t{\n\t\t\t\t\tthis.buffer.set();\n\t\t\t\t\tvar parent = this.selection.getParent();\n\t\t\t\t\tvar nodes = this.selection.getInlines();\n\n\t\t\t\t\tthis.selection.save();\n\n\t\t\t\t\tif (parent && parent.tagName === 'SPAN')\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $s = $(parent);\n\n\t\t\t\t\t\t$s.css(name, '');\n\t\t\t\t\t\tthis.utils.removeEmptyAttr($s, 'style');\n\t\t\t\t\t\tif ($s[0].attributes.length === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$s.replaceWith($s.contents());\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t$.each(nodes, $.proxy(function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $s = $(s);\n\t\t\t\t\t\tif ($.inArray(s.tagName.toLowerCase(), this.opts.inlineTags) != -1 && !$s.hasClass('redactor-selection-marker'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$s.css(name, '');\n\t\t\t\t\t\t\tthis.utils.removeEmptyAttr($s, 'style');\n\t\t\t\t\t\t\tif ($s[0].attributes.length === 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$s.replaceWith($s.contents());\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}, this));\n\n\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\tthis.code.sync();\n\t\t\t\t},\n\t\t\t\tremoveFormat: function()\n\t\t\t\t{\n\t\t\t\t\tthis.buffer.set();\n\t\t\t\t\tvar current = this.selection.getCurrent();\n\n\t\t\t\t\tthis.selection.save();\n\n\t\t\t\t\tdocument.execCommand('removeFormat');\n\n\t\t\t\t\tif (current && current.tagName === 'SPAN')\n\t\t\t\t\t{\n\t\t\t\t\t\t$(current).replaceWith($(current).contents());\n\t\t\t\t\t}\n\n\n\t\t\t\t\t$.each(this.selection.getNodes(), $.proxy(function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $s = $(s);\n\t\t\t\t\t\tif ($.inArray(s.tagName.toLowerCase(), this.opts.inlineTags) != -1 && !$s.hasClass('redactor-selection-marker'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$s.replaceWith($s.contents());\n\t\t\t\t\t\t}\n\t\t\t\t\t}, this));\n\n\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\tthis.code.sync();\n\n\t\t\t\t},\n\t\t\t\ttoggleClass: function(className)\n\t\t\t\t{\n\t\t\t\t\tthis.inline.format('span', 'class', className);\n\t\t\t\t},\n\t\t\t\ttoggleStyle: function(value)\n\t\t\t\t{\n\t\t\t\t\tthis.inline.format('span', 'style', value);\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tinsert: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tset: function(html, clean)\n\t\t\t\t{\n\t\t\t\t\tthis.placeholder.remove();\n\n\t\t\t\t\thtml = this.clean.setVerified(html);\n\n\t\t\t\t\tif (typeof clean == 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.clean.onPaste(html, false);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.$editor.html(html);\n\t\t\t\t\tthis.selection.remove();\n\t\t\t\t\tthis.focus.setEnd();\n\t\t\t\t\tthis.clean.normalizeLists();\n\t\t\t\t\tthis.code.sync();\n\t\t\t\t\tthis.observe.load();\n\n\t\t\t\t\tif (typeof clean == 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tsetTimeout($.proxy(this.clean.clearUnverified, this), 10);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\ttext: function(text)\n\t\t\t\t{\n\t\t\t\t\tthis.placeholder.remove();\n\n\t\t\t\t\ttext = text.toString();\n\t\t\t\t\ttext = $.trim(text);\n\t\t\t\t\ttext = this.clean.getPlainText(text, false);\n\n\t\t\t\t\tthis.$editor.focus();\n\n\t\t\t\t\tif (this.utils.browser('msie'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.insert.htmlIe(text);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.selection.get();\n\n\t\t\t\t\t\tthis.range.deleteContents();\n\t\t\t\t\t\tvar el = document.createElement(\"div\");\n\t\t\t\t\t\tel.innerHTML = text;\n\t\t\t\t\t\tvar frag = document.createDocumentFragment(), node, lastNode;\n\t\t\t\t\t\twhile ((node = el.firstChild))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlastNode = frag.appendChild(node);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.range.insertNode(frag);\n\n\t\t\t\t\t\tif (lastNode)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar range = this.range.cloneRange();\n\t\t\t\t\t\t\trange.setStartAfter(lastNode);\n\t\t\t\t\t\t\trange.collapse(true);\n\t\t\t\t\t\t\tthis.sel.removeAllRanges();\n\t\t\t\t\t\t\tthis.sel.addRange(range);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.code.sync();\n\t\t\t\t\tthis.clean.clearUnverified();\n\t\t\t\t},\n\t\t\t\thtmlWithoutClean: function(html)\n\t\t\t\t{\n\t\t\t\t\tthis.insert.html(html, false);\n\t\t\t\t},\n\t\t\t\thtml: function(html, clean)\n\t\t\t\t{\n\t\t\t\t\tthis.placeholder.remove();\n\n\t\t\t\t\tif (typeof clean == 'undefined') clean = true;\n\n\t\t\t\t\tthis.$editor.focus();\n\n\t\t\t\t\thtml = this.clean.setVerified(html);\n\n\t\t\t\t\tif (clean)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = this.clean.onPaste(html);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.utils.browser('msie'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.insert.htmlIe(html);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.clean.singleLine) this.insert.execHtml(html);\n\t\t\t\t\t\telse document.execCommand('insertHTML', false, html);\n\n\t\t\t\t\t\tthis.insert.htmlFixMozilla();\n\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.clean.normalizeLists();\n\n\t\t\t\t\t// remove empty paragraphs finaly\n\t\t\t\t\tif (!this.opts.linebreaks)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$editor.find('p').each($.proxy(this.utils.removeEmpty, this));\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.code.sync();\n\t\t\t\t\tthis.observe.load();\n\n\t\t\t\t\tif (clean)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.clean.clearUnverified();\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\thtmlFixMozilla: function()\n\t\t\t\t{\n\t\t\t\t\t// FF inserts empty p when content was selected dblclick\n\t\t\t\t\tif (!this.utils.browser('mozilla')) return;\n\n\t\t\t\t\tvar $next = $(this.selection.getBlock()).next();\n\t\t\t\t\tif ($next.length > 0 && $next[0].tagName == 'P' && $next.html() === '')\n\t\t\t\t\t{\n\t\t\t\t\t\t$next.remove();\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\thtmlIe: function(html)\n\t\t\t\t{\n\t\t\t\t\tif (this.utils.isIe11())\n\t\t\t\t\t{\n\t\t\t\t\t\tvar parent = this.utils.isCurrentOrParent('P');\n\t\t\t\t\t\tvar $html = $('<div>').append(html);\n\t\t\t\t\t\tvar blocksMatch = $html.contents().is('p, :header, dl, ul, ol, div, table, td, blockquote, pre, address, section, header, footer, aside, article');\n\n\t\t\t\t\t\tif (parent && blocksMatch) this.insert.ie11FixInserting(parent, html);\n\t\t\t\t\t\telse this.insert.ie11PasteFrag(html);\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tdocument.selection.createRange().pasteHTML(html);\n\n\t\t\t\t},\n\t\t\t\texecHtml: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = this.clean.setVerified(html);\n\n\t\t\t\t\tthis.selection.get();\n\n\t\t\t\t\tthis.range.deleteContents();\n\n\t\t\t\t\tvar el = document.createElement('div');\n\t\t\t\t\tel.innerHTML = html;\n\n\t\t\t\t\tvar frag = document.createDocumentFragment(), node, lastNode;\n\t\t\t\t\twhile ((node = el.firstChild))\n\t\t\t\t\t{\n\t\t\t\t\t\tlastNode = frag.appendChild(node);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.range.insertNode(frag);\n\n\t\t\t\t\tthis.range.collapse(true);\n\t\t\t\t\tthis.caret.setAfter(lastNode);\n\n\t\t\t\t},\n\t\t\t\tnode: function(node, deleteContents)\n\t\t\t\t{\n\t\t\t\t\tnode = node[0] || node;\n\n\t\t\t\t\tvar html = this.utils.getOuterHtml(node);\n\t\t\t\t\thtml = this.clean.setVerified(html);\n\n\t\t\t\t\tif (html.match(/</g) !== null)\n\t\t\t\t\t{\n\t\t\t\t\t\tnode = $(html)[0];\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.selection.get();\n\n\t\t\t\t\tif (deleteContents !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.range.deleteContents();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.range.insertNode(node);\n\t\t\t\t\tthis.range.collapse(false);\n\t\t\t\t\tthis.selection.addRange();\n\n\t\t\t\t\treturn node;\n\t\t\t\t},\n\t\t\t\tnodeToPoint: function(node, x, y)\n\t\t\t\t{\n\t\t\t\t\tnode = node[0] || node;\n\n\t\t\t\t\tthis.selection.get();\n\n\t\t\t\t\tvar range;\n\t\t\t\t\tif (document.caretPositionFromPoint)\n\t\t\t\t\t{\n\t\t\t\t\t    var pos = document.caretPositionFromPoint(x, y);\n\n\t\t\t\t\t    this.range.setStart(pos.offsetNode, pos.offset);\n\t\t\t\t\t    this.range.collapse(true);\n\t\t\t\t\t    this.range.insertNode(node);\n\t\t\t\t\t}\n\t\t\t\t\telse if (document.caretRangeFromPoint)\n\t\t\t\t\t{\n\t\t\t\t\t    range = document.caretRangeFromPoint(x, y);\n\t\t\t\t\t    range.insertNode(node);\n\t\t\t\t\t}\n\t\t\t\t\telse if (typeof document.body.createTextRange != \"undefined\")\n\t\t\t\t\t{\n\t\t\t\t        range = document.body.createTextRange();\n\t\t\t\t        range.moveToPoint(x, y);\n\t\t\t\t        var endRange = range.duplicate();\n\t\t\t\t        endRange.moveToPoint(x, y);\n\t\t\t\t        range.setEndPoint(\"EndToEnd\", endRange);\n\t\t\t\t        range.select();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tnodeToCaretPositionFromPoint: function(e, node)\n\t\t\t\t{\n\t\t\t\t\tnode = node[0] || node;\n\n\t\t\t\t\tvar range;\n\t\t\t\t\tvar x = e.clientX, y = e.clientY;\n\t\t\t\t\tif (document.caretPositionFromPoint)\n\t\t\t\t\t{\n\t\t\t\t\t    var pos = document.caretPositionFromPoint(x, y);\n\t\t\t\t\t    var sel = document.getSelection();\n\t\t\t\t\t    range = sel.getRangeAt(0);\n\t\t\t\t\t    range.setStart(pos.offsetNode, pos.offset);\n\t\t\t\t\t    range.collapse(true);\n\t\t\t\t\t    range.insertNode(node);\n\t\t\t\t\t}\n\t\t\t\t\telse if (document.caretRangeFromPoint)\n\t\t\t\t\t{\n\t\t\t\t\t    range = document.caretRangeFromPoint(x, y);\n\t\t\t\t\t    range.insertNode(node);\n\t\t\t\t\t}\n\t\t\t\t\telse if (typeof document.body.createTextRange != \"undefined\")\n\t\t\t\t\t{\n\t\t\t\t        range = document.body.createTextRange();\n\t\t\t\t        range.moveToPoint(x, y);\n\t\t\t\t        var endRange = range.duplicate();\n\t\t\t\t        endRange.moveToPoint(x, y);\n\t\t\t\t        range.setEndPoint(\"EndToEnd\", endRange);\n\t\t\t\t        range.select();\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tie11FixInserting: function(parent, html)\n\t\t\t\t{\n\t\t\t\t\tvar node = document.createElement('span');\n\t\t\t\t\tnode.className = 'redactor-ie-paste';\n\t\t\t\t\tthis.insert.node(node);\n\n\t\t\t\t\tvar parHtml = $(parent).html();\n\n\t\t\t\t\tparHtml = '<p>' + parHtml.replace(/<span class=\"redactor-ie-paste\"><\\/span>/gi, '</p>' + html + '<p>') + '</p>';\n\t\t\t\t\t$(parent).replaceWith(parHtml);\n\t\t\t\t},\n\t\t\t\tie11PasteFrag: function(html)\n\t\t\t\t{\n\t\t\t\t\tthis.selection.get();\n\t\t\t\t\tthis.range.deleteContents();\n\n\t\t\t\t\tvar el = document.createElement(\"div\");\n\t\t\t\t\tel.innerHTML = html;\n\n\t\t\t\t\tvar frag = document.createDocumentFragment(), node, lastNode;\n\t\t\t\t\twhile ((node = el.firstChild))\n\t\t\t\t\t{\n\t\t\t\t\t\tlastNode = frag.appendChild(node);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.range.insertNode(frag);\n\t\t\t\t\tthis.range.collapse(false);\n\t\t\t\t\tthis.selection.addRange();\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tkeydown: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tinit: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (this.rtePaste) return;\n\n\t\t\t\t\tvar key = e.which;\n\t\t\t\t\tvar arrow = (key >= 37 && key <= 40);\n\n\t\t\t\t\tthis.keydown.ctrl = e.ctrlKey || e.metaKey;\n\t\t\t\t\tthis.keydown.current = this.selection.getCurrent();\n\t\t\t\t\tthis.keydown.parent = this.selection.getParent();\n\t\t\t\t\tthis.keydown.block = this.selection.getBlock();\n\n\t\t\t        // detect tags\n\t\t\t\t\tthis.keydown.pre = this.utils.isTag(this.keydown.current, 'pre');\n\t\t\t\t\tthis.keydown.blockquote = this.utils.isTag(this.keydown.current, 'blockquote');\n\t\t\t\t\tthis.keydown.figcaption = this.utils.isTag(this.keydown.current, 'figcaption');\n\n\t\t\t\t\t// shortcuts setup\n\t\t\t\t\tthis.shortcuts.init(e, key);\n\n\t\t\t\t\tthis.keydown.checkEvents(arrow, key);\n\t\t\t\t\tthis.keydown.setupBuffer(e, key);\n\t\t\t\t\tthis.keydown.addArrowsEvent(arrow);\n\t\t\t\t\tthis.keydown.setupSelectAll(e, key);\n\n\t\t\t\t\t// callback\n\t\t\t\t\tvar keydownStop = this.core.setCallback('keydown', e);\n\t\t\t\t\tif (keydownStop === false)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// ie and ff exit from table\n\t\t\t\t\tif (this.opts.enterKey && (this.utils.browser('msie') || this.utils.browser('mozilla')) && (key === this.keyCode.DOWN || key === this.keyCode.RIGHT))\n\t\t\t\t\t{\n\t\t\t\t\t\tvar isEndOfTable = false;\n\t\t\t\t\t\tvar $table = false;\n\t\t\t\t\t\tif (this.keydown.block && this.keydown.block.tagName === 'TD')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$table = $(this.keydown.block).closest('table', this.$editor[0]);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ($table && $table.find('td').last()[0] === this.keydown.block)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tisEndOfTable = true;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.utils.isEndOfElement() && isEndOfTable)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar node = $(this.opts.emptyHtml);\n\t\t\t\t\t\t\t$table.after(node);\n\t\t\t\t\t\t\tthis.caret.setStart(node);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// down\n\t\t\t\t\tif (this.opts.enterKey && key === this.keyCode.DOWN)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.keydown.onArrowDown();\n\t\t\t\t\t}\n\n\t\t\t\t\t// turn off enter key\n\t\t\t\t\tif (!this.opts.enterKey && key === this.keyCode.ENTER)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t// remove selected\n\t\t\t\t\t\tif (!this.range.collapsed) this.range.deleteContents();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// on enter\n\t\t\t\t\tif (key == this.keyCode.ENTER && !e.shiftKey && !e.ctrlKey && !e.metaKey)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar stop = this.core.setCallback('enter', e);\n\t\t\t\t\t\tif (stop === false)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.keydown.blockquote && this.keydown.exitFromBlockquote(e) === true)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar current, $next;\n\t\t\t\t\t\tif (this.keydown.pre)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn this.keydown.insertNewLine(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (this.keydown.blockquote || this.keydown.figcaption)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcurrent = this.selection.getCurrent();\n\t\t\t\t\t\t\t$next = $(current).next();\n\n\t\t\t\t\t\t\tif ($next.length !== 0 && $next[0].tagName == 'BR')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn this.keydown.insertBreakLine(e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (this.utils.isEndOfElement() && (current && current != 'SPAN'))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn this.keydown.insertDblBreakLine(e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn this.keydown.insertBreakLine(e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (this.opts.linebreaks && !this.keydown.block)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcurrent = this.selection.getCurrent();\n\t\t\t\t\t\t\t$next = $(this.keydown.current).next();\n\n\t\t\t\t\t\t\tif ($next.length !== 0 && $next[0].tagName == 'BR')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn this.keydown.insertBreakLine(e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (current !== false && $(current).hasClass('redactor-invisible-space'))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.caret.setAfter(current);\n\t\t\t\t\t\t\t\t$(current).contents().unwrap();\n\n\t\t\t\t\t\t\t\treturn this.keydown.insertDblBreakLine(e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (this.utils.isEndOfEditor())\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\treturn this.keydown.insertDblBreakLine(e);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse if ($next.length === 0 && current === false && typeof $next.context != 'undefined')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\treturn this.keydown.insertBreakLine(e);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn this.keydown.insertBreakLine(e);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (this.opts.linebreaks && this.keydown.block)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsetTimeout($.proxy(this.keydown.replaceDivToBreakLine, this), 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// paragraphs\n\t\t\t\t\t\telse if (!this.opts.linebreaks && this.keydown.block)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (this.keydown.block.tagName !== 'LI')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tsetTimeout($.proxy(this.keydown.replaceDivToParagraph, this), 1);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tcurrent = this.selection.getCurrent();\n\t\t\t\t\t\t\t\tvar $parent = $(current).closest('li', this.$editor[0]);\n\t\t\t\t\t\t\t\tvar $list = $parent.closest('ul,ol', this.$editor[0]);\n\n\t\t\t\t\t\t\t\tif ($parent.length !== 0 && this.utils.isEmpty($parent.html()) && $list.next().length === 0 && this.utils.isEmpty($list.find(\"li\").last().html()))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t$list.find(\"li\").last().remove();\n\n\t\t\t\t\t\t\t\t\tvar node = $(this.opts.emptyHtml);\n\t\t\t\t\t\t\t\t\t$list.after(node);\n\t\t\t\t\t\t\t\t\tthis.caret.setStart(node);\n\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (!this.opts.linebreaks && !this.keydown.block)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn this.keydown.insertParagraph(e);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Shift+Enter or Ctrl+Enter\n\t\t\t\t\tif (key === this.keyCode.ENTER && (e.ctrlKey || e.shiftKey))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.keydown.onShiftEnter(e);\n\t\t\t\t\t}\n\n\n\t\t\t\t\t// tab or cmd + [\n\t\t\t\t\tif (key === this.keyCode.TAB || e.metaKey && key === 221 || e.metaKey && key === 219)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.keydown.onTab(e, key);\n\t\t\t\t\t}\n\n\t\t\t\t\t// image delete and backspace\n\t\t\t\t\tif (key === this.keyCode.BACKSPACE || key === this.keyCode.DELETE)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.utils.browser('mozilla') && this.keydown.current && this.keydown.current.tagName === 'TD')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar nodes = this.selection.getNodes();\n\t\t\t\t\t\tif (nodes)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar len = nodes.length;\n\t\t\t\t\t\t\tvar last;\n\t\t\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar children = $(nodes[i]).children('img');\n\t\t\t\t\t\t\t\tif (children.length !== 0)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tvar self = this;\n\t\t\t\t\t\t\t\t\t$.each(children, function(z,s)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tvar $s = $(s);\n\t\t\t\t\t\t\t\t\t\tif ($s.css('float') != 'none') return;\n\n\t\t\t\t\t\t\t\t\t\t// image delete callback\n\t\t\t\t\t\t\t\t\t\tself.core.setCallback('imageDelete', s.src, $s);\n\t\t\t\t\t\t\t\t\t\tlast = s;\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse if (nodes[i].tagName == 'IMG')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif (last != nodes[i])\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t// image delete callback\n\t\t\t\t\t\t\t\t\t\tthis.core.setCallback('imageDelete', nodes[i].src, $(nodes[i]));\n\t\t\t\t\t\t\t\t\t\tlast = nodes[i];\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// backspace\n\t\t\t\t\tif (key === this.keyCode.BACKSPACE)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.keydown.removeInvisibleSpace();\n\t\t\t\t\t\tthis.keydown.removeEmptyListInTable(e);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.code.sync();\n\t\t\t\t},\n\t\t\t\tcheckEvents: function(arrow, key)\n\t\t\t\t{\n\t\t\t\t\tif (!arrow && (this.core.getEvent() == 'click' || this.core.getEvent() == 'arrow'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.addEvent(false);\n\n\t\t\t\t\t\tif (this.keydown.checkKeyEvents(key))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.buffer.set();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tcheckKeyEvents: function(key)\n\t\t\t\t{\n\t\t\t\t\tvar k = this.keyCode;\n\t\t\t\t\tvar keys = [k.BACKSPACE, k.DELETE, k.ENTER, k.SPACE, k.ESC, k.TAB, k.CTRL, k.META, k.ALT, k.SHIFT];\n\n\t\t\t\t\treturn ($.inArray(key, keys) == -1) ? true : false;\n\n\t\t\t\t},\n\t\t\t\taddArrowsEvent: function(arrow)\n\t\t\t\t{\n\t\t\t\t\tif (!arrow) return;\n\n\t\t\t\t\tif ((this.core.getEvent() == 'click' || this.core.getEvent() == 'arrow'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.core.addEvent(false);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t    this.core.addEvent('arrow');\n\t\t\t\t},\n\t\t\t\tsetupBuffer: function(e, key)\n\t\t\t\t{\n\t\t\t\t\tif (this.keydown.ctrl && key === 90 && !e.shiftKey && !e.altKey && this.opts.buffer.length) // z key\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tthis.buffer.undo();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\t// undo\n\t\t\t\t\telse if (this.keydown.ctrl && key === 90 && e.shiftKey && !e.altKey && this.opts.rebuffer.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tthis.buffer.redo();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\telse if (!this.keydown.ctrl)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (key == this.keyCode.BACKSPACE || key == this.keyCode.DELETE || (key == this.keyCode.ENTER && !e.ctrlKey && !e.shiftKey) || key == this.keyCode.SPACE)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.buffer.set();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetupSelectAll: function(e, key)\n\t\t\t\t{\n\t\t\t\t\tif (this.keydown.ctrl && key === 65)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.utils.enableSelectAll();\n\t\t\t\t\t}\n\t\t\t\t\telse if (key != this.keyCode.LEFT_WIN && !this.keydown.ctrl)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.utils.disableSelectAll();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonArrowDown: function()\n\t\t\t\t{\n\t\t\t\t\tvar tags = [this.keydown.blockquote, this.keydown.pre, this.keydown.figcaption];\n\n\t\t\t\t\tfor (var i = 0; i < tags.length; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (tags[i])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.keydown.insertAfterLastElement(tags[i]);\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonShiftEnter: function(e)\n\t\t\t\t{\n\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\tif (this.utils.isEndOfElement())\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.keydown.insertDblBreakLine(e);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.keydown.insertBreakLine(e);\n\t\t\t\t},\n\t\t\t\tonTab: function(e, key)\n\t\t\t\t{\n\t\t\t\t\tif (!this.opts.tabKey) return true;\n\t\t\t\t\tif (this.utils.isEmpty(this.code.get()) && this.opts.tabAsSpaces === false) return true;\n\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\tvar node;\n\t\t\t\t\tif (this.keydown.pre && !e.shiftKey)\n\t\t\t\t\t{\n\t\t\t\t\t\tnode = (this.opts.preSpaces) ? document.createTextNode(Array(this.opts.preSpaces + 1).join('\\u00a0')) : document.createTextNode('\\t');\n\t\t\t\t\t\tthis.insert.node(node);\n\t\t\t\t\t\tthis.code.sync();\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.opts.tabAsSpaces !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\tnode = document.createTextNode(Array(this.opts.tabAsSpaces + 1).join('\\u00a0'));\n\t\t\t\t\t\tthis.insert.node(node);\n\t\t\t\t\t\tthis.code.sync();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (e.metaKey && key === 219) this.indent.decrease();\n\t\t\t\t\t\telse if (e.metaKey && key === 221) this.indent.increase();\n\t\t\t\t\t\telse if (!e.shiftKey) this.indent.increase();\n\t\t\t\t\t\telse this.indent.decrease();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\treplaceDivToBreakLine: function()\n\t\t\t\t{\n\t\t\t\t\tvar blockElem = this.selection.getBlock();\n\t\t\t\t\tvar blockHtml = blockElem.innerHTML.replace(/<br\\s?\\/?>/gi, '');\n\t\t\t\t\tif ((blockElem.tagName === 'DIV' || blockElem.tagName === 'P') && blockHtml === '' && !$(blockElem).hasClass('redactor-editor'))\n\t\t\t\t\t{\n\t\t\t\t\t\tvar br = document.createElement('br');\n\n\t\t\t\t\t\t$(blockElem).replaceWith(br);\n\t\t\t\t\t\tthis.caret.setBefore(br);\n\n\t\t\t\t\t\tthis.code.sync();\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\treplaceDivToParagraph: function()\n\t\t\t\t{\n\t\t\t\t\tvar blockElem = this.selection.getBlock();\n\t\t\t\t\tvar blockHtml = blockElem.innerHTML.replace(/<br\\s?\\/?>/gi, '');\n\t\t\t\t\tif (blockElem.tagName === 'DIV' && blockHtml === '' && !$(blockElem).hasClass('redactor-editor'))\n\t\t\t\t\t{\n\t\t\t\t\t\tvar p = document.createElement('p');\n\t\t\t\t\t\tp.innerHTML = this.opts.invisibleSpace;\n\n\t\t\t\t\t\t$(blockElem).replaceWith(p);\n\t\t\t\t\t\tthis.caret.setStart(p);\n\n\t\t\t\t\t\tthis.code.sync();\n\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\telse if (this.opts.cleanStyleOnEnter && blockElem.tagName == 'P')\n\t\t\t\t\t{\n\t\t\t\t\t\t$(blockElem).removeAttr('class').removeAttr('style');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tinsertParagraph: function(e)\n\t\t\t\t{\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\tthis.selection.get();\n\n\t\t\t\t\tvar p = document.createElement('p');\n\t\t\t\t\tp.innerHTML = this.opts.invisibleSpace;\n\n\t\t\t\t\tthis.range.deleteContents();\n\t\t\t\t\tthis.range.insertNode(p);\n\n\t\t\t\t\tthis.caret.setStart(p);\n\n\t\t\t\t\tthis.code.sync();\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\texitFromBlockquote: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (!this.utils.isEndOfElement()) return;\n\n\t\t\t\t\tvar tmp = $.trim($(this.keydown.block).html());\n\t\t\t\t\tif (tmp.search(/(<br\\s?\\/?>){2}$/i) != -1)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\tif (this.opts.linebreaks)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar br = document.createElement('br');\n\t\t\t\t\t\t\t$(this.keydown.blockquote).after(br);\n\n\t\t\t\t\t\t\tthis.caret.setBefore(br);\n\t\t\t\t\t\t\t$(this.keydown.block).html(tmp.replace(/<br\\s?\\/?>$/i, ''));\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar node = $(this.opts.emptyHtml);\n\t\t\t\t\t\t\t$(this.keydown.blockquote).after(node);\n\t\t\t\t\t\t\tthis.caret.setStart(node);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn true;\n\n\t\t\t\t\t}\n\n\t\t\t\t\treturn;\n\n\t\t\t\t},\n\t\t\t\tinsertAfterLastElement: function(element)\n\t\t\t\t{\n\t\t\t\t\tif (!this.utils.isEndOfElement()) return;\n\n\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\tif (this.opts.linebreaks)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar contents = $('<div>').append($.trim(this.$editor.html())).contents();\n\t\t\t\t\t\tvar last = contents.last()[0];\n\t\t\t\t\t\tif (last.tagName == 'SPAN' && last.innerHTML === '')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlast = contents.prev()[0];\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this.utils.getOuterHtml(last) != this.utils.getOuterHtml(element)) return;\n\n\t\t\t\t\t\tvar br = document.createElement('br');\n\t\t\t\t\t\t$(element).after(br);\n\t\t\t\t\t\tthis.caret.setAfter(br);\n\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.$editor.contents().last()[0] !== element) return;\n\n\t\t\t\t\t\tvar node = $(this.opts.emptyHtml);\n\t\t\t\t\t\t$(element).after(node);\n\t\t\t\t\t\tthis.caret.setStart(node);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tinsertNewLine: function(e)\n\t\t\t\t{\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\tvar node = document.createTextNode('\\n');\n\n\t\t\t\t\tthis.selection.get();\n\n\t\t\t\t\tthis.range.deleteContents();\n\t\t\t\t\tthis.range.insertNode(node);\n\n\t\t\t\t\tthis.caret.setAfter(node);\n\n\t\t\t\t\tthis.code.sync();\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tinsertBreakLine: function(e)\n\t\t\t\t{\n\t\t\t\t\treturn this.keydown.insertBreakLineProcessing(e);\n\t\t\t\t},\n\t\t\t\tinsertDblBreakLine: function(e)\n\t\t\t\t{\n\t\t\t\t\treturn this.keydown.insertBreakLineProcessing(e, true);\n\t\t\t\t},\n\t\t\t\tinsertBreakLineProcessing: function(e, dbl)\n\t\t\t\t{\n\t\t\t\t\te.stopPropagation();\n\n\t\t\t\t\tthis.selection.get();\n\n\t\t\t\t\tvar br1 = document.createElement('br');\n\n\t\t\t\t\tif (this.utils.browser('msie'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.range.collapse(false);\n\t\t\t\t\t\tthis.range.setEnd(this.range.endContainer, this.range.endOffset);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.range.deleteContents();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.range.insertNode(br1);\n\n\t\t\t\t\t// move br outside A tag\n\t\t\t\t\tvar $parentA = $(br1).parent(\"a\");\n\n\t\t\t\t\tif ($parentA.length > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$parentA.find(br1)\n\t\t\t\t\t\t\t\t.remove();\n\n\t\t\t\t\t\t$parentA.after(br1);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (dbl === true)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $next = $(br1).next();\n\t\t\t\t\t\tif ($next.length !== 0 && $next[0].tagName === 'BR' && this.utils.isEndOfEditor())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.caret.setAfter(br1);\n\t\t\t\t\t\t\tthis.code.sync();\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar br2 = document.createElement('br');\n\n\t\t\t\t\t\tthis.range.insertNode(br2);\n\t\t\t\t\t\tthis.caret.setAfter(br2);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.keydown.insertBreakLineProcessingAfter(br1);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.code.sync();\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tinsertBreakLineProcessingAfter: function(node)\n\t\t\t\t{\n\t\t\t\t\tvar space = this.utils.createSpaceElement();\n\t\t\t\t\t$(node).after(space);\n\t\t\t\t\tthis.selection.selectElement(space);\n\n\t\t\t\t\t$(space).replaceWith(function()\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $(this).contents();\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tremoveInvisibleSpace: function()\n\t\t\t\t{\n\t\t\t\t\tvar $current = $(this.keydown.current);\n\t\t\t\t\tif ($current.text().search(/^\\u200B$/g) === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$current.remove();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tremoveEmptyListInTable: function(e)\n\t\t\t\t{\n\t\t\t\t\tvar $current = $(this.keydown.current);\n\t\t\t\t\tvar $parent = $(this.keydown.parent);\n\t\t\t\t\tvar td = $current.closest('td', this.$editor[0]);\n\n\t\t\t\t\tif (td.length !== 0 && $current.closest('li', this.$editor[0]) && $parent.children('li').length === 1)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!this.utils.isEmpty($current.text())) return;\n\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t$current.remove();\n\t\t\t\t\t\t$parent.remove();\n\n\t\t\t\t\t\tthis.caret.setStart(td);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tkeyup: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tinit: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (this.rtePaste) return;\n\n\t\t\t\t\tvar key = e.which;\n\n\t\t\t\t\tthis.keyup.current = this.selection.getCurrent();\n\t\t\t\t\tthis.keyup.parent = this.selection.getParent();\n\t\t\t\t\tvar $parent = this.utils.isRedactorParent($(this.keyup.parent).parent());\n\n\t\t\t\t\t// callback\n\t\t\t\t\tvar keyupStop = this.core.setCallback('keyup', e);\n\t\t\t\t\tif (keyupStop === false)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// replace to p before / after the table or body\n\t\t\t\t\tif (!this.opts.linebreaks && this.keyup.current.nodeType == 3 && this.keyup.current.length <= 1 && (this.keyup.parent === false || this.keyup.parent.tagName == 'BODY'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.keyup.replaceToParagraph();\n\t\t\t\t\t}\n\n\t\t\t\t\t// replace div after lists\n\t\t\t\t\tif (!this.opts.linebreaks && this.utils.isRedactorParent(this.keyup.current) && this.keyup.current.tagName === 'DIV')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.keyup.replaceToParagraph(false);\n\t\t\t\t\t}\n\n\n\t\t\t\t\tif (!this.opts.linebreaks && $(this.keyup.parent).hasClass('redactor-invisible-space') && ($parent === false || $parent[0].tagName == 'BODY'))\n\t\t\t\t\t{\n\t\t\t\t\t\t$(this.keyup.parent).contents().unwrap();\n\t\t\t\t\t\tthis.keyup.replaceToParagraph();\n\t\t\t\t\t}\n\n\t\t\t\t\t// linkify\n\t\t\t\t\tif (this.linkify.isEnabled() && this.linkify.isKey(key))\n\t\t\t\t\t\tthis.linkify.format();\n\n\t\t\t\t\tif (key === this.keyCode.DELETE || key === this.keyCode.BACKSPACE)\n\t\t\t\t\t{\n\t\t\t\t\t\t// clear unverified\n\t\t\t\t\t\tthis.clean.clearUnverified();\n\n\t\t\t\t\t\tif (this.observe.image)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\t\tthis.image.hideResize();\n\n\t\t\t\t\t\t\tthis.buffer.set();\n\t\t\t\t\t\t\tthis.image.remove(this.observe.image);\n\t\t\t\t\t\t\tthis.observe.image = false;\n\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// remove empty paragraphs\n\t\t\t\t\t\tthis.$editor.find('p').each($.proxy(function(i, s)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.utils.removeEmpty(i, $(s).html());\n\t\t\t\t\t\t}, this));\n\n\t\t\t\t\t\t// remove invisible space\n\t\t\t\t\t\tif (this.opts.linebreaks && this.keyup.current && this.keyup.current.tagName == 'DIV' && this.utils.isEmpty(this.keyup.current.innerHTML))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(this.keyup.current).after(this.selection.getMarkerAsHtml());\n\t\t\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\t\t\t$(this.keyup.current).remove();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// if empty\n\t\t\t\t\t\treturn this.keyup.formatEmpty(e);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\treplaceToParagraph: function(clone)\n\t\t\t\t{\n\t\t\t\t\tvar $current = $(this.keyup.current);\n\n\t\t\t\t\tvar node;\n\t\t\t\t\tif (clone === false)\n\t\t\t\t\t{\n\t\t\t\t\t\tnode = $('<p>').append($current.html());\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tnode = $('<p>').append($current.clone());\n\t\t\t\t\t}\n\n\t\t\t\t\t$current.replaceWith(node);\n\t\t\t\t\tvar next = $(node).next();\n\t\t\t\t\tif (typeof(next[0]) !== 'undefined' && next[0].tagName == 'BR')\n\t\t\t\t\t{\n\t\t\t\t\t\tnext.remove();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.caret.setEnd(node);\n\t\t\t\t},\n\t\t\t\tformatEmpty: function(e)\n\t\t\t\t{\n\t\t\t\t\tvar html = $.trim(this.$editor.html());\n\n\t\t\t\t\tif (!this.utils.isEmpty(html)) return;\n\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\tif (this.opts.linebreaks)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$editor.html(this.selection.getMarkerAsHtml());\n\t\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = '<p><br /></p>';\n\n\t\t\t\t\t\tthis.$editor.html(html);\n\t\t\t\t\t\tthis.focus.setStart();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.code.sync();\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tlang: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tload: function()\n\t\t\t\t{\n\t\t\t\t\tthis.opts.curLang = this.opts.langs[this.opts.lang];\n\t\t\t\t},\n\t\t\t\tget: function(name)\n\t\t\t\t{\n\t\t\t\t\treturn (typeof this.opts.curLang[name] != 'undefined') ? this.opts.curLang[name] : '';\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tline: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tinsert: function()\n\t\t\t\t{\n\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\tvar blocks = this.selection.getBlocks();\n \t\t\t\t\tif (blocks[0] !== false && this.line.isExceptLastOrFirst(blocks))\n\t \t\t\t\t{\n\t \t\t\t\t\tif (!this.utils.browser('msie')) this.$editor.focus();\n\t \t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.utils.browser('msie'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.line.insertInIe();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.line.insertInOthersBrowsers();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tisExceptLastOrFirst: function(blocks)\n\t\t\t\t{\n\t\t\t\t\tvar exceptTags = ['li', 'td', 'th', 'blockquote', 'figcaption', 'pre', 'dl', 'dt', 'dd'];\n\n\t\t\t\t\tvar first = blocks[0].tagName.toLowerCase();\n\t\t\t\t\tvar last = this.selection.getLastBlock();\n\n\t\t\t\t\tlast = (typeof last == 'undefined') ? first : last.tagName.toLowerCase();\n\n\t\t\t\t\tvar firstFound = $.inArray(first, exceptTags) != -1;\n\t\t\t\t\tvar lastFound = $.inArray(last, exceptTags) != -1;\n\n\t\t\t\t\tif ((firstFound && lastFound) || firstFound)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tinsertInIe: function()\n\t\t\t\t{\n\t\t\t\t\tthis.utils.saveScroll();\n\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\tthis.insert.node(document.createElement('hr'));\n\n\t\t\t\t\tthis.utils.restoreScroll();\n\t\t\t\t\tthis.code.sync();\n\t\t\t\t},\n\t\t\t\tinsertInOthersBrowsers: function()\n\t\t\t\t{\n\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\tvar extra = '<p id=\"redactor-insert-line\"><br /></p>';\n\t\t\t\t\tif (this.opts.linebreaks) extra = '<br id=\"redactor-insert-line\">';\n\n\t\t\t\t\tdocument.execCommand('insertHTML', false, '<hr>' + extra);\n\n\t\t\t\t\tthis.line.setFocus();\n\t\t\t\t\tthis.code.sync();\n\t\t\t\t},\n\t\t\t\tsetFocus: function()\n\t\t\t\t{\n\t\t\t\t\tvar node = this.$editor.find('#redactor-insert-line');\n\t\t\t\t\tvar next = $(node).next()[0];\n\n\t\t\t\t\tif (next)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.caret.setAfter(node);\n\t\t\t\t\t\tnode.remove();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tnode.removeAttr('id');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tlink: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tshow: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (typeof e != 'undefined' && e.preventDefault) e.preventDefault();\n\n\t\t\t\t\tthis.modal.load('link', this.lang.get('link_insert'), 600);\n\n\t\t\t\t\tthis.modal.createCancelButton();\n\t\t\t\t\tthis.link.buttonInsert = this.modal.createActionButton(this.lang.get('insert'));\n\n\t\t\t\t\tthis.selection.get();\n\n\t\t\t\t\tthis.link.getData();\n\t\t\t\t\tthis.link.cleanUrl();\n\n\t\t\t\t\tif (this.link.target == '_blank') $('#redactor-link-blank').prop('checked', true);\n\n\t\t\t\t\tthis.link.$inputUrl = $('#redactor-link-url');\n\t\t\t\t\tthis.link.$inputText = $('#redactor-link-url-text');\n\n\t\t\t\t\tthis.link.$inputText.val(this.link.text);\n\t\t\t\t\tthis.link.$inputUrl.val(this.link.url);\n\n\t\t\t\t\tthis.link.buttonInsert.on('click', $.proxy(this.link.insert, this));\n\n\t\t\t\t\t// hide link's tooltip\n\t\t\t\t\t$('.redactor-link-tooltip').remove();\n\n\t\t\t\t\t// show modal\n\t\t\t\t\tthis.selection.save();\n\t\t\t\t\tthis.modal.show();\n\t\t\t\t\tthis.link.$inputUrl.focus();\n\t\t\t\t},\n\t\t\t\tcleanUrl: function()\n\t\t\t\t{\n\t\t\t\t\tvar thref = self.location.href.replace(/\\/$/i, '');\n\n\t\t\t\t\tif (typeof this.link.url !== \"undefined\")\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.link.url = this.link.url.replace(thref, '');\n\t\t\t\t\t\tthis.link.url = this.link.url.replace(/^\\/#/, '#');\n\t\t\t\t\t\tthis.link.url = this.link.url.replace('mailto:', '');\n\n\t\t\t\t\t\t// remove host from href\n\t\t\t\t\t\tif (!this.opts.linkProtocol)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar re = new RegExp('^(http|ftp|https)://' + self.location.host, 'i');\n\t\t\t\t\t\t\tthis.link.url = this.link.url.replace(re, '');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tgetData: function()\n\t\t\t\t{\n\t\t\t\t\tthis.link.$node = false;\n\n\t\t\t\t\tvar $el = $(this.selection.getCurrent()).closest('a', this.$editor[0]);\n\t\t\t\t\tif ($el.length !== 0 && $el[0].tagName === 'A')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.link.$node = $el;\n\n\t\t\t\t\t\tthis.link.url = $el.attr('href');\n\t\t\t\t\t\tthis.link.text = $el.text();\n\t\t\t\t\t\tthis.link.target = $el.attr('target');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.link.text = this.sel.toString();\n\t\t\t\t\t\tthis.link.url = '';\n\t\t\t\t\t\tthis.link.target = '';\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tinsert: function()\n\t\t\t\t{\n\t\t\t\t\tthis.placeholder.remove();\n\n\t\t\t\t\tvar target = '';\n\t\t\t\t\tvar link = this.link.$inputUrl.val();\n\t\t\t\t\tvar text = this.link.$inputText.val();\n\n\t\t\t\t\tif ($.trim(link) === '')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.link.$inputUrl.addClass('redactor-input-error').on('keyup', function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(this).removeClass('redactor-input-error');\n\t\t\t\t\t\t\t$(this).off('keyup');\n\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t// mailto\n\t\t\t\t\tif (link.search('@') != -1 && /(http|ftp|https):\\/\\//i.test(link) === false)\n\t\t\t\t\t{\n\t\t\t\t\t\tlink = 'mailto:' + link;\n\t\t\t\t\t}\n\t\t\t\t\t// url, not anchor\n\t\t\t\t\telse if (link.search('#') !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($('#redactor-link-blank').prop('checked'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttarget = '_blank';\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// test url (add protocol)\n\t\t\t\t\t\tvar pattern = '((xn--)?[a-z0-9]+(-[a-z0-9]+)*\\\\.)+[a-z]{2,}';\n\t\t\t\t\t\tvar re = new RegExp('^(http|ftp|https)://' + pattern, 'i');\n\t\t\t\t\t\tvar re2 = new RegExp('^' + pattern, 'i');\n\t\t\t\t\t\tvar re3 = new RegExp('\\.(html|php)$', 'i');\n\t\t\t\t\t\tif (link.search(re) == -1 && link.search(re3) == -1 && link.search(re2) === 0 && this.opts.linkProtocol)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlink = this.opts.linkProtocol + '://' + link;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.link.set(text, link, target);\n\t\t\t\t\tthis.modal.close();\n\t\t\t\t},\n\t\t\t\tset: function(text, link, target)\n\t\t\t\t{\n\t\t\t\t\ttext = $.trim(text.replace(/<|>/g, ''));\n\n\t\t\t\t\tthis.selection.restore();\n\n\t\t\t\t\tif (text === '' && link === '') return;\n\t\t\t\t\tif (text === '' && link !== '') text = link;\n\n\t\t\t\t\tif (this.link.$node)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\t\tvar $link = this.link.$node,\n\t\t\t\t\t\t\t$el   = $link.children();\n\n\t\t\t\t\t\tif ($el.length > 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\twhile ($el.length)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$el = $el.children();\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$el = $el.end();\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$el = $link;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$link.attr('href', link);\n\t\t\t\t\t\t$el.text(text);\n\n\t\t\t\t\t\tif (target !== '')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$link.attr('target', target);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$link.removeAttr('target');\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.selection.selectElement($link);\n\n\t\t\t\t\t\tthis.code.sync();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.utils.browser('mozilla') && this.link.text === '')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar $a = $('<a />').attr('href', link).text(text);\n\t\t\t\t\t\t\tif (target !== '') $a.attr('target', target);\n\n\t\t\t\t\t\t\tthis.insert.node($a);\n\t\t\t\t\t\t\tthis.selection.selectElement($a);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar $a;\n\t\t\t\t\t\t\tif (this.utils.browser('msie'))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$a = $('<a href=\"' + link + '\">').text(text);\n\t\t\t\t\t\t\t\tif (target !== '') $a.attr('target', target);\n\n\t\t\t\t\t\t\t\t$a = $(this.insert.node($a));\n\n\t\t\t\t\t\t\t\tif (this.selection.getText().match(/\\s$/))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t$a.after(\" \");\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tthis.selection.selectElement($a);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tdocument.execCommand('createLink', false, link);\n\n\t\t\t\t\t\t\t\t$a = $(this.selection.getCurrent()).closest('a', this.$editor[0]);\n\t\t\t\t\t\t\t\tif (this.utils.browser('mozilla'))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t$a = $('a[_moz_dirty=\"\"]');\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (target !== '') $a.attr('target', target);\n\t\t\t\t\t\t\t\t$a.removeAttr('style').removeAttr('_moz_dirty');\n\n\t\t\t\t\t\t\t\tif (this.selection.getText().match(/\\s$/))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t$a.after(\" \");\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (this.link.text !== '' || this.link.text != text)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t$a.text(text);\n\n\t\t\t\t\t\t\t\t\tthis.selection.selectElement($a);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.code.sync();\n\t\t\t\t\t\tthis.core.setCallback('insertedLink', $a);\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// link tooltip\n\t\t\t\t\tsetTimeout($.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.observe.links();\n\n\t\t\t\t\t}, this), 5);\n\t\t\t\t},\n\t\t\t\tunlink: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (typeof e != 'undefined' && e.preventDefault)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\n\t\t\t\t\tvar nodes = this.selection.getNodes();\n\t\t\t\t\tif (!nodes) return;\n\n\t\t\t\t\tthis.buffer.set();\n\n\t\t\t\t\tvar len = nodes.length;\n\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $node = $(nodes[i]).closest('a', this.$editor[0]);\n\t\t\t\t\t\t$node.replaceWith($node.contents());\n\t\t\t\t\t}\n\n\t\t\t\t\t// hide link's tooltip\n\t\t\t\t\t$('.redactor-link-tooltip').remove();\n\n\t\t\t\t\tthis.code.sync();\n\n\t\t\t\t},\n\t\t\t\ttoggleClass: function(className)\n\t\t\t\t{\n\t\t\t\t\tthis.link.setClass(className, 'toggleClass');\n\t\t\t\t},\n\t\t\t\taddClass: function(className)\n\t\t\t\t{\n\t\t\t\t\tthis.link.setClass(className, 'addClass');\n\t\t\t\t},\n\t\t\t\tremoveClass: function(className)\n\t\t\t\t{\n\t\t\t\t\tthis.link.setClass(className, 'removeClass');\n\t\t\t\t},\n\t\t\t\tsetClass: function(className, func)\n\t\t\t\t{\n\t\t\t\t\tvar links = this.selection.getInlinesTags(['a']);\n\t\t\t\t\tif (links === false) return;\n\n\t\t\t\t\t$.each(links, function()\n\t\t\t\t\t{\n\t\t\t\t\t\t$(this)[func](className);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tlist: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\ttoggle: function(cmd)\n\t\t\t\t{\n\t\t\t\t\tthis.placeholder.remove();\n\t\t\t\t\tif (!this.utils.browser('msie')) this.$editor.focus();\n\n\t\t\t\t\tthis.buffer.set();\n\t\t\t\t\tthis.selection.save();\n\n\t\t\t\t\tvar parent = this.selection.getParent();\n\t\t\t\t\tvar $list = $(parent).closest('ol, ul', this.$editor[0]);\n\n\t\t\t\t\tif (!this.utils.isRedactorParent($list) && $list.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$list = false;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar isUnorderedCmdOrdered, isOrderedCmdUnordered;\n\t\t\t\t\tvar remove = false;\n\t\t\t\t\tif ($list && $list.length)\n\t\t\t\t\t{\n\t\t\t\t\t\tremove = true;\n\t\t\t\t\t\tvar listTag = $list[0].tagName;\n\n\t\t\t\t\t\tisUnorderedCmdOrdered = (cmd === 'orderedlist' && listTag === 'UL');\n\t\t\t\t\t\tisOrderedCmdUnordered = (cmd === 'unorderedlist' && listTag === 'OL');\n\t\t\t\t\t}\n\n\t\t\t\t\tif (isUnorderedCmdOrdered)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.utils.replaceToTag($list, 'ol');\n\t\t\t\t\t}\n\t\t\t\t\telse if (isOrderedCmdUnordered)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.utils.replaceToTag($list, 'ul');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tif (remove)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.list.remove(cmd);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.list.insert(cmd);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\tthis.code.sync();\n\t\t\t\t},\n\t\t\t\tinsert: function(cmd)\n\t\t\t\t{\n\t\t\t\t\tvar parent = this.selection.getParent();\n\t\t\t\t\tvar current = this.selection.getCurrent();\n\t\t\t\t\tvar $td = $(current).closest('td, th', this.$editor[0]);\n\n\t\t\t\t\tif (this.utils.browser('msie') && this.opts.linebreaks)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.list.insertInIe(cmd);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tdocument.execCommand('insert' + cmd);\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $list = $(this.selection.getParent()).closest('ol, ul', this.$editor[0]);\n\n\t\t\t\t\tif ($td.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar prev = $td.prev();\n\t\t\t\t\t\tvar html = $td.html();\n\t\t\t\t\t\t$td.html('');\n\t\t\t\t\t\tif (prev && prev.length === 1 && (prev[0].tagName === 'TD' || prev[0].tagName === 'TH'))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(prev).after($td);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(parent).prepend($td);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$td.html(html);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.utils.isEmpty($list.find('li').text()))\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $children = $list.children('li');\n\t\t\t\t\t\t$children.find('br').remove();\n\t\t\t\t\t\t$children.append(this.selection.getMarkerAsHtml());\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($list.length)\n\t\t\t\t\t{\n\t\t\t\t\t\t// remove block-element list wrapper\n\t\t\t\t\t\tvar $listParent = $list.parent();\n\t\t\t\t\t\tif (this.utils.isRedactorParent($listParent) && $listParent[0].tagName != 'LI' && this.utils.isBlock($listParent[0]))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$listParent.replaceWith($listParent.contents());\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this.utils.browser('msie'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$editor.focus();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.clean.clearUnverified();\n\t\t\t\t},\n\t\t\t\tinsertInIe: function(cmd)\n\t\t\t\t{\n\t\t\t\t\tvar wrapper = this.selection.wrap('div');\n\t\t\t\t\tvar wrapperHtml = $(wrapper).html();\n\n\t\t\t\t\tvar tmpList = (cmd == 'orderedlist') ? $('<ol>') : $('<ul>');\n\t\t\t\t\tvar tmpLi = $('<li>');\n\n\t\t\t\t\tif ($.trim(wrapperHtml) === '')\n\t\t\t\t\t{\n\t\t\t\t\t\ttmpLi.append(this.selection.getMarkerAsHtml());\n\t\t\t\t\t\ttmpList.append(tmpLi);\n\t\t\t\t\t\tthis.$editor.find('#selection-marker-1').replaceWith(tmpList);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tvar items = wrapperHtml.split(/<br\\s?\\/?>/gi);\n\t\t\t\t\t\tif (items)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfor (var i = 0; i < items.length; i++)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif ($.trim(items[i]) !== '')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttmpList.append($('<li>').html(items[i]));\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttmpLi.append(wrapperHtml);\n\t\t\t\t\t\t\ttmpList.append(tmpLi);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$(wrapper).replaceWith(tmpList);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tremove: function(cmd)\n\t\t\t\t{\n\t\t\t\t\tdocument.execCommand('insert' + cmd);\n\n\t\t\t\t\tvar $current = $(this.selection.getCurrent());\n\n\t\t\t\t\tthis.indent.fixEmptyIndent();\n\n\t\t\t\t\tif (!this.opts.linebreaks && $current.closest('li, th, td', this.$editor[0]).length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tdocument.execCommand('formatblock', false, 'p');\n\t\t\t\t\t\tthis.$editor.find('ul, ol, blockquote').each($.proxy(this.utils.removeEmpty, this));\n\t\t\t\t\t}\n\n\t\t\t\t\tvar $table = $(this.selection.getCurrent()).closest('table', this.$editor[0]);\n\t\t\t\t\tvar $prev = $table.prev();\n\t\t\t\t\tif (!this.opts.linebreaks && $table.length !== 0 && $prev.length !== 0 && $prev[0].tagName == 'BR')\n\t\t\t\t\t{\n\t\t\t\t\t\t$prev.remove();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.clean.clearUnverified();\n\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tmodal: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tcallbacks: {},\n\t\t\t\tloadTemplates: function()\n\t\t\t\t{\n\t\t\t\t\tthis.opts.modal = {\n\t\t\t\t\t\timageEdit: String()\n\t\t\t\t\t\t+ '<section id=\"redactor-modal-image-edit\">'\n\t\t\t\t\t\t\t+ '<label>' + this.lang.get('title') + '</label>'\n\t\t\t\t\t\t\t+ '<input type=\"text\" id=\"redactor-image-title\" />'\n\t\t\t\t\t\t\t+ '<label class=\"redactor-image-link-option\">' + this.lang.get('link') + '</label>'\n\t\t\t\t\t\t\t+ '<input type=\"text\" id=\"redactor-image-link\" class=\"redactor-image-link-option\" />'\n\t\t\t\t\t\t\t+ '<label class=\"redactor-image-link-option\"><input type=\"checkbox\" id=\"redactor-image-link-blank\"> ' + this.lang.get('link_new_tab') + '</label>'\n\t\t\t\t\t\t\t+ '<label class=\"redactor-image-position-option\">' + this.lang.get('image_position') + '</label>'\n\t\t\t\t\t\t\t+ '<select class=\"redactor-image-position-option\" id=\"redactor-image-align\">'\n\t\t\t\t\t\t\t\t+ '<option value=\"none\">' + this.lang.get('none') + '</option>'\n\t\t\t\t\t\t\t\t+ '<option value=\"left\">' + this.lang.get('left') + '</option>'\n\t\t\t\t\t\t\t\t+ '<option value=\"center\">' + this.lang.get('center') + '</option>'\n\t\t\t\t\t\t\t\t+ '<option value=\"right\">' + this.lang.get('right') + '</option>'\n\t\t\t\t\t\t\t+ '</select>'\n\t\t\t\t\t\t+ '</section>',\n\n\t\t\t\t\t\timage: String()\n\t\t\t\t\t\t+ '<section id=\"redactor-modal-image-insert\">'\n\t\t\t\t\t\t\t+ '<div id=\"redactor-modal-image-droparea\"></div>'\n \t\t\t\t\t\t+ '</section>',\n\n\t\t\t\t\t\tfile: String()\n\t\t\t\t\t\t+ '<section id=\"redactor-modal-file-insert\">'\n\t\t\t\t\t\t\t+ '<div id=\"redactor-modal-file-upload-box\">'\n\t\t\t\t\t\t\t\t+ '<label>' + this.lang.get('filename') + '</label>'\n\t\t\t\t\t\t\t\t+ '<input type=\"text\" id=\"redactor-filename\" /><br><br>'\n\t\t\t\t\t\t\t\t+ '<div id=\"redactor-modal-file-upload\"></div>'\n\t\t\t\t\t\t\t+ '</div>'\n\t\t\t\t\t\t+ '</section>',\n\n\t\t\t\t\t\tlink: String()\n\t\t\t\t\t\t+ '<section id=\"redactor-modal-link-insert\">'\n\t\t\t\t\t\t\t+ '<label>URL</label>'\n\t\t\t\t\t\t\t+ '<input type=\"url\" id=\"redactor-link-url\" />'\n\t\t\t\t\t\t\t+ '<label>' + this.lang.get('text') + '</label>'\n\t\t\t\t\t\t\t+ '<input type=\"text\" id=\"redactor-link-url-text\" />'\n\t\t\t\t\t\t\t+ '<label><input type=\"checkbox\" id=\"redactor-link-blank\"> ' + this.lang.get('link_new_tab') + '</label>'\n\t\t\t\t\t\t+ '</section>'\n\t\t\t\t\t};\n\n\n\t\t\t\t\t$.extend(this.opts, this.opts.modal);\n\n\t\t\t\t},\n\t\t\t\taddCallback: function(name, callback)\n\t\t\t\t{\n\t\t\t\t\tthis.modal.callbacks[name] = callback;\n\t\t\t\t},\n\t\t\t\tcreateTabber: function($modal)\n\t\t\t\t{\n\t\t\t\t\tthis.modal.$tabber = $('<div>').attr('id', 'redactor-modal-tabber');\n\n\t\t\t\t\t$modal.prepend(this.modal.$tabber);\n\t\t\t\t},\n\t\t\t\taddTab: function(id, name, active)\n\t\t\t\t{\n\t\t\t\t\tvar $tab = $('<a href=\"#\" rel=\"tab' + id + '\">').text(name);\n\t\t\t\t\tif (active)\n\t\t\t\t\t{\n\t\t\t\t\t\t$tab.addClass('active');\n\t\t\t\t\t}\n\n\t\t\t\t\tvar self = this;\n\t\t\t\t\t$tab.on('click', function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t$('.redactor-tab').hide();\n\t\t\t\t\t\t$('.redactor-' + $(this).attr('rel')).show();\n\n\t\t\t\t\t\tself.modal.$tabber.find('a').removeClass('active');\n\t\t\t\t\t\t$(this).addClass('active');\n\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.modal.$tabber.append($tab);\n\t\t\t\t},\n\t\t\t\taddTemplate: function(name, template)\n\t\t\t\t{\n\t\t\t\t\tthis.opts.modal[name] = template;\n\t\t\t\t},\n\t\t\t\tgetTemplate: function(name)\n\t\t\t\t{\n\t\t\t\t\treturn this.opts.modal[name];\n\t\t\t\t},\n\t\t\t\tgetModal: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.$modalBody.find('section');\n\t\t\t\t},\n\t\t\t\tload: function(templateName, title, width)\n\t\t\t\t{\n\t\t\t\t\tthis.modal.templateName = templateName;\n\t\t\t\t\tthis.modal.width = width;\n\n\t\t\t\t\tthis.modal.build();\n\t\t\t\t\tthis.modal.enableEvents();\n\t\t\t\t\tthis.modal.setTitle(title);\n\t\t\t\t\tthis.modal.setDraggable();\n\t\t\t\t\tthis.modal.setContent();\n\n\t\t\t\t\t// callbacks\n\t\t\t\t\tif (typeof this.modal.callbacks[templateName] != 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.modal.callbacks[templateName].call(this);\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tshow: function()\n\t\t\t\t{\n\t\t\t\t\t// ios keyboard hide\n\t\t\t\t\tif (this.utils.isMobile() && !this.utils.browser('msie'))\n\t\t\t\t\t{\n\t\t\t\t\t\tdocument.activeElement.blur();\n\t\t\t\t\t}\n\n\t\t\t\t\t$(document.body).removeClass('body-redactor-hidden');\n\t\t\t\t\tthis.modal.bodyOveflow = $(document.body).css('overflow');\n\t\t\t\t\t$(document.body).css('overflow', 'hidden');\n\n\t\t\t\t\tif (this.utils.isMobile())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.modal.showOnMobile();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.modal.showOnDesktop();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.$modalOverlay.show();\n\t\t\t\t\tthis.$modalBox.show();\n\n\t\t\t\t\tthis.modal.setButtonsWidth();\n\n\t\t\t\t\tthis.utils.saveScroll();\n\n\t\t\t\t\t// resize\n\t\t\t\t\tif (!this.utils.isMobile())\n\t\t\t\t\t{\n\t\t\t\t\t\tsetTimeout($.proxy(this.modal.showOnDesktop, this), 0);\n\t\t\t\t\t\t$(window).on('resize.redactor-modal', $.proxy(this.modal.resize, this));\n\t\t\t\t\t}\n\n\t\t\t\t\t// modal shown callback\n\t\t\t\t\tthis.core.setCallback('modalOpened', this.modal.templateName, this.$modal);\n\n\t\t\t\t\t// fix bootstrap modal focus\n\t\t\t\t\t$(document).off('focusin.modal');\n\n\t\t\t\t\t// enter\n\t\t\t\t\tthis.$modal.find('input[type=text],input[type=url],input[type=email]').on('keydown.redactor-modal', $.proxy(this.modal.setEnter, this));\n\t\t\t\t},\n\t\t\t\tshowOnDesktop: function()\n\t\t\t\t{\n\t\t\t\t\tvar height = this.$modal.outerHeight();\n\t\t\t\t\tvar windowHeight = $(window).height();\n\t\t\t\t\tvar windowWidth = $(window).width();\n\n\t\t\t\t\tif (this.modal.width > windowWidth)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$modal.css({\n\t\t\t\t\t\t\twidth: '96%',\n\t\t\t\t\t\t\tmarginTop: (windowHeight/2 - height/2) + 'px'\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (height > windowHeight)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$modal.css({\n\t\t\t\t\t\t\twidth: this.modal.width + 'px',\n\t\t\t\t\t\t\tmarginTop: '20px'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$modal.css({\n\t\t\t\t\t\t\twidth: this.modal.width + 'px',\n\t\t\t\t\t\t\tmarginTop: (windowHeight/2 - height/2) + 'px'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tshowOnMobile: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$modal.css({\n\t\t\t\t\t\twidth: '96%',\n\t\t\t\t\t\tmarginTop: '2%'\n\t\t\t\t\t});\n\n\t\t\t\t},\n\t\t\t\tresize: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.utils.isMobile())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.modal.showOnMobile();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.modal.showOnDesktop();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetTitle: function(title)\n\t\t\t\t{\n\t\t\t\t\tthis.$modalHeader.html(title);\n\t\t\t\t},\n\t\t\t\tsetContent: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$modalBody.html(this.modal.getTemplate(this.modal.templateName));\n\t\t\t\t},\n\t\t\t\tsetDraggable: function()\n\t\t\t\t{\n\t\t\t\t\tif (typeof $.fn.draggable === 'undefined') return;\n\n\t\t\t\t\tthis.$modal.draggable({ handle: this.$modalHeader });\n\t\t\t\t\tthis.$modalHeader.css('cursor', 'move');\n\t\t\t\t},\n\t\t\t\tsetEnter: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (e.which != 13) return;\n\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tthis.$modal.find('button.redactor-modal-action-btn').click();\n\t\t\t\t},\n\t\t\t\tcreateCancelButton: function()\n\t\t\t\t{\n\t\t\t\t\tvar button = $('<button>').addClass('redactor-modal-btn redactor-modal-close-btn').html(this.lang.get('cancel'));\n\t\t\t\t\tbutton.on('click', $.proxy(this.modal.close, this));\n\n\t\t\t\t\tthis.$modalFooter.append(button);\n\t\t\t\t},\n\t\t\t\tcreateDeleteButton: function(label)\n\t\t\t\t{\n\t\t\t\t\treturn this.modal.createButton(label, 'delete');\n\t\t\t\t},\n\t\t\t\tcreateActionButton: function(label)\n\t\t\t\t{\n\t\t\t\t\treturn this.modal.createButton(label, 'action');\n\t\t\t\t},\n\t\t\t\tcreateButton: function(label, className)\n\t\t\t\t{\n\t\t\t\t\tvar button = $('<button>').addClass('redactor-modal-btn').addClass('redactor-modal-' + className + '-btn').html(label);\n\t\t\t\t\tthis.$modalFooter.append(button);\n\n\t\t\t\t\treturn button;\n\t\t\t\t},\n\t\t\t\tsetButtonsWidth: function()\n\t\t\t\t{\n\t\t\t\t\tvar buttons = this.$modalFooter.find('button');\n\t\t\t\t\tvar buttonsSize = buttons.length;\n\t\t\t\t\tif (buttonsSize === 0) return;\n\n\t\t\t\t\tbuttons.css('width', (100/buttonsSize) + '%');\n\t\t\t\t},\n\t\t\t\tbuild: function()\n\t\t\t\t{\n\t\t\t\t\tthis.modal.buildOverlay();\n\n\t\t\t\t\tthis.$modalBox = $('<div id=\"redactor-modal-box\" />').hide();\n\t\t\t\t\tthis.$modal = $('<div id=\"redactor-modal\" />');\n\t\t\t\t\tthis.$modalHeader = $('<header />');\n\t\t\t\t\tthis.$modalClose = $('<span id=\"redactor-modal-close\" />').html('&times;');\n\t\t\t\t\tthis.$modalBody = $('<div id=\"redactor-modal-body\" />');\n\t\t\t\t\tthis.$modalFooter = $('<footer />');\n\n\t\t\t\t\tthis.$modal.append(this.$modalHeader);\n\t\t\t\t\tthis.$modal.append(this.$modalClose);\n\t\t\t\t\tthis.$modal.append(this.$modalBody);\n\t\t\t\t\tthis.$modal.append(this.$modalFooter);\n\t\t\t\t\tthis.$modalBox.append(this.$modal);\n\t\t\t\t\tthis.$modalBox.appendTo(document.body);\n\t\t\t\t},\n\t\t\t\tbuildOverlay: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$modalOverlay = $('<div id=\"redactor-modal-overlay\">').hide();\n\t\t\t\t\t$('body').prepend(this.$modalOverlay);\n\t\t\t\t},\n\t\t\t\tenableEvents: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$modalClose.on('click.redactor-modal', $.proxy(this.modal.close, this));\n\t\t\t\t\t$(document).on('keyup.redactor-modal', $.proxy(this.modal.closeHandler, this));\n\t\t\t\t\tthis.$editor.on('keyup.redactor-modal', $.proxy(this.modal.closeHandler, this));\n\t\t\t\t\tthis.$modalBox.on('click.redactor-modal', $.proxy(this.modal.close, this));\n\t\t\t\t},\n\t\t\t\tdisableEvents: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$modalClose.off('click.redactor-modal');\n\t\t\t\t\t$(document).off('keyup.redactor-modal');\n\t\t\t\t\tthis.$editor.off('keyup.redactor-modal');\n\t\t\t\t\tthis.$modalBox.off('click.redactor-modal');\n\t\t\t\t\t$(window).off('resize.redactor-modal');\n\t\t\t\t},\n\t\t\t\tcloseHandler: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (e.which != this.keyCode.ESC) return;\n\n\t\t\t\t\tthis.modal.close(false);\n\t\t\t\t},\n\t\t\t\tclose: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (e)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!$(e.target).hasClass('redactor-modal-close-btn') && e.target != this.$modalClose[0] && e.target != this.$modalBox[0])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!this.$modalBox) return;\n\n\t\t\t\t\tthis.modal.disableEvents();\n\n\t\t\t\t\tthis.$modalOverlay.remove();\n\n\t\t\t\t\tthis.$modalBox.fadeOut('fast', $.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$modalBox.remove();\n\n\t\t\t\t\t\tsetTimeout($.proxy(this.utils.restoreScroll, this), 0);\n\n\t\t\t\t\t\tif (e !== undefined) this.selection.restore();\n\n\t\t\t\t\t\t$(document.body).css('overflow', this.modal.bodyOveflow);\n\t\t\t\t\t\tthis.core.setCallback('modalClosed', this.modal.templateName);\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tobserve: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tload: function()\n\t\t\t\t{\n\t\t\t\t\tthis.observe.images();\n\t\t\t\t\tthis.observe.links();\n\t\t\t\t},\n\t\t\t\tbuttons: function(e, btnName)\n\t\t\t\t{\n\t\t\t\t\tvar current = this.selection.getCurrent();\n\t\t\t\t\tvar parent = this.selection.getParent();\n\n\t\t\t\t\tif (e !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.button.setInactiveAll();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.button.setInactiveAll(btnName);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (e === false && btnName !== 'html')\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($.inArray(btnName, this.opts.activeButtons) != -1) this.button.toggleActive(btnName);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t//var linkButtonName = (this.utils.isCurrentOrParent('A')) ? this.lang.get('link_edit') : this.lang.get('link_insert');\n\t\t\t\t\t//$('body').find('a.redactor-dropdown-link').text(linkButtonName);\n\n\t\t\t\t\t$.each(this.opts.activeButtonsStates, $.proxy(function(key, value)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar parentEl = $(parent).closest(key, this.$editor[0]);\n\t\t\t\t\t\tvar currentEl = $(current).closest(key, this.$editor[0]);\n\n\t\t\t\t\t\tif (parentEl.length !== 0 && !this.utils.isRedactorParent(parentEl)) return;\n\t\t\t\t\t\tif (!this.utils.isRedactorParent(currentEl)) return;\n\t\t\t\t\t\tif (parentEl.length !== 0 || currentEl.closest(key, this.$editor[0]).length !== 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.button.setActive(value);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\tvar $parent = $(parent).closest(this.opts.alignmentTags.toString().toLowerCase(), this.$editor[0]);\n\t\t\t\t\tif (this.utils.isRedactorParent(parent) && $parent.length)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar align = ($parent.css('text-align') === '') ? 'left' : $parent.css('text-align');\n\t\t\t\t\t\tthis.button.setActive('align' + align);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\taddButton: function(tag, btnName)\n\t\t\t\t{\n\t\t\t\t\tthis.opts.activeButtons.push(btnName);\n\t\t\t\t\tthis.opts.activeButtonsStates[tag] = btnName;\n\t\t\t\t},\n\t\t\t\timages: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$editor.find('img').each($.proxy(function(i, img)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $img = $(img);\n\n\t\t\t\t\t\t// IE fix (when we clicked on an image and then press backspace IE does goes to image's url)\n\t\t\t\t\t\t$img.closest('a', this.$editor[0]).on('click', function(e) { e.preventDefault(); });\n\n\t\t\t\t\t\tif (this.utils.browser('msie')) $img.attr('unselectable', 'on');\n\n\t\t\t\t\t\tthis.image.setEditable($img);\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\t$(document).on('click.redactor-image-delete.' + this.uuid, $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.observe.image = false;\n\t\t\t\t\t\tif (e.target.tagName == 'IMG' && this.utils.isRedactorParent(e.target))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.observe.image = (this.observe.image && this.observe.image == e.target) ? false : e.target;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t},\n\t\t\t\tlinks: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.opts.linkTooltip) return;\n\n\t\t\t\t\tthis.$editor.find('a').on('touchstart.redactor.' + this.uuid + ' click.redactor.' + this.uuid, $.proxy(this.observe.showTooltip, this));\n\t\t\t\t\tthis.$editor.on('touchstart.redactor.' + this.uuid + ' click.redactor.' + this.uuid, $.proxy(this.observe.closeTooltip, this));\n\t\t\t\t\t$(document).on('touchstart.redactor.' + this.uuid + ' click.redactor.' + this.uuid, $.proxy(this.observe.closeTooltip, this));\n\t\t\t\t},\n\t\t\t\tgetTooltipPosition: function($link)\n\t\t\t\t{\n\t\t\t\t\treturn $link.offset();\n\t\t\t\t},\n\t\t\t\tshowTooltip: function(e)\n\t\t\t\t{\n\t\t\t\t\tvar $el = $(e.target);\n\n\t\t\t\t\tif ($el[0].tagName == 'IMG')\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tif ($el[0].tagName !== 'A')\n\t\t\t\t\t\t$el = $el.closest('a', this.$editor[0]);\n\n\t\t\t\t\tif ($el[0].tagName !== 'A')\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tvar $link = $el;\n\n\t\t\t\t\tvar pos = this.observe.getTooltipPosition($link);\n\t\t\t\t\tvar tooltip = $('<span class=\"redactor-link-tooltip\"></span>');\n\n\t\t\t\t\tvar href = $link.attr('href');\n\t\t\t\t\tif (href === undefined)\n\t\t\t\t\t{\n\t\t\t\t\t\thref = '';\n\t\t\t\t\t}\n\n\t\t\t\t\tif (href.length > 24) href = href.substring(0, 24) + '...';\n\n\t\t\t\t\tvar aLink = $('<a href=\"' + $link.attr('href') + '\" target=\"_blank\" />').html(href).addClass('redactor-link-tooltip-action');\n\t\t\t\t\tvar aEdit = $('<a href=\"#\" />').html(this.lang.get('edit')).on('click', $.proxy(this.link.show, this)).addClass('redactor-link-tooltip-action');\n\t\t\t\t\tvar aUnlink = $('<a href=\"#\" />').html(this.lang.get('unlink')).on('click', $.proxy(this.link.unlink, this)).addClass('redactor-link-tooltip-action');\n\n\t\t\t\t\ttooltip.append(aLink).append(' | ').append(aEdit).append(' | ').append(aUnlink);\n\t\t\t\t\ttooltip.css({\n\t\t\t\t\t\ttop: (pos.top + parseInt($link.css('line-height'), 10)) + 'px',\n\t\t\t\t\t\tleft: pos.left + 'px'\n\t\t\t\t\t});\n\n\t\t\t\t\t$('.redactor-link-tooltip').remove();\n\t\t\t\t\t$('body').append(tooltip);\n\t\t\t\t},\n\t\t\t\tcloseTooltip: function(e)\n\t\t\t\t{\n\t\t\t\t\te = e.originalEvent || e;\n\n\t\t\t\t\tvar target = e.target;\n\t\t\t\t\tvar $parent = $(target).closest('a', this.$editor[0]);\n\t\t\t\t\tif ($parent.length !== 0 && $parent[0].tagName === 'A' && target.tagName !== 'A')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\telse if ((target.tagName === 'A' && this.utils.isRedactorParent(target)) || $(target).hasClass('redactor-link-tooltip-action'))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\t$('.redactor-link-tooltip').remove();\n\t\t\t\t}\n\n\t\t\t};\n\t\t},\n\t\tparagraphize: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tload: function(html)\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.linebreaks) return html;\n\t\t\t\t\tif (html === '' || html === '<p></p>') return this.opts.emptyHtml;\n\n\t\t\t\t\thtml = html + \"\\n\";\n\n\t\t\t\t\tthis.paragraphize.safes = [];\n\t\t\t\t\tthis.paragraphize.z = 0;\n\n\t\t\t\t\thtml = html.replace(/(<br\\s?\\/?>){1,}\\n?<\\/blockquote>/gi, '</blockquote>');\n\n\t\t\t\t\thtml = this.paragraphize.getSafes(html);\n\t\t\t\t\thtml = this.paragraphize.getSafesComments(html);\n\t\t\t\t\thtml = this.paragraphize.replaceBreaksToNewLines(html);\n\t\t\t\t\thtml = this.paragraphize.replaceBreaksToParagraphs(html);\n\t\t\t\t\thtml = this.paragraphize.clear(html);\n\t\t\t\t\thtml = this.paragraphize.restoreSafes(html);\n\n\t\t\t\t\thtml = html.replace(new RegExp('<br\\\\s?/?>\\n?<(' + this.opts.paragraphizeBlocks.join('|') + ')(.*?[^>])>', 'gi'), '<p><br /></p>\\n<$1$2>');\n\n\t\t\t\t\treturn $.trim(html);\n\t\t\t\t},\n\t\t\t\tgetSafes: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar $div = $('<div />').append(html);\n\n\t\t\t\t\t// remove paragraphs in blockquotes\n\t\t\t\t\t$div.find('blockquote p').replaceWith(function()\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $(this).append('<br />').contents();\n\t\t\t\t\t});\n\n\t\t\t\t\thtml = $div.html();\n\n\t\t\t\t\t$div.find(this.opts.paragraphizeBlocks.join(', ')).each($.proxy(function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.paragraphize.z++;\n\t\t\t\t\t\tthis.paragraphize.safes[this.paragraphize.z] = s.outerHTML;\n\t\t\t\t\t\thtml = html.replace(s.outerHTML, '\\n{replace' + this.paragraphize.z + '}');\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tgetSafesComments: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar commentsMatches = html.match(/<!--([\\w\\W]*?)-->/gi);\n\n\t\t\t\t\tif (!commentsMatches) return html;\n\n\t\t\t\t\t$.each(commentsMatches, $.proxy(function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.paragraphize.z++;\n\t\t\t\t\t\tthis.paragraphize.safes[this.paragraphize.z] = s;\n\t\t\t\t\t\thtml = html.replace(s, '\\n{replace' + this.paragraphize.z + '}');\n\t\t\t\t\t}, this));\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\trestoreSafes: function(html)\n\t\t\t\t{\n\t\t\t\t\t$.each(this.paragraphize.safes, function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\ts = (typeof s !== 'undefined') ? s.replace(/\\$/g, '&#36;') : s;\n\t\t\t\t\t\thtml = html.replace('{replace' + i + '}', s);\n\n\t\t\t\t\t});\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\treplaceBreaksToParagraphs: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar htmls = html.split(new RegExp('\\n', 'g'), -1);\n\n\t\t\t\t\thtml = '';\n\t\t\t\t\tif (htmls)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar len = htmls.length;\n\t\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (!htmls.hasOwnProperty(i)) return;\n\n\t\t\t\t\t\t\tif (htmls[i].search('{replace') == -1)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\thtmls[i] = htmls[i].replace(/<p>\\n\\t?<\\/p>/gi, '');\n\t\t\t\t\t\t\t\thtmls[i] = htmls[i].replace(/<p><\\/p>/gi, '');\n\n\t\t\t\t\t\t\t\tif (htmls[i] !== '')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\thtml += '<p>' +  htmls[i].replace(/^\\n+|\\n+$/g, \"\") + \"</p>\";\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse html += htmls[i];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\treplaceBreaksToNewLines: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = html.replace(/<br \\/>\\s*<br \\/>/gi, \"\\n\\n\");\n\t\t\t\t\thtml = html.replace(/<br\\s?\\/?>\\n?<br\\s?\\/?>/gi, \"\\n<br /><br />\");\n\n\t\t\t\t\thtml = html.replace(new RegExp(\"\\r\\n\", 'g'), \"\\n\");\n\t\t\t\t\thtml = html.replace(new RegExp(\"\\r\", 'g'), \"\\n\");\n\t\t\t\t\thtml = html.replace(new RegExp(\"/\\n\\n+/\"), 'g', \"\\n\\n\");\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tclear: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = html.replace(new RegExp('</blockquote></p>', 'gi'), '</blockquote>');\n\t\t\t\t\thtml = html.replace(new RegExp('<p></blockquote>', 'gi'), '</blockquote>');\n\t\t\t\t\thtml = html.replace(new RegExp('<p><blockquote>', 'gi'), '<blockquote>');\n\t\t\t\t\thtml = html.replace(new RegExp('<blockquote></p>', 'gi'), '<blockquote>');\n\n\t\t\t\t\thtml = html.replace(new RegExp('<p><p ', 'gi'), '<p ');\n\t\t\t\t\thtml = html.replace(new RegExp('<p><p>', 'gi'), '<p>');\n\t\t\t\t\thtml = html.replace(new RegExp('</p></p>', 'gi'), '</p>');\n\t\t\t\t\thtml = html.replace(new RegExp('<p>\\\\s?</p>', 'gi'), '');\n\t\t\t\t\thtml = html.replace(new RegExp(\"\\n</p>\", 'gi'), '</p>');\n\t\t\t\t\thtml = html.replace(new RegExp('<p>\\t?\\t?\\n?<p>', 'gi'), '<p>');\n\t\t\t\t\thtml = html.replace(new RegExp('<p>\\t*</p>', 'gi'), '');\n\n\t\t\t\t\treturn html;\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tpaste: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tinit: function(e)\n\t\t\t\t{\n\t\t\t\t\tif (!this.opts.cleanOnPaste)\n\t\t\t\t\t{\n\t\t\t\t\t\tsetTimeout($.proxy(this.code.sync, this), 1);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.rtePaste = true;\n\n\t\t\t\t\tthis.buffer.set();\n\t\t\t\t\tthis.selection.save();\n\t\t\t\t\tthis.utils.saveScroll();\n\n\t\t\t\t\tthis.paste.createPasteBox();\n\n\t\t\t\t\t$(window).on('scroll.redactor-freeze', $.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\t$(window).scrollTop(this.saveBodyScroll);\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\tsetTimeout($.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tvar html = this.$pasteBox.html();\n\n\t\t\t\t\t\tthis.$pasteBox.remove();\n\n\t\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\t\tthis.utils.restoreScroll();\n\n\t\t\t\t\t\tthis.paste.insert(html);\n\n\t\t\t\t\t\t$(window).off('scroll.redactor-freeze');\n\n\t\t\t\t\t\tif (this.linkify.isEnabled())\n\t\t\t\t\t\t\tthis.linkify.format();\n\n\t\t\t\t\t}, this), 1);\n\t\t\t\t},\n\t\t\t\tcreatePasteBox: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$pasteBox = $('<div>').html('').attr('contenteditable', 'true').css({ position: 'fixed', width: 0, top: 0, left: '-9999px' });\n\n\t\t\t\t\tif (this.utils.browser('msie'))\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$box.append(this.$pasteBox);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t$('body').append(this.$pasteBox);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.$pasteBox.focus();\n\t\t\t\t},\n\t\t\t\tinsert: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = this.core.setCallback('pasteBefore', html);\n\n\t\t\t\t\t// clean\n\t\t\t\t\thtml = (this.utils.isSelectAll()) ? this.clean.onPaste(html, false) : this.clean.onPaste(html);\n\n\t\t\t\t\thtml = this.core.setCallback('paste', html);\n\n\t\t\t\t\tif (this.utils.isSelectAll())\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.insert.set(html, false);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.insert.html(html, false);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.utils.disableSelectAll();\n\t\t\t\t\tthis.rtePaste = false;\n\n\t\t\t\t\tsetTimeout($.proxy(this.clean.clearUnverified, this), 10);\n\n\t\t\t\t\t// clean empty spans\n\t\t\t\t\tsetTimeout($.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tvar spans = this.$editor.find('span');\n\t\t\t\t\t\t$.each(spans, function(i,s)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar html = s.innerHTML.replace(/[\\u200B-\\u200D\\uFEFF]/, '');\n\t\t\t\t\t\t\tif (html === '' && s.attributes.length === 0) $(s).remove();\n\n\t\t\t\t\t\t});\n\n\t\t\t\t\t}, this), 10);\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tplaceholder: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tenable: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.placeholder.is()) return;\n\n\t\t\t\t\tthis.$editor.attr('placeholder', this.$element.attr('placeholder'));\n\n\t\t\t\t\tthis.placeholder.toggle();\n\t\t\t\t\tthis.$editor.on('keyup.redactor-placeholder', $.proxy(this.placeholder.toggle, this));\n\n\t\t\t\t},\n\t\t\t\ttoggle: function()\n\t\t\t\t{\n\t\t\t\t\tvar func = 'removeClass';\n\t\t\t\t\tif (this.utils.isEmpty(this.$editor.html(), false)) func = 'addClass';\n\t\t\t\t\tthis.$editor[func]('redactor-placeholder');\n\t\t\t\t},\n\t\t\t\tremove: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$editor.removeClass('redactor-placeholder');\n\t\t\t\t},\n\t\t\t\tis: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.placeholder)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.$element.attr('placeholder', this.opts.placeholder);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treturn !(typeof this.$element.attr('placeholder') == 'undefined' || this.$element.attr('placeholder') === '');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tprogress: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tshow: function()\n\t\t\t\t{\n\t\t\t\t\t$(document.body).append($('<div id=\"redactor-progress\"><span></span></div>'));\n\t\t\t\t\t$('#redactor-progress').fadeIn();\n\t\t\t\t},\n\t\t\t\thide: function()\n\t\t\t\t{\n\t\t\t\t\t$('#redactor-progress').fadeOut(1500, function()\n\t\t\t\t\t{\n\t\t\t\t\t\t$(this).remove();\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t};\n\t\t},\n\t\tselection: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tget: function()\n\t\t\t\t{\n\t\t\t\t\tthis.sel = document.getSelection();\n\n\t\t\t\t\tif (document.getSelection && this.sel.getRangeAt && this.sel.rangeCount)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.range = this.sel.getRangeAt(0);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.range = document.createRange();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\taddRange: function()\n\t\t\t\t{\n\t\t\t\t\ttry {\n\t\t\t\t\t\tthis.sel.removeAllRanges();\n\t\t\t\t\t} catch (e) {}\n\n\t\t\t\t\tthis.sel.addRange(this.range);\n\t\t\t\t},\n\t\t\t\tgetCurrent: function()\n\t\t\t\t{\n\t\t\t\t\tvar el = false;\n\t\t\t\t\tthis.selection.get();\n\n\t\t\t\t\tif (this.sel && this.sel.rangeCount > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tel = this.sel.getRangeAt(0).startContainer;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.utils.isRedactorParent(el);\n\t\t\t\t},\n\t\t\t\tgetParent: function(elem)\n\t\t\t\t{\n\t\t\t\t\telem = elem || this.selection.getCurrent();\n\t\t\t\t\tif (elem)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.utils.isRedactorParent($(elem).parent()[0]);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tgetBlock: function(node)\n\t\t\t\t{\n\t\t\t\t\tnode = node || this.selection.getCurrent();\n\n\t\t\t\t\twhile (node)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.utils.isBlockTag(node.tagName))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn ($(node).hasClass('redactor-editor')) ? false : node;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tnode = node.parentNode;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tgetInlines: function(nodes, tags)\n\t\t\t\t{\n\t\t\t\t\tthis.selection.get();\n\n\t\t\t\t\tif (this.range && this.range.collapsed)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar inlines = [];\n\t\t\t\t\tnodes = (typeof nodes == 'undefined' || nodes === false) ? this.selection.getNodes() : nodes;\n\t\t\t\t\tvar inlineTags = this.opts.inlineTags;\n\t\t\t\t\tinlineTags.push('span');\n\n\t\t\t\t\tif (typeof tags !== 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tfor (var i = 0; i < tags.length; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tinlineTags.push(tags[i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t$.each(nodes, $.proxy(function(i,node)\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($.inArray(node.tagName.toLowerCase(), inlineTags) != -1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tinlines.push(node);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\treturn (inlines.length === 0) ? false : inlines;\n\t\t\t\t},\n\t\t\t\tgetInlinesTags: function(tags)\n\t\t\t\t{\n\t\t\t\t\tthis.selection.get();\n\n\t\t\t\t\tif (this.range && this.range.collapsed)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar inlines = [];\n\t\t\t\t\tvar nodes =  this.selection.getNodes();\n\t\t\t\t\t$.each(nodes, $.proxy(function(i,node)\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($.inArray(node.tagName.toLowerCase(), tags) != -1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tinlines.push(node);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\treturn (inlines.length === 0) ? false : inlines;\n\t\t\t\t},\n\t\t\t\tgetBlocks: function(nodes)\n\t\t\t\t{\n\t\t\t\t\tthis.selection.get();\n\n\t\t\t\t\tif (this.range && this.range.collapsed)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn [this.selection.getBlock()];\n\t\t\t\t\t}\n\n\t\t\t\t\tvar blocks = [];\n\t\t\t\t\tnodes = (typeof nodes == 'undefined') ? this.selection.getNodes() : nodes;\n\t\t\t\t\t$.each(nodes, $.proxy(function(i,node)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.utils.isBlock(node))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.selection.lastBlock = node;\n\t\t\t\t\t\t\tblocks.push(node);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\treturn (blocks.length === 0) ? [this.selection.getBlock()] : blocks;\n\t\t\t\t},\n\t\t\t\tgetLastBlock: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.selection.lastBlock;\n\t\t\t\t},\n\t\t\t\tgetNodes: function()\n\t\t\t\t{\n\t\t\t\t\tthis.selection.get();\n\n\t\t\t\t\tvar startNode = this.selection.getNodesMarker(1);\n\t\t\t\t\tvar endNode = this.selection.getNodesMarker(2);\n\t\t\t\t\tvar range = this.range.cloneRange();\n\n\t\t\t\t\tif (this.range.collapsed === false)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar startContainer = range.startContainer;\n\t\t\t\t\t\tvar startOffset = range.startOffset;\n\n\t\t\t\t\t\t// end marker\n\t\t\t\t\t\tthis.selection.setNodesMarker(range, endNode, false);\n\n\t\t\t\t\t\t// start marker\n\t\t\t\t\t\trange.setStart(startContainer, startOffset);\n\t\t\t\t\t\tthis.selection.setNodesMarker(range, startNode, true);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.selection.setNodesMarker(range, startNode, true);\n\t\t\t\t\t\tendNode = startNode;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar nodes = [];\n\t\t\t\t\tvar counter = 0;\n\n\t\t\t\t\tvar self = this;\n\t\t\t\t\tthis.$editor.find('*').each(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this == startNode)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar parent = $(this).parent();\n\t\t\t\t\t\t\tif (parent.length !== 0 && parent[0].tagName != 'BODY' && self.utils.isRedactorParent(parent[0]))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tnodes.push(parent[0]);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tnodes.push(this);\n\t\t\t\t\t\t\tcounter = 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (counter > 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tnodes.push(this);\n\t\t\t\t\t\t\t\tcounter = counter + 1;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (this == endNode)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t});\n\n\t\t\t\t\tvar finalNodes = [];\n\t\t\t\t\tvar len = nodes.length;\n\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (nodes[i].id != 'nodes-marker-1' && nodes[i].id != 'nodes-marker-2')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfinalNodes.push(nodes[i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.selection.removeNodesMarkers();\n\n\t\t\t\t\treturn finalNodes;\n\n\t\t\t\t},\n\t\t\t\tgetNodesMarker: function(num)\n\t\t\t\t{\n\t\t\t\t\treturn $('<span id=\"nodes-marker-' + num + '\" class=\"redactor-nodes-marker\" data-verified=\"redactor\">' + this.opts.invisibleSpace + '</span>')[0];\n\t\t\t\t},\n\t\t\t\tsetNodesMarker: function(range, node, type)\n\t\t\t\t{\n\t\t\t\t\ttry {\n\t\t\t\t\t\trange.collapse(type);\n\t\t\t\t\t\trange.insertNode(node);\n\t\t\t\t\t}\n\t\t\t\t\tcatch (e) {}\n\t\t\t\t},\n\t\t\t\tremoveNodesMarkers: function()\n\t\t\t\t{\n\t\t\t\t\t$(document).find('span.redactor-nodes-marker').remove();\n\t\t\t\t\tthis.$editor.find('span.redactor-nodes-marker').remove();\n\t\t\t\t},\n\t\t\t\tfromPoint: function(start, end)\n\t\t\t\t{\n\t\t\t\t\tthis.caret.setOffset(start, end);\n\t\t\t\t},\n\t\t\t\twrap: function(tag)\n\t\t\t\t{\n\t\t\t\t\tthis.selection.get();\n\n\t\t\t\t\tif (this.range.collapsed) return false;\n\n\t\t\t\t\tvar wrapper = document.createElement(tag);\n\t\t\t\t\twrapper.appendChild(this.range.extractContents());\n\t\t\t\t\tthis.range.insertNode(wrapper);\n\n\t\t\t\t\treturn wrapper;\n\t\t\t\t},\n\t\t\t\tselectElement: function(node)\n\t\t\t\t{\n\t\t\t\t\tthis.caret.set(node, 0, node, 1);\n\t\t\t\t},\n\t\t\t\tselectAll: function()\n\t\t\t\t{\n\t\t\t\t\tthis.selection.get();\n\t\t\t\t\tthis.range.selectNodeContents(this.$editor[0]);\n\t\t\t\t\tthis.selection.addRange();\n\t\t\t\t},\n\t\t\t\tremove: function()\n\t\t\t\t{\n\t\t\t\t\tthis.selection.get();\n\t\t\t\t\tthis.sel.removeAllRanges();\n\t\t\t\t},\n\t\t\t\tsave: function()\n\t\t\t\t{\n\t\t\t\t\tthis.selection.createMarkers();\n\t\t\t\t},\n\t\t\t\tcreateMarkers: function()\n\t\t\t\t{\n\t\t\t\t\tthis.selection.get();\n\n\t\t\t\t\tvar node1 = this.selection.getMarker(1);\n\n\t\t\t\t\tthis.selection.setMarker(this.range, node1, true);\n\n\t\t\t\t\tif (this.range.collapsed === false)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar node2 = this.selection.getMarker(2);\n\t\t\t\t\t\tthis.selection.setMarker(this.range, node2, false);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.savedSel = this.$editor.html();\n\t\t\t\t},\n\t\t\t\tgetMarker: function(num)\n\t\t\t\t{\n\t\t\t\t\tif (typeof num == 'undefined') num = 1;\n\n\t\t\t\t\treturn $('<span id=\"selection-marker-' + num + '\" class=\"redactor-selection-marker\"  data-verified=\"redactor\">' + this.opts.invisibleSpace + '</span>')[0];\n\t\t\t\t},\n\t\t\t\tgetMarkerAsHtml: function(num)\n\t\t\t\t{\n\t\t\t\t\treturn this.utils.getOuterHtml(this.selection.getMarker(num));\n\t\t\t\t},\n\t\t\t\tsetMarker: function(range, node, type)\n\t\t\t\t{\n\t\t\t\t\trange = range.cloneRange();\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\trange.collapse(type);\n\t\t\t\t\t\trange.insertNode(node);\n\t\t\t\t\t}\n\t\t\t\t\tcatch (e)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.focus.setStart();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\trestore: function()\n\t\t\t\t{\n\t\t\t\t\tvar node1 = this.$editor.find('span#selection-marker-1');\n\t\t\t\t\tvar node2 = this.$editor.find('span#selection-marker-2');\n\n\t\t\t\t\tif (node1.length !== 0 && node2.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.caret.set(node1, 0, node2, 0);\n\t\t\t\t\t}\n\t\t\t\t\telse if (node1.length !== 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.caret.set(node1, 0, node1, 0);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$editor.focus();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.selection.removeMarkers();\n\t\t\t\t\tthis.savedSel = false;\n\n\t\t\t\t},\n\t\t\t\tremoveMarkers: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$editor.find('span.redactor-selection-marker').each(function(i,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar text = $(s).text().replace(/[\\u200B-\\u200D\\uFEFF]/g, '');\n\t\t\t\t\t\tif (text === '') $(s).remove();\n\t\t\t\t\t\telse $(s).replaceWith(function() { return $(this).contents(); });\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tgetText: function()\n\t\t\t\t{\n\t\t\t\t\tthis.selection.get();\n\n\t\t\t\t\treturn this.sel.toString();\n\t\t\t\t},\n\t\t\t\tgetHtml: function()\n\t\t\t\t{\n\t\t\t\t\tvar html = '';\n\n\t\t\t\t\tthis.selection.get();\n\t\t\t\t\tif (this.sel.rangeCount)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar container = document.createElement('div');\n\t\t\t\t\t\tvar len = this.sel.rangeCount;\n\t\t\t\t\t\tfor (var i = 0; i < len; ++i)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcontainer.appendChild(this.sel.getRangeAt(i).cloneContents());\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\thtml = container.innerHTML;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.clean.onSync(html);\n\t\t\t\t},\n\t\t\t\treplaceWithHtml: function(html)\n\t\t\t\t{\n\t\t\t\t\thtml = this.selection.getMarkerAsHtml(1) + html + this.selection.getMarkerAsHtml(2);\n\n\t\t\t\t\tthis.selection.get();\n\n\t\t\t\t\tif (window.getSelection && window.getSelection().getRangeAt)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.range.deleteContents();\n\t\t\t\t\t\tvar div = document.createElement(\"div\");\n\t\t\t\t\t\tdiv.innerHTML = html;\n\n\t\t\t\t\t\tvar frag = document.createDocumentFragment(), child;\n\t\t\t\t\t\twhile ((child = div.firstChild))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfrag.appendChild(child);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis.range.insertNode(frag);\n\t\t\t\t\t}\n\t\t\t\t\telse if (document.selection && document.selection.createRange)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.range.pasteHTML(html);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.selection.restore();\n\t\t\t\t\tthis.code.sync();\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tshortcuts: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tinit: function(e, key)\n\t\t\t\t{\n\t\t\t\t\t// disable browser's hot keys for bold and italic\n\t\t\t\t\tif (!this.opts.shortcuts)\n\t\t\t\t\t{\n\t\t\t\t\t\tif ((e.ctrlKey || e.metaKey) && (key === 66 || key === 73)) e.preventDefault();\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t$.each(this.opts.shortcuts, $.proxy(function(str, command)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar keys = str.split(',');\n\t\t\t\t\t\tvar len = keys.length;\n\t\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (typeof keys[i] === 'string')\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.shortcuts.handler(e, $.trim(keys[i]), $.proxy(function()\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tvar func;\n\t\t\t\t\t\t\t\t\tif (command.func.search(/\\./) != '-1')\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tfunc = command.func.split('.');\n\t\t\t\t\t\t\t\t\t\tif (typeof this[func[0]] != 'undefined')\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tthis[func[0]][func[1]].apply(this, command.params);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tthis[command.func].apply(this, command.params);\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t}, this));\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\thandler: function(e, keys, origHandler)\n\t\t\t\t{\n\t\t\t\t\t// based on https://github.com/jeresig/jquery.hotkeys\n\t\t\t\t\tvar hotkeysSpecialKeys =\n\t\t\t\t\t{\n\t\t\t\t\t\t8: \"backspace\", 9: \"tab\", 10: \"return\", 13: \"return\", 16: \"shift\", 17: \"ctrl\", 18: \"alt\", 19: \"pause\",\n\t\t\t\t\t\t20: \"capslock\", 27: \"esc\", 32: \"space\", 33: \"pageup\", 34: \"pagedown\", 35: \"end\", 36: \"home\",\n\t\t\t\t\t\t37: \"left\", 38: \"up\", 39: \"right\", 40: \"down\", 45: \"insert\", 46: \"del\", 59: \";\", 61: \"=\",\n\t\t\t\t\t\t96: \"0\", 97: \"1\", 98: \"2\", 99: \"3\", 100: \"4\", 101: \"5\", 102: \"6\", 103: \"7\",\n\t\t\t\t\t\t104: \"8\", 105: \"9\", 106: \"*\", 107: \"+\", 109: \"-\", 110: \".\", 111 : \"/\",\n\t\t\t\t\t\t112: \"f1\", 113: \"f2\", 114: \"f3\", 115: \"f4\", 116: \"f5\", 117: \"f6\", 118: \"f7\", 119: \"f8\",\n\t\t\t\t\t\t120: \"f9\", 121: \"f10\", 122: \"f11\", 123: \"f12\", 144: \"numlock\", 145: \"scroll\", 173: \"-\", 186: \";\", 187: \"=\",\n\t\t\t\t\t\t188: \",\", 189: \"-\", 190: \".\", 191: \"/\", 192: \"`\", 219: \"[\", 220: \"\\\\\", 221: \"]\", 222: \"'\"\n\t\t\t\t\t};\n\n\n\t\t\t\t\tvar hotkeysShiftNums =\n\t\t\t\t\t{\n\t\t\t\t\t\t\"`\": \"~\", \"1\": \"!\", \"2\": \"@\", \"3\": \"#\", \"4\": \"$\", \"5\": \"%\", \"6\": \"^\", \"7\": \"&\",\n\t\t\t\t\t\t\"8\": \"*\", \"9\": \"(\", \"0\": \")\", \"-\": \"_\", \"=\": \"+\", \";\": \": \", \"'\": \"\\\"\", \",\": \"<\",\n\t\t\t\t\t\t\".\": \">\",  \"/\": \"?\",  \"\\\\\": \"|\"\n\t\t\t\t\t};\n\n\t\t\t\t\tkeys = keys.toLowerCase().split(\" \");\n\t\t\t\t\tvar special = hotkeysSpecialKeys[e.keyCode],\n\t\t\t\t\t\tcharacter = String.fromCharCode( e.which ).toLowerCase(),\n\t\t\t\t\t\tmodif = \"\", possible = {};\n\n\t\t\t\t\t$.each([ \"alt\", \"ctrl\", \"meta\", \"shift\"], function(index, specialKey)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (e[specialKey + 'Key'] && special !== specialKey)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tmodif += specialKey + '+';\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\n\t\t\t\t\tif (special) possible[modif + special] = true;\n\t\t\t\t\tif (character)\n\t\t\t\t\t{\n\t\t\t\t\t\tpossible[modif + character] = true;\n\t\t\t\t\t\tpossible[modif + hotkeysShiftNums[character]] = true;\n\n\t\t\t\t\t\t// \"$\" can be triggered as \"Shift+4\" or \"Shift+$\" or just \"$\"\n\t\t\t\t\t\tif (modif === \"shift+\")\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpossible[hotkeysShiftNums[character]] = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (var i = 0, len = keys.length; i < len; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (possible[keys[i]])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\treturn origHandler.apply(this, arguments);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\ttabifier: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tget: function(code)\n\t\t\t\t{\n\t\t\t\t\tif (!this.opts.tabifier) return code;\n\n\t\t\t\t\t// clean setup\n\t\t\t\t\tvar ownLine = ['area', 'body', 'head', 'hr', 'i?frame', 'link', 'meta', 'noscript', 'style', 'script', 'table', 'tbody', 'thead', 'tfoot'];\n\t\t\t\t\tvar contOwnLine = ['li', 'dt', 'dt', 'h[1-6]', 'option', 'script'];\n\t\t\t\t\tvar newLevel = ['p', 'blockquote', 'div', 'dl', 'fieldset', 'form', 'frameset', 'map', 'ol', 'pre', 'select', 'td', 'th', 'tr', 'ul'];\n\n\t\t\t\t\tthis.tabifier.lineBefore = new RegExp('^<(/?' + ownLine.join('|/?' ) + '|' + contOwnLine.join('|') + ')[ >]');\n\t\t\t\t\tthis.tabifier.lineAfter = new RegExp('^<(br|/?' + ownLine.join('|/?' ) + '|/' + contOwnLine.join('|/') + ')[ >]');\n\t\t\t\t\tthis.tabifier.newLevel = new RegExp('^</?(' + newLevel.join('|' ) + ')[ >]');\n\n\t\t\t\t\tvar i = 0,\n\t\t\t\t\tcodeLength = code.length,\n\t\t\t\t\tpoint = 0,\n\t\t\t\t\tstart = null,\n\t\t\t\t\tend = null,\n\t\t\t\t\ttag = '',\n\t\t\t\t\tout = '',\n\t\t\t\t\tcont = '';\n\n\t\t\t\t\tthis.tabifier.cleanlevel = 0;\n\n\t\t\t\t\tfor (; i < codeLength; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tpoint = i;\n\n\t\t\t\t\t\t// if no more tags, copy and exit\n\t\t\t\t\t\tif (-1 == code.substr(i).indexOf( '<' ))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tout += code.substr(i);\n\n\t\t\t\t\t\t\treturn this.tabifier.finish(out);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// copy verbatim until a tag\n\t\t\t\t\t\twhile (point < codeLength && code.charAt(point) != '<')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpoint++;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (i != point)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcont = code.substr(i, point - i);\n\t\t\t\t\t\t\tif (!cont.match(/^\\s{2,}$/g))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif ('\\n' == out.charAt(out.length - 1)) out += this.tabifier.getTabs();\n\t\t\t\t\t\t\t\telse if ('\\n' == cont.charAt(0))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tout += '\\n' + this.tabifier.getTabs();\n\t\t\t\t\t\t\t\t\tcont = cont.replace(/^\\s+/, '');\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tout += cont;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (cont.match(/\\n/)) out += '\\n' + this.tabifier.getTabs();\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tstart = point;\n\n\t\t\t\t\t\t// find the end of the tag\n\t\t\t\t\t\twhile (point < codeLength && '>' != code.charAt(point))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tpoint++;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttag = code.substr(start, point - start);\n\t\t\t\t\t\ti = point;\n\n\t\t\t\t\t\tvar t;\n\n\t\t\t\t\t\tif ('!--' == tag.substr(1, 3))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (!tag.match(/--$/))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\twhile ('-->' != code.substr(point, 3))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tpoint++;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tpoint += 2;\n\t\t\t\t\t\t\t\ttag = code.substr(start, point - start);\n\t\t\t\t\t\t\t\ti = point;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif ('\\n' != out.charAt(out.length - 1)) out += '\\n';\n\n\t\t\t\t\t\t\tout += this.tabifier.getTabs();\n\t\t\t\t\t\t\tout += tag + '>\\n';\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if ('!' == tag[1])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tout = this.tabifier.placeTag(tag + '>', out);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if ('?' == tag[1])\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tout += tag + '>\\n';\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (t = tag.match(/^<(script|style|pre)/i))\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tt[1] = t[1].toLowerCase();\n\t\t\t\t\t\t\ttag = this.tabifier.cleanTag(tag);\n\t\t\t\t\t\t\tout = this.tabifier.placeTag(tag, out);\n\t\t\t\t\t\t\tend = String(code.substr(i + 1)).toLowerCase().indexOf('</' + t[1]);\n\n\t\t\t\t\t\t\tif (end)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tcont = code.substr(i + 1, end);\n\t\t\t\t\t\t\t\ti += end;\n\t\t\t\t\t\t\t\tout += cont;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttag = this.tabifier.cleanTag(tag);\n\t\t\t\t\t\t\tout = this.tabifier.placeTag(tag, out);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn this.tabifier.finish(out);\n\t\t\t\t},\n\t\t\t\tgetTabs: function()\n\t\t\t\t{\n\t\t\t\t\tvar s = '';\n\t\t\t\t\tfor ( var j = 0; j < this.tabifier.cleanlevel; j++ )\n\t\t\t\t\t{\n\t\t\t\t\t\ts += '\\t';\n\t\t\t\t\t}\n\n\t\t\t\t\treturn s;\n\t\t\t\t},\n\t\t\t\tfinish: function(code)\n\t\t\t\t{\n\t\t\t\t\tcode = code.replace(/\\n\\s*\\n/g, '\\n');\n\t\t\t\t\tcode = code.replace(/^[\\s\\n]*/, '');\n\t\t\t\t\tcode = code.replace(/[\\s\\n]*$/, '');\n\t\t\t\t\tcode = code.replace(/<script(.*?)>\\n<\\/script>/gi, '<script$1></script>');\n\n\t\t\t\t\tthis.tabifier.cleanlevel = 0;\n\n\t\t\t\t\treturn code;\n\t\t\t\t},\n\t\t\t\tcleanTag: function (tag)\n\t\t\t\t{\n\t\t\t\t\tvar tagout = '';\n\t\t\t\t\ttag = tag.replace(/\\n/g, ' ');\n\t\t\t\t\ttag = tag.replace(/\\s{2,}/g, ' ');\n\t\t\t\t\ttag = tag.replace(/^\\s+|\\s+$/g, ' ');\n\n\t\t\t\t\tvar suffix = '';\n\t\t\t\t\tif (tag.match(/\\/$/))\n\t\t\t\t\t{\n\t\t\t\t\t\tsuffix = '/';\n\t\t\t\t\t\ttag = tag.replace(/\\/+$/, '');\n\t\t\t\t\t}\n\n\t\t\t\t\tvar m;\n\t\t\t\t\twhile (m = /\\s*([^= ]+)(?:=((['\"']).*?\\3|[^ ]+))?/.exec(tag))\n\t\t\t\t\t{\n\t\t\t\t\t\tif (m[2]) tagout += m[1].toLowerCase() + '=' + m[2];\n\t\t\t\t\t\telse if (m[1]) tagout += m[1].toLowerCase();\n\n\t\t\t\t\t\ttagout += ' ';\n\t\t\t\t\t\ttag = tag.substr(m[0].length);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn tagout.replace(/\\s*$/, '') + suffix + '>';\n\t\t\t\t},\n\t\t\t\tplaceTag: function (tag, out)\n\t\t\t\t{\n\t\t\t\t\tvar nl = tag.match(this.tabifier.newLevel);\n\n\t\t\t\t\tif (tag.match(this.tabifier.lineBefore) || nl)\n\t\t\t\t\t{\n\t\t\t\t\t\tout = out.replace(/\\s*$/, '');\n\t\t\t\t\t\tout += '\\n';\n\t\t\t\t\t}\n\n\t\t\t\t\tif (nl && '/' == tag.charAt(1)) this.tabifier.cleanlevel--;\n\t\t\t\t\tif ('\\n' == out.charAt(out.length - 1)) out += this.tabifier.getTabs();\n\t\t\t\t\tif (nl && '/' != tag.charAt(1)) this.tabifier.cleanlevel++;\n\n\t\t\t\t\tout += tag;\n\n\t\t\t\t\tif (tag.match(this.tabifier.lineAfter) || tag.match(this.tabifier.newLevel))\n\t\t\t\t\t{\n\t\t\t\t\t\tout = out.replace(/ *$/, '');\n\t\t\t\t\t\t//out += '\\n';\n\t\t\t\t\t}\n\n\t\t\t\t\treturn out;\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\ttidy: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tsetupAllowed: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.allowedTags) this.opts.deniedTags = false;\n\t\t\t\t\tif (this.opts.allowedAttr) this.opts.removeAttr = false;\n\n\t\t\t\t\tif (this.opts.linebreaks) return;\n\n\t\t\t\t\tvar tags = ['p', 'section'];\n\t\t\t\t\tif (this.opts.allowedTags) this.tidy.addToAllowed(tags);\n\t\t\t\t\tif (this.opts.deniedTags) this.tidy.removeFromDenied(tags);\n\n\t\t\t\t},\n\t\t\t\taddToAllowed: function(tags)\n\t\t\t\t{\n\t\t\t\t\tvar len = tags.length;\n\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($.inArray(tags[i], this.opts.allowedTags) == -1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.opts.allowedTags.push(tags[i]);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tremoveFromDenied: function(tags)\n\t\t\t\t{\n\t\t\t\t\tvar len = tags.length;\n\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar pos = $.inArray(tags[i], this.opts.deniedTags);\n\t\t\t\t\t\tif (pos != -1)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthis.opts.deniedTags.splice(pos, 1);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tload: function(html, options)\n\t\t\t\t{\n\t\t\t\t\tthis.tidy.settings = {\n\t\t\t\t\t\tdeniedTags: this.opts.deniedTags,\n\t\t\t\t\t\tallowedTags: this.opts.allowedTags,\n\t\t\t\t\t\tremoveComments: this.opts.removeComments,\n\t\t\t\t\t\treplaceTags: this.opts.replaceTags,\n\t\t\t\t\t\treplaceStyles: this.opts.replaceStyles,\n\t\t\t\t\t\tremoveDataAttr: this.opts.removeDataAttr,\n\t\t\t\t\t\tremoveAttr: this.opts.removeAttr,\n\t\t\t\t\t\tallowedAttr: this.opts.allowedAttr,\n\t\t\t\t\t\tremoveWithoutAttr: this.opts.removeWithoutAttr,\n\t\t\t\t\t\tremoveEmpty: this.opts.removeEmpty\n\t\t\t\t\t};\n\n\t\t\t\t\t$.extend(this.tidy.settings, options);\n\n\t\t\t\t\thtml = this.tidy.removeComments(html);\n\n\t\t\t\t\t// create container\n\t\t\t\t\tthis.tidy.$div = $('<div />').append(html);\n\n\t\t\t\t\t// clean\n\t\t\t\t\tthis.tidy.replaceTags();\n\t\t\t\t\tthis.tidy.replaceStyles();\n\t\t\t\t\tthis.tidy.removeTags();\n\n\t\t\t\t\tthis.tidy.removeAttr();\n\t\t\t\t\tthis.tidy.removeEmpty();\n\t\t\t\t\tthis.tidy.removeParagraphsInLists();\n\t\t\t\t\tthis.tidy.removeDataAttr();\n\t\t\t\t\tthis.tidy.removeWithoutAttr();\n\n\t\t\t\t\thtml = this.tidy.$div.html();\n\t\t\t\t\tthis.tidy.$div.remove();\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tremoveComments: function(html)\n\t\t\t\t{\n\t\t\t\t\tif (!this.tidy.settings.removeComments) return html;\n\n\t\t\t\t\treturn html.replace(/<!--[\\s\\S]*?-->/gi, '');\n\t\t\t\t},\n\t\t\t\treplaceTags: function(html)\n\t\t\t\t{\n\t\t\t\t\tif (!this.tidy.settings.replaceTags) return html;\n\n\t\t\t\t\tvar len = this.tidy.settings.replaceTags.length;\n\t\t\t\t\tvar replacement = [], rTags = [];\n\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\trTags.push(this.tidy.settings.replaceTags[i][1]);\n\t\t\t\t\t\treplacement.push(this.tidy.settings.replaceTags[i][0]);\n\t\t\t\t\t}\n\n\t\t\t\t\t$.each(replacement, $.proxy(function(key, value)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.tidy.$div.find(value).replaceWith(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn $(\"<\" + rTags[key] + \" />\", {html: $(this).html()});\n\t\t\t\t\t\t});\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\treplaceStyles: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.tidy.settings.replaceStyles) return;\n\n\t\t\t\t\tvar len = this.tidy.settings.replaceStyles.length;\n\t\t\t\t\tthis.tidy.$div.find('span').each($.proxy(function(n,s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $el = $(s);\n\t\t\t\t\t\tvar style = $el.attr('style');\n\t\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (style && style.match(new RegExp('^' + this.tidy.settings.replaceStyles[i][0], 'i')))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar tagName = this.tidy.settings.replaceStyles[i][1];\n\t\t\t\t\t\t\t\t$el.replaceWith(function()\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tvar tag = document.createElement(tagName);\n\t\t\t\t\t\t\t\t\treturn $(tag).append($(this).contents());\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t},\n\t\t\t\tremoveTags: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.tidy.settings.deniedTags && this.tidy.settings.allowedTags)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.tidy.$div.find('*').not(this.tidy.settings.allowedTags.join(',')).each(function(i, s)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (s.innerHTML === '') $(s).remove();\n\t\t\t\t\t\t\telse $(s).contents().unwrap();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.tidy.settings.deniedTags)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.tidy.$div.find(this.tidy.settings.deniedTags.join(',')).each(function(i, s)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (s.innerHTML === '') $(s).remove();\n\t\t\t\t\t\t\telse $(s).contents().unwrap();\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tremoveAttr: function()\n\t\t\t\t{\n\t\t\t\t\tvar len;\n\t\t\t\t\tif (!this.tidy.settings.removeAttr && this.tidy.settings.allowedAttr)\n\t\t\t\t\t{\n\n\t\t\t\t\t\tvar allowedAttrTags = [], allowedAttrData = [];\n\t\t\t\t\t\tlen = this.tidy.settings.allowedAttr.length;\n\t\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tallowedAttrTags.push(this.tidy.settings.allowedAttr[i][0]);\n\t\t\t\t\t\t\tallowedAttrData.push(this.tidy.settings.allowedAttr[i][1]);\n\t\t\t\t\t\t}\n\n\n\t\t\t\t\t\tthis.tidy.$div.find('*').each($.proxy(function(n,s)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar $el = $(s);\n\t\t\t\t\t\t\tvar pos = $.inArray($el[0].tagName.toLowerCase(), allowedAttrTags);\n\t\t\t\t\t\t\tvar attributesRemove = this.tidy.removeAttrGetRemoves(pos, allowedAttrData, $el);\n\n\t\t\t\t\t\t\tif (attributesRemove)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$.each(attributesRemove, function(z,f) {\n\t\t\t\t\t\t\t\t\t$el.removeAttr(f);\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, this));\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.tidy.settings.removeAttr)\n\t\t\t\t\t{\n\t\t\t\t\t\tlen = this.tidy.settings.removeAttr.length;\n\t\t\t\t\t\tfor (var i = 0; i < len; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar attrs = this.tidy.settings.removeAttr[i][1];\n\t\t\t\t\t\t\tif ($.isArray(attrs)) attrs = attrs.join(' ');\n\n\t\t\t\t\t\t\tthis.tidy.$div.find(this.tidy.settings.removeAttr[i][0]).removeAttr(attrs);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tremoveAttrGetRemoves: function(pos, allowed, $el)\n\t\t\t\t{\n\t\t\t\t\tvar attributesRemove = [];\n\n\t\t\t\t\t// remove all attrs\n\t\t\t\t\tif (pos == -1)\n\t\t\t\t\t{\n\t\t\t\t\t\t$.each($el[0].attributes, function(i, item)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tattributesRemove.push(item.name);\n\t\t\t\t\t\t});\n\n\t\t\t\t\t}\n\t\t\t\t\t// allow all attrs\n\t\t\t\t\telse if (allowed[pos] == '*')\n\t\t\t\t\t{\n\t\t\t\t\t\tattributesRemove = [];\n\t\t\t\t\t}\n\t\t\t\t\t// allow specific attrs\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t$.each($el[0].attributes, function(i, item)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif ($.isArray(allowed[pos]))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif ($.inArray(item.name, allowed[pos]) == -1)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tattributesRemove.push(item.name);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (allowed[pos] != item.name)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tattributesRemove.push(item.name);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\treturn attributesRemove;\n\t\t\t\t},\n\t\t\t\tremoveAttrs: function (el, regex)\n\t\t\t\t{\n\t\t\t\t\tregex = new RegExp(regex, \"g\");\n\t\t\t\t\treturn el.each(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tvar self = $(this);\n\t\t\t\t\t\tvar len = this.attributes.length - 1;\n\t\t\t\t\t\tfor (var i = len; i >= 0; i--)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar item = this.attributes[i];\n\t\t\t\t\t\t\tif (item && item.specified && item.name.search(regex)>=0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tself.removeAttr(item.name);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tremoveEmpty: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.tidy.settings.removeEmpty) return;\n\n\t\t\t\t\tthis.tidy.$div.find(this.tidy.settings.removeEmpty.join(',')).each(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tvar $el = $(this);\n\t\t\t\t\t\tvar text = $el.text();\n\t\t\t\t\t\ttext = text.replace(/[\\u200B-\\u200D\\uFEFF]/g, '');\n\t\t\t\t\t\ttext = text.replace(/&nbsp;/gi, '');\n\t\t\t\t\t\ttext = text.replace(/\\s/g, '');\n\n\t\t    \t    \tif (text === '' && $el.children().length === 0)\n\t\t    \t    \t{\n\t\t\t    \t    \t$el.remove();\n\t\t    \t    \t}\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tremoveParagraphsInLists: function()\n\t\t\t\t{\n\t\t\t\t\tthis.tidy.$div.find('li p').contents().unwrap();\n\t\t\t\t},\n\t\t\t\tremoveDataAttr: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.tidy.settings.removeDataAttr) return;\n\n\t\t\t\t\tvar tags = this.tidy.settings.removeDataAttr;\n\t\t\t\t\tif ($.isArray(this.tidy.settings.removeDataAttr)) tags = this.tidy.settings.removeDataAttr.join(',');\n\n\t\t\t\t\tthis.tidy.removeAttrs(this.tidy.$div.find(tags), '^(data-)');\n\n\t\t\t\t},\n\t\t\t\tremoveWithoutAttr: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.tidy.settings.removeWithoutAttr) return;\n\n\t\t\t\t\tthis.tidy.$div.find(this.tidy.settings.removeWithoutAttr.join(',')).each(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.attributes.length === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$(this).contents().unwrap();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\ttoolbar: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tinit: function()\n\t\t\t\t{\n\t\t\t\t\treturn {\n\t\t\t\t\t\thtml:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('html'),\n\t\t\t\t\t\t\tfunc: 'code.toggle'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tformatting:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('formatting'),\n\t\t\t\t\t\t\tdropdown:\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tp:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('paragraph'),\n\t\t\t\t\t\t\t\t\tfunc: 'block.format'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tblockquote:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('quote'),\n\t\t\t\t\t\t\t\t\tfunc: 'block.format'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tpre:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('code'),\n\t\t\t\t\t\t\t\t\tfunc: 'block.format'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\th1:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('header1'),\n\t\t\t\t\t\t\t\t\tfunc: 'block.format'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\th2:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('header2'),\n\t\t\t\t\t\t\t\t\tfunc: 'block.format'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\th3:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('header3'),\n\t\t\t\t\t\t\t\t\tfunc: 'block.format'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\th4:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('header4'),\n\t\t\t\t\t\t\t\t\tfunc: 'block.format'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\th5:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('header5'),\n\t\t\t\t\t\t\t\t\tfunc: 'block.format'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\tbold:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('bold'),\n\t\t\t\t\t\t\tfunc: 'inline.format'\n\t\t\t\t\t\t},\n\t\t\t\t\t\titalic:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('italic'),\n\t\t\t\t\t\t\tfunc: 'inline.format'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdeleted:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('deleted'),\n\t\t\t\t\t\t\tfunc: 'inline.format'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tunderline:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('underline'),\n\t\t\t\t\t\t\tfunc: 'inline.format'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tunorderedlist:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: '&bull; ' + this.lang.get('unorderedlist'),\n\t\t\t\t\t\t\tfunc: 'list.toggle'\n\t\t\t\t\t\t},\n\t\t\t\t\t\torderedlist:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: '1. ' + this.lang.get('orderedlist'),\n\t\t\t\t\t\t\tfunc: 'list.toggle'\n\t\t\t\t\t\t},\n\t\t\t\t\t\toutdent:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: '< ' + this.lang.get('outdent'),\n\t\t\t\t\t\t\tfunc: 'indent.decrease'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tindent:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: '> ' + this.lang.get('indent'),\n\t\t\t\t\t\t\tfunc: 'indent.increase'\n\t\t\t\t\t\t},\n\t\t\t\t\t\timage:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('image'),\n\t\t\t\t\t\t\tfunc: 'image.show'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfile:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('file'),\n\t\t\t\t\t\t\tfunc: 'file.show'\n\t\t\t\t\t\t},\n\t\t\t\t\t\tlink:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('link'),\n\t\t\t\t\t\t\tdropdown:\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlink:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('link_insert'),\n\t\t\t\t\t\t\t\t\tfunc: 'link.show'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tunlink:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('unlink'),\n\t\t\t\t\t\t\t\t\tfunc: 'link.unlink'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\talignment:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('alignment'),\n\t\t\t\t\t\t\tdropdown:\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tleft:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('align_left'),\n\t\t\t\t\t\t\t\t\tfunc: 'alignment.left'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcenter:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('align_center'),\n\t\t\t\t\t\t\t\t\tfunc: 'alignment.center'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tright:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('align_right'),\n\t\t\t\t\t\t\t\t\tfunc: 'alignment.right'\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tjustify:\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\ttitle: this.lang.get('align_justify'),\n\t\t\t\t\t\t\t\t\tfunc: 'alignment.justify'\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\thorizontalrule:\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttitle: this.lang.get('horizontalrule'),\n\t\t\t\t\t\t\tfunc: 'line.insert'\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t},\n\t\t\t\tbuild: function()\n\t\t\t\t{\n\t\t\t\t\tthis.toolbar.hideButtons();\n\t\t\t\t\tthis.toolbar.hideButtonsOnMobile();\n\t\t\t\t\tthis.toolbar.isButtonSourceNeeded();\n\n\t\t\t\t\tif (this.opts.buttons.length === 0) return;\n\n\t\t\t\t\tthis.$toolbar = this.toolbar.createContainer();\n\n\t\t\t\t\tthis.toolbar.setOverflow();\n\t\t\t\t\tthis.toolbar.append();\n\t\t\t\t\tthis.toolbar.setFormattingTags();\n\t\t\t\t\tthis.toolbar.loadButtons();\n\t\t\t\t\tthis.toolbar.setFixed();\n\n\t\t\t\t\t// buttons response\n\t\t\t\t\tif (this.opts.activeButtons)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$editor.on('mouseup.redactor keyup.redactor focus.redactor', $.proxy(this.observe.buttons, this));\n\t\t\t\t\t}\n\n\t\t\t\t},\n\t\t\t\tcreateContainer: function()\n\t\t\t\t{\n\t\t\t\t\treturn $('<ul>').addClass('redactor-toolbar').attr('id', 'redactor-toolbar-' + this.uuid);\n\t\t\t\t},\n\t\t\t\tsetFormattingTags: function()\n\t\t\t\t{\n\t\t\t\t\t$.each(this.opts.toolbar.formatting.dropdown, $.proxy(function (i, s)\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($.inArray(i, this.opts.formatting) == -1) delete this.opts.toolbar.formatting.dropdown[i];\n\t\t\t\t\t}, this));\n\n\t\t\t\t},\n\t\t\t\tloadButtons: function()\n\t\t\t\t{\n\t\t\t\t\t$.each(this.opts.buttons, $.proxy(function(i, btnName)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (!this.opts.toolbar[btnName]) return;\n\n\t\t\t\t\t\tif (btnName === 'file')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t if (this.opts.fileUpload === false) return;\n\t\t\t\t\t\t\t else if (!this.opts.fileUpload && this.opts.s3 === false) return;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (btnName === 'image')\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t if (this.opts.imageUpload === false) return;\n\t\t\t\t\t\t\t else if (!this.opts.imageUpload && this.opts.s3 === false) return;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tvar btnObject = this.opts.toolbar[btnName];\n\t\t\t\t\t\tthis.$toolbar.append($('<li>').append(this.button.build(btnName, btnObject)));\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tappend: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.toolbarExternal)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$toolbar.addClass('redactor-toolbar-external');\n\t\t\t\t\t\t$(this.opts.toolbarExternal).html(this.$toolbar);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$box.prepend(this.$toolbar);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tsetFixed: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.utils.isDesktop()) return;\n\t\t\t\t\tif (this.opts.toolbarExternal) return;\n\t\t\t\t\tif (!this.opts.toolbarFixed) return;\n\n\t\t\t\t\tthis.toolbar.observeScroll();\n\t\t\t\t\t$(this.opts.toolbarFixedTarget).on('scroll.redactor.' + this.uuid, $.proxy(this.toolbar.observeScroll, this));\n\n\t\t\t\t},\n\t\t\t\tsetOverflow: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.utils.isMobile() && this.opts.toolbarOverflow)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.$toolbar.addClass('redactor-toolbar-overflow');\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tisButtonSourceNeeded: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.source) return;\n\n\t\t\t\t\tvar index = this.opts.buttons.indexOf('html');\n\t\t\t\t\tif (index !== -1)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.opts.buttons.splice(index, 1);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\thideButtons: function()\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.buttonsHide.length === 0) return;\n\n\t\t\t\t\t$.each(this.opts.buttonsHide, $.proxy(function(i, s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar index = this.opts.buttons.indexOf(s);\n\t\t\t\t\t\tthis.opts.buttons.splice(index, 1);\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\thideButtonsOnMobile: function()\n\t\t\t\t{\n\t\t\t\t\tif (!this.utils.isMobile() || this.opts.buttonsHideOnMobile.length === 0) return;\n\n\t\t\t\t\t$.each(this.opts.buttonsHideOnMobile, $.proxy(function(i, s)\n\t\t\t\t\t{\n\t\t\t\t\t\tvar index = this.opts.buttons.indexOf(s);\n\t\t\t\t\t\tthis.opts.buttons.splice(index, 1);\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tobserveScroll: function()\n\t\t\t\t{\n\t\t\t\t\tvar scrollTop = $(this.opts.toolbarFixedTarget).scrollTop();\n\t\t\t\t\tvar boxTop = 1;\n\n\t\t\t\t\tif (this.opts.toolbarFixedTarget === document)\n\t\t\t\t\t{\n\t\t\t\t\t\tboxTop = this.$box.offset().top;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (scrollTop > boxTop)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.toolbar.observeScrollEnable(scrollTop, boxTop);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.toolbar.observeScrollDisable();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tobserveScrollEnable: function(scrollTop, boxTop)\n\t\t\t\t{\n\t\t\t\t\tvar top = this.opts.toolbarFixedTopOffset + scrollTop - boxTop;\n\t\t\t\t\tvar left = 0;\n\t\t\t\t\tvar end = boxTop + this.$box.height() - 32;\n\t\t\t\t\tvar width = this.$box.innerWidth();\n\n\t\t\t\t\tthis.$toolbar.addClass('toolbar-fixed-box');\n\t\t\t\t\tthis.$toolbar.css({\n\t\t\t\t\t\tposition: 'absolute',\n\t\t\t\t\t\twidth: width,\n\t\t\t\t\t\ttop: top + 'px',\n\t\t\t\t\t\tleft: left\n\t\t\t\t\t});\n\n\t\t\t\t\tif (scrollTop > end)\n\t\t\t\t\t\t$('.redactor-dropdown-' + this.uuid + ':visible').hide();\n\n\t\t\t\t\tthis.toolbar.setDropdownsFixed();\n\t\t\t\t\tthis.$toolbar.css('visibility', (scrollTop < end) ? 'visible' : 'hidden');\n\t\t\t\t},\n\t\t\t\tobserveScrollDisable: function()\n\t\t\t\t{\n\t\t\t\t\tthis.$toolbar.css({\n\t\t\t\t\t\tposition: 'relative',\n\t\t\t\t\t\twidth: 'auto',\n\t\t\t\t\t\ttop: 0,\n\t\t\t\t\t\tleft: 0,\n\t\t\t\t\t\tvisibility: 'visible'\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.toolbar.unsetDropdownsFixed();\n\t\t\t\t\tthis.$toolbar.removeClass('toolbar-fixed-box');\n\t\t\t\t},\n\t\t\t\tsetDropdownsFixed: function()\n\t\t\t\t{\n\t\t\t\t\tvar top = this.$toolbar.innerHeight() + this.opts.toolbarFixedTopOffset;\n\t\t\t\t\tvar position = 'fixed';\n\t\t\t\t\tif (this.opts.toolbarFixedTarget !== document)\n\t\t\t\t\t{\n\t\t\t\t\t\ttop = (this.$toolbar.innerHeight() + this.$toolbar.offset().top) + this.opts.toolbarFixedTopOffset;\n\t\t\t\t\t\tposition = 'absolute';\n\t\t\t\t\t}\n\n\t\t\t\t\t$('.redactor-dropdown-' + this.uuid).each(function()\n\t\t\t\t\t{\n\t\t\t\t\t\t$(this).css({ position: position, top: top + 'px' });\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\tunsetDropdownsFixed: function()\n\t\t\t\t{\n\t\t\t\t\tvar top = (this.$toolbar.innerHeight() + this.$toolbar.offset().top);\n\t\t\t\t\t$('.redactor-dropdown-' + this.uuid).each(function()\n\t\t\t\t\t{\n\t\t\t\t\t\t$(this).css({ position: 'absolute', top: top + 'px' });\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tupload: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tinit: function(id, url, callback)\n\t\t\t\t{\n\t\t\t\t\tthis.upload.direct = false;\n\t\t\t\t\tthis.upload.callback = callback;\n\t\t\t\t\tthis.upload.url = url;\n\t\t\t\t\tthis.upload.$el = $(id);\n\t\t\t\t\tthis.upload.$droparea = $('<div id=\"redactor-droparea\" />');\n\n\t\t\t\t\tthis.upload.$placeholdler = $('<div id=\"redactor-droparea-placeholder\" />').text(this.lang.get('upload_label'));\n\t\t\t\t\tthis.upload.$input = $('<input type=\"file\" name=\"file\" />');\n\n\t\t\t\t\tthis.upload.$placeholdler.append(this.upload.$input);\n\t\t\t\t\tthis.upload.$droparea.append(this.upload.$placeholdler);\n\t\t\t\t\tthis.upload.$el.append(this.upload.$droparea);\n\n\t\t\t\t\tthis.upload.$droparea.off('redactor.upload');\n\t\t\t\t\tthis.upload.$input.off('redactor.upload');\n\n\t\t\t\t\tthis.upload.$droparea.on('dragover.redactor.upload', $.proxy(this.upload.onDrag, this));\n\t\t\t\t\tthis.upload.$droparea.on('dragleave.redactor.upload', $.proxy(this.upload.onDragLeave, this));\n\n\t\t\t\t\t// change\n\t\t\t\t\tthis.upload.$input.on('change.redactor.upload', $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\te = e.originalEvent || e;\n\t\t\t\t\t\tthis.upload.traverseFile(this.upload.$input[0].files[0], e);\n\t\t\t\t\t}, this));\n\n\t\t\t\t\t// drop\n\t\t\t\t\tthis.upload.$droparea.on('drop.redactor.upload', $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t\tthis.upload.$droparea.removeClass('drag-hover').addClass('drag-drop');\n\t\t\t\t\t\tthis.upload.onDrop(e);\n\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\tdirectUpload: function(file, e)\n\t\t\t\t{\n\t\t\t\t\tthis.upload.direct = true;\n\t\t\t\t\tthis.upload.traverseFile(file, e);\n\t\t\t\t},\n\t\t\t\tonDrop: function(e)\n\t\t\t\t{\n\t\t\t\t\te = e.originalEvent || e;\n\t\t\t\t\tvar files = e.dataTransfer.files;\n\n\t\t\t\t\tthis.upload.traverseFile(files[0], e);\n\t\t\t\t},\n\t\t\t\ttraverseFile: function(file, e)\n\t\t\t\t{\n\t\t\t\t\tif (this.opts.s3)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.upload.setConfig(file);\n\t\t\t\t\t\tthis.upload.s3uploadFile(file);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar formData = !!window.FormData ? new FormData() : null;\n\t\t\t\t\tif (window.FormData)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.upload.setConfig(file);\n\n\t\t\t\t\t\tvar name = (this.upload.type == 'image') ? this.opts.imageUploadParam : this.opts.fileUploadParam;\n\t\t\t\t\t\tformData.append(name, file);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.progress.show();\n\t\t\t\t\tthis.core.setCallback('uploadStart', e, formData);\n\t\t\t\t\tthis.upload.sendData(formData, e);\n\t\t\t\t},\n\t\t\t\tsetConfig: function(file)\n\t\t\t\t{\n\t\t\t\t\tthis.upload.getType(file);\n\n\t\t\t\t\tif (this.upload.direct)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.upload.url = (this.upload.type == 'image') ? this.opts.imageUpload : this.opts.fileUpload;\n\t\t\t\t\t\tthis.upload.callback = (this.upload.type == 'image') ? this.image.insert : this.file.insert;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tgetType: function(file)\n\t\t\t\t{\n\t\t\t\t\tthis.upload.type = 'image';\n\t\t\t\t\tif (this.opts.imageTypes.indexOf(file.type) == -1)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.upload.type = 'file';\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tgetHiddenFields: function(obj, fd)\n\t\t\t\t{\n\t\t\t\t\tif (obj === false || typeof obj !== 'object') return fd;\n\n\t\t\t\t\t$.each(obj, $.proxy(function(k, v)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (v !== null && v.toString().indexOf('#') === 0) v = $(v).val();\n\t\t\t\t\t\tfd.append(k, v);\n\n\t\t\t\t\t}, this));\n\n\t\t\t\t\treturn fd;\n\n\t\t\t\t},\n\t\t\t\tsendData: function(formData, e)\n\t\t\t\t{\n\t\t\t\t\t// append hidden fields\n\t\t\t\t\tif (this.upload.type == 'image')\n\t\t\t\t\t{\n\t\t\t\t\t\tformData = this.upload.getHiddenFields(this.opts.uploadImageFields, formData);\n\t\t\t\t\t\tformData = this.upload.getHiddenFields(this.upload.imageFields, formData);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tformData = this.upload.getHiddenFields(this.opts.uploadFileFields, formData);\n\t\t\t\t\t\tformData = this.upload.getHiddenFields(this.upload.fileFields, formData);\n\t\t\t\t\t}\n\n\t\t\t\t\tvar xhr = new XMLHttpRequest();\n\t\t\t\t\txhr.open('POST', this.upload.url);\n\t\t\t\t\txhr.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\n\n\t\t\t\t\t// complete\n\t\t\t\t\txhr.onreadystatechange = $.proxy(function()\n\t\t\t\t\t{\n\t\t\t\t\t    if (xhr.readyState == 4)\n\t\t\t\t\t    {\n\t\t\t\t\t        var data = xhr.responseText;\n\n\t\t\t\t\t\t\tdata = data.replace(/^\\[/, '');\n\t\t\t\t\t\t\tdata = data.replace(/\\]$/, '');\n\n\t\t\t\t\t\t\tvar json;\n\t\t\t\t\t\t\ttry\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tjson = (typeof data === 'string' ? $.parseJSON(data) : data);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcatch(err)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tjson = {\n\t\t\t\t\t\t\t\t\terror: true\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t}\n\n\n\t\t\t\t\t\t\tthis.progress.hide();\n\n\t\t\t\t\t\t\tif (!this.upload.direct)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tthis.upload.$droparea.removeClass('drag-drop');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tthis.upload.callback(json, this.upload.direct, e);\n\t\t\t\t\t    }\n\t\t\t\t\t}, this);\n\n\n\t\t\t\t\t/*\n\t\t\t\t\txhr.upload.onprogress = $.proxy(function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (e.lengthComputable)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar complete = (e.loaded / e.total * 100 | 0);\n\t\t\t\t\t\t\t//progress.value = progress.innerHTML = complete;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}, this);\n\t\t\t\t\t*/\n\n\n\t\t\t\t\txhr.send(formData);\n\t\t\t\t},\n\t\t\t\tonDrag: function(e)\n\t\t\t\t{\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tthis.upload.$droparea.addClass('drag-hover');\n\t\t\t\t},\n\t\t\t\tonDragLeave: function(e)\n\t\t\t\t{\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tthis.upload.$droparea.removeClass('drag-hover');\n\t\t\t\t},\n\t\t\t\tclearImageFields: function()\n\t\t\t\t{\n\t\t\t\t\tthis.upload.imageFields = {};\n\t\t\t\t},\n\t\t\t\taddImageFields: function(name, value)\n\t\t\t\t{\n\t\t\t\t\tthis.upload.imageFields[name] = value;\n\t\t\t\t},\n\t\t\t\tremoveImageFields: function(name)\n\t\t\t\t{\n\t\t\t\t\tdelete this.upload.imageFields[name];\n\t\t\t\t},\n\t\t\t\tclearFileFields: function()\n\t\t\t\t{\n\t\t\t\t\tthis.upload.fileFields = {};\n\t\t\t\t},\n\t\t\t\taddFileFields: function(name, value)\n\t\t\t\t{\n\t\t\t\t\tthis.upload.fileFields[name] = value;\n\t\t\t\t},\n\t\t\t\tremoveFileFields: function(name)\n\t\t\t\t{\n\t\t\t\t\tdelete this.upload.fileFields[name];\n\t\t\t\t},\n\n\n\t\t\t\t// S3\n\t\t\t\ts3uploadFile: function(file)\n\t\t\t\t{\n\t\t\t\t\tthis.upload.s3executeOnSignedUrl(file, $.proxy(function(signedURL)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.upload.s3uploadToS3(file, signedURL);\n\t\t\t\t\t}, this));\n\t\t\t\t},\n\t\t\t\ts3executeOnSignedUrl: function(file, callback)\n\t\t\t\t{\n\t\t\t\t\tvar xhr = new XMLHttpRequest();\n\n\t\t\t\t\tvar mark = '?';\n\t\t\t\t\tif (this.opts.s3.search(/\\?/) != '-1') mark = '&';\n\n\t\t\t\t\txhr.open('GET', this.opts.s3 + mark + 'name=' + file.name + '&type=' + file.type, true);\n\n\t\t\t\t\t// Hack to pass bytes through unprocessed.\n\t\t\t\t\tif (xhr.overrideMimeType) xhr.overrideMimeType('text/plain; charset=x-user-defined');\n\n\t\t\t\t\tvar that = this;\n\t\t\t\t\txhr.onreadystatechange = function(e)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (this.readyState == 4 && this.status == 200)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tthat.progress.show();\n\t\t\t\t\t\t\tcallback(decodeURIComponent(this.responseText));\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (this.readyState == 4 && this.status != 200)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t//setProgress(0, 'Could not contact signing script. Status = ' + this.status);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\txhr.send();\n\t\t\t\t},\n\t\t\t\ts3createCORSRequest: function(method, url)\n\t\t\t\t{\n\t\t\t\t\tvar xhr = new XMLHttpRequest();\n\t\t\t\t\tif (\"withCredentials\" in xhr)\n\t\t\t\t\t{\n\t\t\t\t\t\txhr.open(method, url, true);\n\t\t\t\t\t}\n\t\t\t\t\telse if (typeof XDomainRequest != \"undefined\")\n\t\t\t\t\t{\n\t\t\t\t\t\txhr = new XDomainRequest();\n\t\t\t\t\t\txhr.open(method, url);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\txhr = null;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn xhr;\n\t\t\t\t},\n\t\t\t\ts3uploadToS3: function(file, url)\n\t\t\t\t{\n\t\t\t\t\tvar xhr = this.upload.s3createCORSRequest('PUT', url);\n\t\t\t\t\tif (!xhr)\n\t\t\t\t\t{\n\t\t\t\t\t\t//setProgress(0, 'CORS not supported');\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\txhr.onload = $.proxy(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (xhr.status == 200)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t//setProgress(100, 'Upload completed.');\n\n\t\t\t\t\t\t\t\tthis.progress.hide();\n\n\t\t\t\t\t\t\t\tvar s3file = url.split('?');\n\n\t\t\t\t\t\t\t\tif (!s3file[0])\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t // url parsing is fail\n\t\t\t\t\t\t\t\t\t return false;\n\t\t\t\t\t\t\t\t}\n\n\n\t\t\t\t\t\t\t\tif (!this.upload.direct)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tthis.upload.$droparea.removeClass('drag-drop');\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tvar json = { filelink: s3file[0] };\n\t\t\t\t\t\t\t\tif (this.upload.type == 'file')\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tvar arr = s3file[0].split('/');\n\t\t\t\t\t\t\t\t\tjson.filename = arr[arr.length-1];\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tthis.upload.callback(json, this.upload.direct, false);\n\n\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t//setProgress(0, 'Upload error: ' + xhr.status);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, this);\n\n\t\t\t\t\t\txhr.onerror = function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t//setProgress(0, 'XHR error.');\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\txhr.upload.onprogress = function(e)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t/*\n\t\t\t\t\t\t\tif (e.lengthComputable)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar percentLoaded = Math.round((e.loaded / e.total) * 100);\n\t\t\t\t\t\t\t\tsetProgress(percentLoaded, percentLoaded == 100 ? 'Finalizing.' : 'Uploading.');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t*/\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\txhr.setRequestHeader('Content-Type', file.type);\n\t\t\t\t\t\txhr.setRequestHeader('x-amz-acl', 'public-read');\n\n\t\t\t\t\t\txhr.send(file);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tutils: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tisMobile: function()\n\t\t\t\t{\n\t\t\t\t\treturn /(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent);\n\t\t\t\t},\n\t\t\t\tisDesktop: function()\n\t\t\t\t{\n\t\t\t\t\treturn !/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent);\n\t\t\t\t},\n\t\t\t\tisString: function(obj)\n\t\t\t\t{\n\t\t\t\t\treturn Object.prototype.toString.call(obj) == '[object String]';\n\t\t\t\t},\n\t\t\t\tisEmpty: function(html, removeEmptyTags)\n\t\t\t\t{\n\t\t\t\t\thtml = html.replace(/[\\u200B-\\u200D\\uFEFF]/g, '');\n\t\t\t\t\thtml = html.replace(/&nbsp;/gi, '');\n\t\t\t\t\thtml = html.replace(/<\\/?br\\s?\\/?>/g, '');\n\t\t\t\t\thtml = html.replace(/\\s/g, '');\n\t\t\t\t\thtml = html.replace(/^<p>[^\\W\\w\\D\\d]*?<\\/p>$/i, '');\n\t\t\t\t\thtml = html.replace(/<iframe(.*?[^>])>$/i, 'iframe');\n\t\t\t\t\thtml = html.replace(/<source(.*?[^>])>$/i, 'source');\n\n\t\t\t\t\t// remove empty tags\n\t\t\t\t\tif (removeEmptyTags !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(/<[^\\/>][^>]*><\\/[^>]+>/gi, '');\n\t\t\t\t\t\thtml = html.replace(/<[^\\/>][^>]*><\\/[^>]+>/gi, '');\n\t\t\t\t\t}\n\n\t\t\t\t\thtml = $.trim(html);\n\n\t\t\t\t\treturn html === '';\n\t\t\t\t},\n\t\t\t\tnormalize: function(str)\n\t\t\t\t{\n\t\t\t\t\tif (typeof(str) === 'undefined') return 0;\n\t\t\t\t\treturn parseInt(str.replace('px',''), 10);\n\t\t\t\t},\n\t\t\t\thexToRgb: function(hex)\n\t\t\t\t{\n\t\t\t\t\tif (typeof hex == 'undefined') return;\n\t\t\t\t\tif (hex.search(/^#/) == -1) return hex;\n\n\t\t\t\t\tvar shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\n\t\t\t\t\thex = hex.replace(shorthandRegex, function(m, r, g, b)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn r + r + g + g + b + b;\n\t\t\t\t\t});\n\n\t\t\t\t\tvar result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n\t\t\t\t\treturn 'rgb(' + parseInt(result[1], 16) + ', ' + parseInt(result[2], 16) + ', ' + parseInt(result[3], 16) + ')';\n\t\t\t\t},\n\t\t\t\tgetOuterHtml: function(el)\n\t\t\t\t{\n\t\t\t\t\treturn $('<div>').append($(el).eq(0).clone()).html();\n\t\t\t\t},\n\t\t\t\tgetAlignmentElement: function(el)\n\t\t\t\t{\n\t\t\t\t\tif ($.inArray(el.tagName, this.opts.alignmentTags) !== -1)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $(el);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treturn $(el).closest(this.opts.alignmentTags.toString().toLowerCase(), this.$editor[0]);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tremoveEmptyAttr: function(el, attr)\n\t\t\t\t{\n\t\t\t\t\tvar $el = $(el);\n\t\t\t\t\tif (typeof $el.attr(attr) == 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($el.attr(attr) === '')\n\t\t\t\t\t{\n\t\t\t\t\t\t$el.removeAttr(attr);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tremoveEmpty: function(i, s)\n\t\t\t\t{\n\t\t\t\t\tvar $s = $($.parseHTML(s));\n\n\t\t\t\t\t$s.find('.redactor-invisible-space').removeAttr('style').removeAttr('class');\n\n\t\t\t\t\tif ($s.find('hr, br, img, iframe, source').length !== 0) return;\n\t\t\t\t\tvar text = $.trim($s.text());\n\n\t\t\t\t\tif (this.utils.isEmpty(text, false))\n\t\t\t\t\t{\n\t\t\t\t\t\t$s.remove();\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t\t// save and restore scroll\n\t\t\t\tsaveScroll: function()\n\t\t\t\t{\n\t\t\t\t\tthis.saveEditorScroll = this.$editor.scrollTop();\n\t\t\t\t\tthis.saveBodyScroll = $(window).scrollTop();\n\n\t\t\t\t\tif (this.opts.scrollTarget) this.saveTargetScroll = $(this.opts.scrollTarget).scrollTop();\n\t\t\t\t},\n\t\t\t\trestoreScroll: function()\n\t\t\t\t{\n\t\t\t\t\tif (typeof this.saveScroll === 'undefined' && typeof this.saveBodyScroll === 'undefined') return;\n\n\t\t\t\t\t$(window).scrollTop(this.saveBodyScroll);\n\t\t\t\t\tthis.$editor.scrollTop(this.saveEditorScroll);\n\n\t\t\t\t\tif (this.opts.scrollTarget) $(this.opts.scrollTarget).scrollTop(this.saveTargetScroll);\n\t\t\t\t},\n\n\t\t\t\t// get invisible space element\n\t\t\t\tcreateSpaceElement: function()\n\t\t\t\t{\n\t\t\t\t\tvar space = document.createElement('span');\n\t\t\t\t\tspace.className = 'redactor-invisible-space';\n\t\t\t\t\tspace.innerHTML = this.opts.invisibleSpace;\n\n\t\t\t\t\treturn space;\n\t\t\t\t},\n\n\t\t\t\t// replace\n\t\t\t\tremoveInlineTags: function(node)\n\t\t\t\t{\n\t\t\t\t\tvar tags = this.opts.inlineTags;\n\t\t\t\t\ttags.push('span');\n\n\t\t\t\t\tif (node.tagName == 'PRE') tags.push('a');\n\n\t\t\t\t\t$(node).find(tags.join(',')).not('span.redactor-selection-marker').contents().unwrap();\n\t\t\t\t},\n\t\t\t\treplaceWithContents: function(node, removeInlineTags)\n\t\t\t\t{\n\t\t\t\t\tvar self = this;\n\t\t\t\t\t$(node).replaceWith(function()\n\t\t\t\t\t{\n\t\t\t\t\t\tif (removeInlineTags === true) self.utils.removeInlineTags(this);\n\n\t\t\t\t\t\treturn $(this).contents();\n\t\t\t\t\t});\n\n\t\t\t\t\treturn $(node);\n\t\t\t\t},\n\t\t\t\treplaceToTag: function(node, tag, removeInlineTags)\n\t\t\t\t{\n\t\t\t\t\tvar replacement;\n\t\t\t\t\tvar self = this;\n\t\t\t\t\t$(node).replaceWith(function()\n\t\t\t\t\t{\n\t\t\t\t\t\treplacement = $('<' + tag + ' />').append($(this).contents());\n\n\t\t\t\t\t\tfor (var i = 0; i < this.attributes.length; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treplacement.attr(this.attributes[i].name, this.attributes[i].value);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (removeInlineTags === true) self.utils.removeInlineTags(replacement);\n\n\t\t\t\t\t\treturn replacement;\n\t\t\t\t\t});\n\n\t\t\t\t\treturn replacement;\n\t\t\t\t},\n\n\t\t\t\t// start and end of element\n\t\t\t\tisStartOfElement: function()\n\t\t\t\t{\n\t\t\t\t\tvar block = this.selection.getBlock();\n\t\t\t\t\tif (!block) return false;\n\n\t\t\t\t\tvar offset = this.caret.getOffsetOfElement(block);\n\n\t\t\t\t\treturn (offset === 0) ? true : false;\n\t\t\t\t},\n\t\t\t\tisEndOfElement: function(element)\n\t\t\t\t{\n\t\t\t\t\tif (typeof element == 'undefined')\n\t\t\t\t\t{\n\t\t\t\t\t\tvar element = this.selection.getBlock();\n\t\t\t\t\t\tif (!element) return false;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar offset = this.caret.getOffsetOfElement(element);\n\t\t\t\t\tvar text = $.trim($(element).text()).replace(/\\n\\r\\n/g, '');\n\n\t\t\t\t\treturn (offset == text.length) ? true : false;\n\t\t\t\t},\n\t\t\t\tisEndOfEditor: function()\n\t\t\t\t{\n\t\t\t\t\tvar block = this.$editor[0];\n\n\t\t\t\t\tvar offset = this.caret.getOffsetOfElement(block);\n\t\t\t\t\tvar text = $.trim($(block).html().replace(/(<([^>]+)>)/gi,''));\n\n\t\t\t\t\treturn (offset == text.length) ? true : false;\n\t\t\t\t},\n\n\t\t\t\t// test blocks\n\t\t\t\tisBlock: function(block)\n\t\t\t\t{\n\t\t\t\t\tblock = block[0] || block;\n\n\t\t\t\t\treturn block && this.utils.isBlockTag(block.tagName);\n\t\t\t\t},\n\t\t\t\tisBlockTag: function(tag)\n\t\t\t\t{\n\t\t\t\t\tif (typeof tag == 'undefined') return false;\n\n\t\t\t\t\treturn this.reIsBlock.test(tag);\n\t\t\t\t},\n\n\t\t\t\t// tag detection\n\t\t\t\tisTag: function(current, tag)\n\t\t\t\t{\n\t\t\t\t\tvar element = $(current).closest(tag, this.$editor[0]);\n\t\t\t\t\tif (element.length == 1)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn element[0];\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\n\t\t\t\t// select all\n\t\t\t\tisSelectAll: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.selectAll;\n\t\t\t\t},\n\t\t\t\tenableSelectAll: function()\n\t\t\t\t{\n\t\t\t\t\tthis.selectAll = true;\n\t\t\t\t},\n\t\t\t\tdisableSelectAll: function()\n\t\t\t\t{\n\t\t\t\t\tthis.selectAll = false;\n\t\t\t\t},\n\n\t\t\t\t// parents detection\n\t\t\t\tisRedactorParent: function(el)\n\t\t\t\t{\n\t\t\t\t\tif (!el)\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ($(el).parents('.redactor-editor').length === 0 || $(el).hasClass('redactor-editor'))\n\t\t\t\t\t{\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn el;\n\t\t\t\t},\n\t\t\t\tisCurrentOrParentHeader: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.utils.isCurrentOrParent(['H1', 'H2', 'H3', 'H4', 'H5', 'H6']);\n\t\t\t\t},\n\t\t\t\tisCurrentOrParent: function(tagName)\n\t\t\t\t{\n\t\t\t\t\tvar parent = this.selection.getParent();\n\t\t\t\t\tvar current = this.selection.getCurrent();\n\n\t\t\t\t\tif ($.isArray(tagName))\n\t\t\t\t\t{\n\t\t\t\t\t\tvar matched = 0;\n\t\t\t\t\t\t$.each(tagName, $.proxy(function(i, s)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (this.utils.isCurrentOrParentOne(current, parent, s))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tmatched++;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}, this));\n\n\t\t\t\t\t\treturn (matched === 0) ? false : true;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\treturn this.utils.isCurrentOrParentOne(current, parent, tagName);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tisCurrentOrParentOne: function(current, parent, tagName)\n\t\t\t\t{\n\t\t\t\t\ttagName = tagName.toUpperCase();\n\n\t\t\t\t\treturn parent && parent.tagName === tagName ? parent : current && current.tagName === tagName ? current : false;\n\t\t\t\t},\n\n\n\t\t\t\t// browsers detection\n\t\t\t\tisOldIe: function()\n\t\t\t\t{\n\t\t\t\t\treturn (this.utils.browser('msie') && parseInt(this.utils.browser('version'), 10) < 9) ? true : false;\n\t\t\t\t},\n\t\t\t\tisLessIe10: function()\n\t\t\t\t{\n\t\t\t\t\treturn (this.utils.browser('msie') && parseInt(this.utils.browser('version'), 10) < 10) ? true : false;\n\t\t\t\t},\n\t\t\t\tisIe11: function()\n\t\t\t\t{\n\t\t\t\t\treturn !!navigator.userAgent.match(/Trident\\/7\\./);\n\t\t\t\t},\n\t\t\t\tbrowser: function(browser)\n\t\t\t\t{\n\t\t\t\t\tvar ua = navigator.userAgent.toLowerCase();\n\t\t\t\t\tvar match = /(opr)[\\/]([\\w.]+)/.exec( ua ) ||\n\t\t            /(chrome)[ \\/]([\\w.]+)/.exec( ua ) ||\n\t\t            /(webkit)[ \\/]([\\w.]+).*(safari)[ \\/]([\\w.]+)/.exec(ua) ||\n\t\t            /(webkit)[ \\/]([\\w.]+)/.exec( ua ) ||\n\t\t            /(opera)(?:.*version|)[ \\/]([\\w.]+)/.exec( ua ) ||\n\t\t            /(msie) ([\\w.]+)/.exec( ua ) ||\n\t\t            ua.indexOf(\"trident\") >= 0 && /(rv)(?::| )([\\w.]+)/.exec( ua ) ||\n\t\t            ua.indexOf(\"compatible\") < 0 && /(mozilla)(?:.*? rv:([\\w.]+)|)/.exec( ua ) ||\n\t\t            [];\n\n\t\t\t\t\tif (browser == 'safari') return (typeof match[3] != 'undefined') ? match[3] == 'safari' : false;\n\t\t\t\t\tif (browser == 'version') return match[2];\n\t\t\t\t\tif (browser == 'webkit') return (match[1] == 'chrome' || match[1] == 'opr' || match[1] == 'webkit');\n\t\t\t\t\tif (match[1] == 'rv') return browser == 'msie';\n\t\t\t\t\tif (match[1] == 'opr') return browser == 'webkit';\n\n\t\t\t\t\treturn browser == match[1];\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\t\tlinkify: function()\n\t\t{\n\t\t\treturn {\n\t\t\t\tisKey: function(key)\n\t\t\t\t{\n\t\t\t\t\treturn key == this.keyCode.ENTER || key == this.keyCode.SPACE;\n\t\t\t\t},\n\t\t\t\tisEnabled: function()\n\t\t\t\t{\n\t\t\t\t\treturn this.opts.convertLinks && (this.opts.convertUrlLinks || this.opts.convertImageLinks || this.opts.convertVideoLinks) && !this.utils.isCurrentOrParent('PRE');\n\t\t\t\t},\n\t\t\t\tformat: function()\n\t\t\t\t{\n\t\t\t\t\tvar linkify = this.linkify,\n\t\t\t\t\t\topts    = this.opts;\n\n\t\t\t\t\tthis.$editor\n\t\t\t\t\t\t.find(\":not(iframe,img,a,pre)\")\n\t\t\t\t\t\t.addBack()\n\t\t\t\t\t\t.contents()\n\t\t\t\t\t\t.filter(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\treturn this.nodeType === 3 && $.trim(this.nodeValue) != \"\" && !$(this).parent().is(\"pre\") && (this.nodeValue.match(opts.linkify.regexps.youtube) || this.nodeValue.match(opts.linkify.regexps.vimeo) || this.nodeValue.match(opts.linkify.regexps.image) || this.nodeValue.match(opts.linkify.regexps.url));\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.each(function()\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar text = $(this).text(),\n\t\t\t\t\t\t\t\thtml = text;\n\n\t\t\t\t\t\t\tif (opts.convertVideoLinks && (html.match(opts.linkify.regexps.youtube) || html.match(opts.linkify.regexps.vimeo)) )\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\thtml = linkify.convertVideoLinks(html);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (opts.convertImageLinks && html.match(opts.linkify.regexps.image))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\thtml = linkify.convertImages(html);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (opts.convertUrlLinks)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\thtml = linkify.convertLinks(html);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t$(this).before(text.replace(text, html))\n\t\t\t\t\t\t\t\t   .remove();\n\t\t\t\t\t\t});\n\n\t\t\t\t\tthis.linkify.after();\n\t\t\t\t},\n\t\t\t\tconvertVideoLinks: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar iframeStart = '<iframe width=\"500\" height=\"281\" src=\"',\n\t\t\t\t\t\tiframeEnd = '\" frameborder=\"0\" allowfullscreen></iframe>';\n\n\t\t\t\t\tif (html.match(this.opts.linkify.regexps.youtube))\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(this.opts.linkify.regexps.youtube, iframeStart + '//www.youtube.com/embed/$1' + iframeEnd);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (html.match(this.opts.linkify.regexps.vimeo))\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(this.opts.linkify.regexps.vimeo, iframeStart + '//player.vimeo.com/video/$2' + iframeEnd);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tconvertImages: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar matches = html.match(this.opts.linkify.regexps.image);\n\n\t\t\t\t\tif (matches)\n\t\t\t\t\t{\n\t\t\t\t\t\thtml = html.replace(html, '<img src=\"' + matches + '\" />');\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tconvertLinks: function(html)\n\t\t\t\t{\n\t\t\t\t\tvar matches = html.match(this.opts.linkify.regexps.url);\n\n\t\t\t\t\tif (matches)\n\t\t\t\t\t{\n\t\t\t\t\t\tmatches = $.grep(matches, function(v, k) { return $.inArray(v, matches) === k; });\n\n\t\t\t\t\t\tvar length = matches.length;\n\n\t\t\t\t\t\tfor (var i = 0; i < length; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar href = matches[i],\n\t\t\t\t\t\t\t\ttext = href,\n\t\t\t\t\t\t\t\tlinkProtocol = this.opts.linkProtocol + '://';\n\n\t\t\t\t\t\t\tif (href.match(/(https?|ftp):\\/\\//i) !== null)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlinkProtocol = \"\";\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (text.length > this.opts.linkSize)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttext = text.substring(0, this.opts.linkSize) + '...';\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\ttext = decodeURIComponent(text);\n\n\t\t\t\t\t\t\tvar regexB = \"\\\\b\";\n\n\t\t\t\t\t\t\tif ($.inArray(href.slice(-1), [\"/\", \"&\", \"=\"]) != -1)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tregexB = \"\";\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// escaping url\n\t\t\t\t\t\t\tvar regexp = new RegExp('(' + href.replace(/[\\-\\[\\]\\/\\{\\}\\(\\)\\*\\+\\?\\.\\\\\\^\\$\\|]/g, \"\\\\$&\") + regexB + ')', 'g');\n\n\t\t\t\t\t\t\thtml = html.replace(regexp, '<a href=\"' + linkProtocol + $.trim(href) + '\">' + $.trim(text) + '</a>');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\treturn html;\n\t\t\t\t},\n\t\t\t\tafter: function()\n\t\t\t\t{\n\t\t\t\t\tthis.observe.load();\n\t\t\t\t\tthis.code.sync();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\n\t$(window).on('load.tools.redactor', function()\n\t{\n\t\t$('[data-tools=\"redactor\"]').redactor();\n\t});\n\n\t// constructor\n\tRedactor.prototype.init.prototype = Redactor.prototype;\n})(jQuery);","if (!RedactorPlugins) var RedactorPlugins = {};\n\n(function($)\n{\n\tRedactorPlugins.imagemanager = function()\n\t{\n\t\treturn {\n\t\t\tinit: function()\n\t\t\t{\n\t\t\t\tif (!this.opts.imageManagerJson) return;\n\n\t\t\t\tthis.modal.addCallback('image', this.imagemanager.load);\n\t\t\t},\n\t\t\tload: function()\n\t\t\t{\n\t\t\t\tvar $modal = this.modal.getModal();\n\n\t\t\t\tthis.modal.createTabber($modal);\n\t\t\t\tthis.modal.addTab(1, 'Upload', 'active');\n\t\t\t\tthis.modal.addTab(2, 'Choose');\n\n\t\t\t\t$('#redactor-modal-image-droparea').addClass('redactor-tab redactor-tab1');\n\n\t\t\t\tvar $box = $('<div id=\"redactor-image-manager-box\" style=\"overflow: auto; height: 300px;\" class=\"redactor-tab redactor-tab2\">').hide();\n\t\t\t\t$modal.append($box);\n\n\t\t\t\t$.ajax({\n\t\t\t\t  dataType: \"json\",\n\t\t\t\t  cache: false,\n\t\t\t\t  url: this.opts.imageManagerJson,\n\t\t\t\t  success: $.proxy(function(data)\n\t\t\t\t\t{\n\t\t\t\t\t\t$.each(data, $.proxy(function(key, val)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t// title\n\t\t\t\t\t\t\tvar thumbtitle = '';\n\t\t\t\t\t\t\tif (typeof val.title !== 'undefined') thumbtitle = val.title;\n\n\t\t\t\t\t\t\tvar img = $('<img src=\"' + val.thumb + '\" rel=\"' + val.image + '\" title=\"' + thumbtitle + '\" style=\"width: 100px; height: 75px; cursor: pointer;\" />');\n\t\t\t\t\t\t\t$('#redactor-image-manager-box').append(img);\n\t\t\t\t\t\t\t$(img).click($.proxy(this.imagemanager.insert, this));\n\n\t\t\t\t\t\t}, this));\n\n\n\t\t\t\t\t}, this)\n\t\t\t\t});\n\n\n\t\t\t},\n\t\t\tinsert: function(e)\n\t\t\t{\n\t\t\t\tthis.image.insert('<img src=\"' + $(e.target).attr('rel') + '\" alt=\"' + $(e.target).attr('title') + '\">');\n\t\t\t}\n\t\t};\n\t};\n})(jQuery);","if (!RedactorPlugins) var RedactorPlugins = {};\n\n(function($)\n{\n\tRedactorPlugins.table = function()\n\t{\n\t\treturn {\n\t\t\tgetTemplate: function()\n\t\t\t{\n\t\t\t\treturn String()\n\t\t\t\t+ '<section id=\"redactor-modal-table-insert\">'\n\t\t\t\t\t+ '<label>' + this.lang.get('rows') + '</label>'\n\t\t\t\t\t+ '<input type=\"text\" size=\"5\" value=\"2\" id=\"redactor-table-rows\" />'\n\t\t\t\t\t+ '<label>' + this.lang.get('columns') + '</label>'\n\t\t\t\t\t+ '<input type=\"text\" size=\"5\" value=\"3\" id=\"redactor-table-columns\" />'\n\t\t\t\t+ '</section>';\n\t\t\t},\n\t\t\tinit: function()\n\t\t\t{\n\n\t\t\t\tvar dropdown = {};\n\n\t\t\t\tdropdown.insert_table = { title: this.lang.get('insert_table'), func: this.table.show };\n\t\t\t\tdropdown.insert_row_above = { title: this.lang.get('insert_row_above'), func: this.table.addRowAbove };\n\t\t\t\tdropdown.insert_row_below = { title: this.lang.get('insert_row_below'), func: this.table.addRowBelow };\n\t\t\t\tdropdown.insert_column_left = { title: this.lang.get('insert_column_left'), func: this.table.addColumnLeft };\n\t\t\t\tdropdown.insert_column_right = { title: this.lang.get('insert_column_right'), func: this.table.addColumnRight };\n\t\t\t\tdropdown.add_head = { title: this.lang.get('add_head'), func: this.table.addHead };\n\t\t\t\tdropdown.delete_head = { title: this.lang.get('delete_head'), func: this.table.deleteHead };\n\t\t\t\tdropdown.delete_column = { title: this.lang.get('delete_column'), func: this.table.deleteColumn };\n\t\t\t\tdropdown.delete_row = { title: this.lang.get('delete_row'), func: this.table.deleteRow };\n\t\t\t\tdropdown.delete_table = { title: this.lang.get('delete_table'), func: this.table.deleteTable };\n\n\t\t\t\tthis.observe.addButton('td', 'table');\n\t\t\t\tthis.observe.addButton('th', 'table');\n\n\t\t\t\tvar button = this.button.addBefore('link', 'table', this.lang.get('table'));\n\t\t\t\tthis.button.addDropdown(button, dropdown);\n\t\t\t},\n\t\t\tshow: function()\n\t\t\t{\n\t\t\t\tthis.modal.addTemplate('table', this.table.getTemplate());\n\n\t\t\t\tthis.modal.load('table', this.lang.get('insert_table'), 300);\n\t\t\t\tthis.modal.createCancelButton();\n\n\t\t\t\tvar button = this.modal.createActionButton(this.lang.get('insert'));\n\t\t\t\tbutton.on('click', this.table.insert);\n\n\t\t\t\tthis.selection.save();\n\t\t\t\tthis.modal.show();\n\n\t\t\t\t$('#redactor-table-rows').focus();\n\n\t\t\t},\n\t\t\tinsert: function()\n\t\t\t{\n\t\t\t\tthis.placeholder.remove();\n\t\t\t\tthis.clean.cleanEmptyParagraph();\n\t\t\t\t\n\t\t\t\tvar rows = $('#redactor-table-rows').val(),\n\t\t\t\t\tcolumns = $('#redactor-table-columns').val(),\n\t\t\t\t\t$tableBox = $('<div>'),\n\t\t\t\t\ttableId = Math.floor(Math.random() * 99999),\n\t\t\t\t\t$table = $('<table id=\"table' + tableId + '\"><tbody></tbody></table>'),\n\t\t\t\t\ti, $row, z, $column;\n\n\t\t\t\tfor (i = 0; i < rows; i++)\n\t\t\t\t{\n\t\t\t\t\t$row = $('<tr>');\n\n\t\t\t\t\tfor (z = 0; z < columns; z++)\n\t\t\t\t\t{\n\t\t\t\t\t\t$column = $('<td>' + this.opts.invisibleSpace + '</td>');\n\n\t\t\t\t\t\t// set the focus to the first td\n\t\t\t\t\t\tif (i === 0 && z === 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$column.append(this.selection.getMarker());\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t$($row).append($column);\n\t\t\t\t\t}\n\n\t\t\t\t\t$table.append($row);\n\t\t\t\t}\n\n\t\t\t\t$tableBox.append($table);\n\t\t\t\tvar html = $tableBox.html();\n\n\t\t\t\tthis.modal.close();\n\t\t\t\tthis.selection.restore();\n\n\t\t\t\tif (this.table.getTable()) return;\n\n\t\t\t\tthis.buffer.set();\n\n\t\t\t\tvar current = this.selection.getBlock() || this.selection.getCurrent();\n\t\t\t\tif (current && current.tagName != 'BODY')\n\t\t\t\t{\n\t\t\t\t\tif (current.tagName == 'LI') current = $(current).closest('ul, ol');\n\t\t\t\t\t$(current).after(html);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.insert.html(html, false);\n\t\t\t\t}\n\n\t\t\t\tthis.selection.restore();\n\n\t\t\t\tvar table = this.$editor.find('#table' + tableId);\n\n\t\t\t\tif (!this.opts.linebreaks && (this.utils.browser('mozilla') || this.utils.browser('msie')))\n\t\t\t\t{\n\t\t\t\t\tvar $next = table.next();\n\t\t\t\t\tif ($next.length === 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t table.after(this.opts.emptyHtml);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.observe.buttons();\n\n\t\t\t\ttable.find('span.redactor-selection-marker').remove();\n\t\t\t\ttable.removeAttr('id');\n\n\t\t\t\tthis.code.sync();\n\t\t\t\tthis.core.setCallback('insertedTable', table);\n\t\t\t},\n\t\t\tgetTable: function()\n\t\t\t{\n\t\t\t\tvar $table = $(this.selection.getParent()).closest('table');\n\n\t\t\t\tif (!this.utils.isRedactorParent($table)) return false;\n\t\t\t\tif ($table.size() === 0) return false;\n\n\t\t\t\treturn $table;\n\t\t\t},\n\t\t\trestoreAfterDelete: function($table)\n\t\t\t{\n\t\t\t\tthis.selection.restore();\n\t\t\t\t$table.find('span.redactor-selection-marker').remove();\n\t\t\t\tthis.code.sync();\n\t\t\t},\n\t\t\tdeleteTable: function()\n\t\t\t{\n\t\t\t\tvar $table = this.table.getTable();\n\t\t\t\tif (!$table) return;\n\n\t\t\t\tthis.buffer.set();\n\n\n\t\t\t\tvar $next = $table.next();\n\t\t\t\tif (!this.opts.linebreaks && $next.length !== 0)\n\t\t\t\t{\n\t\t\t\t\tthis.caret.setStart($next);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.caret.setAfter($table);\n\t\t\t\t}\n\n\n\t\t\t\t$table.remove();\n\n\t\t\t\tthis.code.sync();\n\t\t\t},\n\t\t\tdeleteRow: function()\n\t\t\t{\n\t\t\tvar $table = this.table.getTable();\n\t\t\tif (!$table) return;\n\n\t\t\tvar $current = $(this.selection.getCurrent());\n\n\t\t\tthis.buffer.set();\n\n\t\t\tvar $current_tr = $current.closest('tr');\n\t\t\tvar $focus_tr = $current_tr.prev().length ? $current_tr.prev() : $current_tr.next();\n\t\t\tif ($focus_tr.length)\n\t\t\t{\n\t\t\t\tvar $focus_td = $focus_tr.children('td, th').first();\n\t\t\t\tif ($focus_td.length) $focus_td.prepend(this.selection.getMarker());\n\t\t\t}\n\n\t\t\t$current_tr.remove();\n\t\t\tthis.table.restoreAfterDelete($table);\n\t\t},\n\t\t\tdeleteColumn: function()\n\t\t\t{\n\t\t\tvar $table = this.table.getTable();\n\t\t\tif (!$table) return;\n\n\t\t\tthis.buffer.set();\n\n\t\t\tvar $current = $(this.selection.getCurrent());\n\t\t\tvar $current_td = $current.closest('td, th');\n\t\t\tvar index = $current_td[0].cellIndex;\n\n\t\t\t$table.find('tr').each($.proxy(function(i, elem)\n\t\t\t{\n\t\t\t\tvar $elem = $(elem);\n\t\t\t\tvar focusIndex = index - 1 < 0 ? index + 1 : index - 1;\n\t\t\t\tif (i === 0) $elem.find('td, th').eq(focusIndex).prepend(this.selection.getMarker());\n\n\t\t\t\t$elem.find('td, th').eq(index).remove();\n\n\t\t\t}, this));\n\n\t\t\tthis.table.restoreAfterDelete($table);\n\t\t},\n\t\t\taddHead: function()\n\t\t\t{\n\t\t\t\tvar $table = this.table.getTable();\n\t\t\t\tif (!$table) return;\n\n\t\t\t\tthis.buffer.set();\n\n\t\t\t\tif ($table.find('thead').size() !== 0)\n\t\t\t\t{\n\t\t\t\t\tthis.table.deleteHead();\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tvar tr = $table.find('tr').first().clone();\n\t\t\t\ttr.find('td').replaceWith($.proxy(function()\n\t\t\t\t{\n\t\t\t\t\treturn $('<th>').html(this.opts.invisibleSpace);\n\t\t\t\t}, this));\n\n\t\t\t\t$thead = $('<thead></thead>').append(tr);\n\t\t\t\t$table.prepend($thead);\n\n\t\t\t\tthis.code.sync();\n\n\t\t\t},\n\t\t\tdeleteHead: function()\n\t\t\t{\n\t\t\t\tvar $table = this.table.getTable();\n\t\t\t\tif (!$table) return;\n\n\t\t\t\tvar $thead = $table.find('thead');\n\t\t\t\tif ($thead.size() === 0) return;\n\n\t\t\t\tthis.buffer.set();\n\n\t\t\t\t$thead.remove();\n\t\t\t\tthis.code.sync();\n\t\t\t},\n\t\t\taddRowAbove: function()\n\t\t\t{\n\t\t\t\tthis.table.addRow('before');\n\t\t\t},\n\t\t\taddRowBelow: function()\n\t\t\t{\n\t\t\t\tthis.table.addRow('after');\n\t\t\t},\n\t\t\taddColumnLeft: function()\n\t\t\t{\n\t\t\t\tthis.table.addColumn('before');\n\t\t\t},\n\t\t\taddColumnRight: function()\n\t\t\t{\n\t\t\t\tthis.table.addColumn('after');\n\t\t\t},\n\t\t\taddRow: function(type)\n\t\t\t{\n\t\t\t\tvar $table = this.table.getTable();\n\t\t\t\tif (!$table) return;\n\n\t\t\t\tthis.buffer.set();\n\n\t\t\t\tvar $current = $(this.selection.getCurrent());\n\t\t\t\tvar $current_tr = $current.closest('tr');\n\t\t\t\tvar new_tr = $current_tr.clone();\n\n\t\t\t\tnew_tr.find('th').replaceWith(function()\n\t\t\t\t{\n\t\t\t\t\tvar $td = $('<td>');\n\t\t\t\t\t$td[0].attributes = this.attributes;\n\n\t\t\t\t\treturn $td.append($(this).contents());\n\t\t\t\t});\n\n\t\t\t\tnew_tr.find('td').html(this.opts.invisibleSpace);\n\n\t\t\t\tif (type == 'after')\n\t\t\t\t{\n\t\t\t\t\t$current_tr.after(new_tr);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$current_tr.before(new_tr);\n\t\t\t\t}\n\n\t\t\t\tthis.code.sync();\n\t\t\t},\n\t\t\taddColumn: function (type)\n\t\t\t{\n\t\t\t\tvar $table = this.table.getTable();\n\t\t\t\tif (!$table) return;\n\n\t\t\t\tvar index = 0;\n\t\t\t\tvar current = $(this.selection.getCurrent());\n\n\t\t\t\tthis.buffer.set();\n\n\t\t\t\tvar $current_tr = current.closest('tr');\n\t\t\t\tvar $current_td = current.closest('td, th');\n\n\t\t\t\t$current_tr.find('td, th').each($.proxy(function(i, elem)\n\t\t\t\t{\n\t\t\t\t\tif ($(elem)[0] === $current_td[0]) index = i;\n\n\t\t\t\t}, this));\n\n\t\t\t\t$table.find('tr').each($.proxy(function(i, elem)\n\t\t\t\t{\n\t\t\t\t\tvar $current = $(elem).find('td, th').eq(index);\n\n\t\t\t\t\tvar td = $current.clone();\n\t\t\t\t\ttd.html(this.opts.invisibleSpace);\n\n\t\t\t\t\tif (type == 'after')\n\t\t\t\t\t{\n\t\t\t\t\t\t$current.after(td);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t$current.before(td);\n\t\t\t\t\t}\n\n\t\t\t\t}, this));\n\n\t\t\t\tthis.code.sync();\n\t\t\t}\n\t\t};\n\t};\n})(jQuery);"],"sourceRoot":"/source/"}